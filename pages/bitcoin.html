<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>‡§Æ‡§Ç‡§•‡§® | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/css/atelier-forest-light.css">
    <!-- <link rel="stylesheet" href="/static/css/atom-one-light.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/default.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/docco.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github-gist.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/zenburn.min.css"> -->
    <link rel="stylesheet" href="/static/css/tablesort.css"/>
    <link rel="stylesheet" href="/static/css/leaflet.css"/>
    <style>
      .svgcontainer {
        font: 9pt FiraCode Nerd Font;
        margin: 0 auto;
        display: inline-block;
        position: relative;
        width: 100%;
        overflow: hidden;
      }
      .node circle {
        fill: #e8e6d5;
        stroke: #999999;
        stroke-width: 2px;
      }
      .link {
        fill: none;
        stroke: #8897f4;
        stroke-width: 2px;
      }
    </style>
   </head>
  <body>
    <div class="body">
      <div class="topmenu">
        <table>
          <tr>
            <td colspan="3"><a class="menu_home" href="/index.html">‡§Æ‡§Ç‡§•‡§®</a></td>
          </tr>
          <tr>
            <td><a class="menu_archive" href="/archive.html">üíæ Archive</a></td>
            <td><a class="menu_tags" href="/tags.html">üîñ Tags</a></td>
            <td><a class="menu_stats" href="/stats.html">üìä Stats</a></td>
          </tr>
        </table>
      </div>
      <div class="content">
        <h1 class="h1"><img class="btcicon" alt="‚Çø" src="https://raw.githubusercontent.com/7h3rAm/datastore/master/Bitcoin_evergreen.png"> Bitcoin</h1>
          <ul class="active">
            <li><h2 class="h2 collapsible expanded" onclick=toggle(this);>üìä Stats</h2><ul class="active nested">
                <li><table class="active nested astrotabclass">
                  <tr>
                    <th><b>Height</b></th>
                    <th><b>Issued</b></th>
                    <th><b>Outputs</b></th>
                    <th><b>Difficulty</b></th>
                    <th><b>Hashrate</b></th>
                    <th><b>Size</b></th>
                  </tr>
                  <tr>
                    <td id="blockchain_height"></td>
                    <td id="blockchain_circulation"></td>
                    <td id="blockchain_outputs"></td>
                    <td id="blockchain_difficulty"></td>
                    <td id="blockchain_hashrate"></td>
                    <td id="blockchain_size"></td>
                  </tr>
                </table></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>‚åõ Halvening</h3><ul class="active nested">
                  <li><table class="active nested astrotabclass">
                    <tr>
                      <th><b>Current Height</b></th>
                      <th><b>Current Reward</b></th>
                      <th><b>Halvening Height</b></th>
                      <th><b>Halvening Reward</b></th>
                      <th><b>Time Estimate</b></th>
                    </tr>
                    <tr>
                      <td id="hlvng_currheight"></td>
                      <td id="hlvng_currreward"></td>
                      <td id="hlvng_hlvheight"></td>
                      <td id="hlvng_hlvreward"></td>
                      <td id="hlvng_timeest"></td>
                    </tr>
                  </table></li>
                </ul></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üé≠ Market</h3><ul class="active nested">
                  <li><table class="active nested astrotabclass">
                    <tr>
                      <th><b>Price</b></th>
                      <th><b>Change (24h)</b></th>
                      <th><b>Capitalization</b></th>
                      <th><b>Dominance</b></th>
                    </tr>
                    <tr>
                      <td id="market_price"></td>
                      <td id="market_change"></td>
                      <td id="market_cap"></td>
                      <td id="market_dominance"></td>
                    </tr>
                  </table></li>
                </ul></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>‚åö 24h Stats</h3><ul class="active nested">
                  <li><table class="active nested astrotabclass">
                    <tr>
                      <th><b>Blocks</b></th>
                      <th><b>Transactions</b></th>
                      <th><b>Inflation</b></th>
                      <th><b>Volume</b></th>
                    </tr>
                    <tr>
                      <td id="blockchain_blocks"></td>
                      <td id="blockchain_transactions"></td>
                      <td id="blockchain_inflation"></td>
                      <td id="blockchain_volume"></td>
                    </tr>
                  </table></li>
                </ul></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üí≥ Transactions</h3><ul class="active nested">
                  <li><table class="active nested astrotabclass">
                    <tr>
                      <th><b>Count</b></th>
                      <th><b>Average Fee (24h)</b></th>
                      <th><b>Median Fee (24h)</b></th>
                      <th><b>Suggested Fee</b></th>
                    </tr>
                    <tr>
                      <td id="txs_count"></td>
                      <td id="txs_avgfee"></td>
                      <td id="txs_medfee"></td>
                      <td id="txs_sugfee"></td>
                    </tr>
                  </table></li>
                </ul></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üóÉÔ∏è Mempool</h3><ul class="active nested">
                  <li><table class="active nested astrotabclass">
                    <tr>
                      <th><b>Transactions</b></th>
                      <th><b>Size</b></th>
                      <th><b>Tps</b></th>
                      <th><b>Fee</b></th>
                      <th><b>Output</b></th>
                    </tr>
                    <tr>
                      <td id="mempool_transactions"></td>
                      <td id="mempool_size"></td>
                      <td id="mempool_tps"></td>
                      <td id="mempool_fee"></td>
                      <td id="mempool_output"></td>
                    </tr>
                  </table></li>
                </ul></li>
                <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üßÆ Nodes</h3><ul class="active nested">
                  <li><p class="active nested">Data provided courtesy of <a href="https://bitnodes.io/">Bitnodes</a> team.</p></li>
                  <li><div id="nodesmap" style="width:100%; height:450px; border:1px solid #766e6b;" class="mapclass"></div></li>
                </ul></li>
            </ul></li>
            <li><h2 class="h2 collapsible expanded" onclick=toggle(this);><a id="wallets"></a>üíº Wallets</h2><ul class="active nested">
              <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üìÑ Summary</h3><ul class="active nested">
                <li><table id="statstable" class="active nested astrotabclass">
                  <thead><tr>
                    <th><b>Category</b></th>
                    <th><b>Wallets</b></th>
                    <th><b>Addresses</b></th>
                    <th><b>Received</b></th>
                    <th><b>Sent</b></th>
                    <th><b>Balance</b></th>
                  </tr></thead>
                  <tbody><tr>
                    <td><a href="#donation">üôè Donation</a></td>
                    <td id="count_wallet_donation"></td>
                    <td id="count_address_donation"></td>
                    <td id="count_received_donation"></td>
                    <td id="count_sent_donation"></td>
                    <td id="count_balance_donation"></td>
                  </tr>
                  <tr>
                    <td><a href="#popular">üî• Popular</td>
                    <td id="count_wallet_popular"></td>
                    <td id="count_address_popular"></td>
                    <td id="count_received_popular"></td>
                    <td id="count_sent_popular"></td>
                    <td id="count_balance_popular"></td>
                  </tr>
                  <tr>
                    <td><a href="#ransom">üëæ Ransom</td>
                    <td id="count_wallet_ransom"></td>
                    <td id="count_address_ransom"></td>
                    <td id="count_received_ransom"></td>
                    <td id="count_sent_ransom"></td>
                    <td id="count_balance_ransom"></td>
                  </tr>
                  <tr data-sort-method="none">
                    <td><a href="#ransom"><b>üíº Total</b></td>
                    <td id="count_wallet"></td>
                    <td id="count_address"></td>
                    <td id="count_received"></td>
                    <td id="count_sent"></td>
                    <td id="count_balance"></td>
                  </tr></tbody>
                </table></li>
              </ul></li>
              <li><h3 class="h3 collapsible expanded" onclick=toggle(this);>üóø Graph</h3><ul class="active nested">
                <li><div id="walletgraph" class="svgcontainer"></div></li>
              </ul></li>
              <li><h3 class="h3 collapsible expanded" onclick=toggle(this);><a id="donation"></a>üôè Donation</h3><ul class="active nested">
                <li><table id="donationtable" class="active nested astrotabclass"></table></li>
              </ul></li>
              <li><h3 class="h3 collapsible expanded" onclick=toggle(this);><a id="popular"></a>üî• Popular</h3><ul class="active nested">
                <li><table id="populartable" class="active nested astrotabclass"></table></li>
              </ul></li>
              <li><h3 class="h3 collapsible expanded" onclick=toggle(this);><a id="ransom"></a>üëæ Ransom</h3><ul class="active nested">
                <li><table id="ransomtable" class="active nested astrotabclass"></table></li>
              </ul></li>
            </ul></li>
          </ul>

      <p style="float:right;"><code id="lastupdate"></code></p>
      <script type="text/javascript" src="/static/js/timeago.min.js"></script>
      <script type="text/javascript" src="/static/js/tablesort.min.js"></script>
      <script type="text/javascript" src="/static/js/tablesort.monthname.js"></script>
      <script type="text/javascript" src="/static/js/tablesort.number.js"></script>
      <script type="text/javascript" src="/static/js/numeral.min.js"></script>
      <script type="text/javascript" src="/static/js/leaflet.js"></script>
      <script type="text/javascript" src="/static/js/leaflet.terminator.js"></script>
      <script src="https://d3js.org/d3.v4.js"></script>
      <script type="text/javascript">
        function responsivefy(svg) {
          // https://brendansudol.com/writing/responsive-d3
          // get container + svg aspect ratio
          var container = d3.select(svg.node().parentNode),
            width = parseInt(svg.style("width")),
            height = parseInt(svg.style("height")),
            aspect = width / height;
          // add viewBox and preserveAspectRatio properties,
          // and call resize so that svg resizes on inital page load
          svg.attr("viewBox", "0 0 " + width + " " + height)
            .attr("perserveAspectRatio", "xMinYMid")
            .call(resize);
          // to register multiple listeners for same event type, 
          // you need to add namespace, i.e., 'click.foo'
          // necessary if you call invoke this function for multiple svgs
          // api docs: https://github.com/mbostock/d3/wiki/Selections#on
          d3.select(window).on("resize." + container.attr("id"), resize);
          // get width of container and resize svg to fit it
          function resize() {
            var targetWidth = parseInt(container.style("width"));
            svg.attr("width", targetWidth);
            svg.attr("height", Math.round(targetWidth / aspect));
          }
        }

        // Set the dimensions and margins of the diagram
        var margin = {top: 30, right: 90, bottom: 30, left: 120},
            width = 960 - margin.left - margin.right,
            height = 720 - margin.top - margin.bottom;

        var svg = d3.select("#walletgraph").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .call(responsivefy)
            .call(d3.zoom().on("zoom", function () {
               svg.attr("transform", d3.event.transform)
            }))
          .append("g")
            .attr("transform", "translate("
                  + margin.left + "," + margin.top + ")");

        var i = 0,
            duration = 750,
            root;

        // declares a tree layout and assigns the size
        var treemap = d3.tree().size([height, width]);

        // Assigns parent, children, height, depth
        var treeData, root;
        function inittree(jsondata) {
          treeData = jsondata.graph.grouped;
          console.log(treeData);
          root = d3.hierarchy(treeData, function(d) { return d.children; });
          root.x0 = height / 2;
          root.y0 = 0;
          update(root);
        }
        d3.json("walletgraph2.json", inittree);

        // Collapse the node and all it's children
        function collapse(d) {
          if(d.children) {
            d._children = d.children
            d._children.forEach(collapse)
            d.children = null
          }
        }

        function update(source) {
          // Assigns the x and y position for the nodes
          var treeData = treemap(root);

          // Compute the new tree layout.
          var nodes = treeData.descendants(),
              links = treeData.descendants().slice(1);

          // Normalize for fixed-depth.
          nodes.forEach(function(d){ d.y = d.depth * 180});

          // Update the nodes...
          var node = svg.selectAll('g.node').data(nodes, function(d) {return d.id || (d.id = ++i); });

          // Enter any new modes at the parent's previous position.
          var nodeEnter = node.enter().append('g').attr('class', 'node').attr("transform", function(d) {
            return "translate(" + source.y0 + "," + source.x0 + ")";
          }).on('click', click);

          // Add Circle for the nodes
          nodeEnter.append("circle").attr("r", function(d) { return d.data.size; }).style("stroke", function(d) { return d.data.nodecolor; }).style("fill", function(d) { return d.data.fillcolor; }).append("svg:title").text(function(d, i) { return d.data.tooltip; });

          // Add labels for the nodes
          nodeEnter.append('text').attr("dy", ".35em").attr("x", function(d) {
              return d.children || d._children ? d.data.size*-1-5 : d.data.size+5;
          }).attr("text-anchor", function(d) {
            return d.children || d._children ? "end" : "start";
          }).text(function(d) { return d.data.outlabel; });
          nodeEnter.append('text').attr("dy", ".35em").attr("x", function(d) {
            return (-1*(d.data.size/2))-5;
          }).attr("y", function(d) {
              return d.data.size+10;
          }).text(function(d) { return d.data.inlabel; });

          // UPDATE
          var nodeUpdate = nodeEnter.merge(node);

          // Transition to the proper position for the node
          nodeUpdate.transition().duration(duration).attr("transform", function(d) {
            return "translate(" + d.y + "," + d.x + ")";
          });

          // Update the node attributes and style
          nodeUpdate.select('circle.node').attr('r', 10).attr('cursor', 'pointer');

          // Remove any exiting nodes
          var nodeExit = node.exit().transition().duration(duration).attr("transform", function(d) {
            return "translate(" + source.y + "," + source.x + ")";
          }).remove();

          // On exit reduce the node circles size to 0
          nodeExit.select('circle').attr('r', 1e-6);

          // On exit reduce the opacity of text labels
          nodeExit.select('text').style('fill-opacity', 1e-6);

          // Update the links...
          var link = svg.selectAll('path.link').data(links, function(d) { return d.id; });

          // Enter any new links at the parent's previous position.
          var linkEnter = link.enter().insert('path', "g").attr("class", "link").style("stroke", function(d) { return d.data.edgecolor; }).attr('d', function(d) {
            var o = { x: source.x0, y: source.y0 }
            return diagonal(o, o)
          });

          // UPDATE
          var linkUpdate = linkEnter.merge(link);

          // Transition back to the parent element position
          linkUpdate.transition().duration(duration).attr('d', function(d) { return diagonal(d, d.parent) });

          // Remove any exiting links
          var linkExit = link.exit().transition().duration(duration).attr('d', function(d) {
            var o = { x: source.x, y: source.y }
            return diagonal(o, o)
          }).remove();

          // Store the old positions for transition.
          nodes.forEach(function(d) {
            d.x0 = d.x;
            d.y0 = d.y;
          });

          // Creates a curved (diagonal) path from parent to the child nodes
          function diagonal(s, d) {
            path = `M ${s.y} ${s.x}
                    C ${(s.y + d.y) / 2} ${s.x},
                      ${(s.y + d.y) / 2} ${d.x},
                      ${d.y} ${d.x}`
            return path
          }

          // Toggle children on click.
          function click(d) {
            if (d.children) {
              d._children = d.children;
              d.children = null;
            } else {
              d.children = d._children;
              d._children = null;
            }
            update(d);
          }
        }
      </script>
      <script type="text/javascript">
        numeral.zeroFormat('0');
        numeral.nullFormat('0');

        // https://stackoverflow.com/a/17177423/1079836
        function truncateWithEllipses(text, max) {return text.substr(0,max-1)+(text.length>max?'...':''); }
        function loadJson(url, callback) {
          var XmlHttpRequest = new XMLHttpRequest();
          XmlHttpRequest.overrideMimeType("application/json");
          XmlHttpRequest.open('GET', url, true);
          XmlHttpRequest.onreadystatechange = function () {
            if (XmlHttpRequest.readyState == 4 && XmlHttpRequest.status == "200") {
              callback(XmlHttpRequest.responseText);
            }
          }
          XmlHttpRequest.send(null);
        }

        function addBTC2USDHover(priceusd, node, value, format="0,0a", color="#f7931a", isbtc=false, fontbold=false) {
          format = format? format : "0,0a";
          color = color? color : "#f7931a";
          var btcicon = document.createElement("img");
          btcicon.setAttribute("src", "https://raw.githubusercontent.com/7h3rAm/datastore/master/Bitcoin_evergreen.png");
          btcicon.setAttribute("class", "btciconsmall");
          btcicon.setAttribute("alt", "‚Çø");
          var link = document.createElement("a");
          if (isbtc) {
            link.title = numeral(value*priceusd).format('$0,0a');
            link.text = numeral(value).format(format);
          } else {
            if (Math.abs(value) <= 9) {
              link.title = numeral((value/Math.pow(10, 8))*priceusd).format('$0,0a');
              link.text = (value/Math.pow(10, 8)).toFixed(8);
            } else {
              link.title = numeral((value/Math.pow(10, 8))*priceusd).format('$0,0a');
              link.text = Math.abs(value) > 0 ? numeral(value/Math.pow(10, 8)).format(format) : "0.00000000";
            }
          }
          link.style.color = color;
          if (typeof node === "string") {
            document.getElementById(node).appendChild(btcicon);
            document.getElementById(node).appendChild(link);
          } else {
            node.appendChild(btcicon);
            node.appendChild(link);
          }
          if (fontbold) {
            link.style.fontWeight = "bold";
          }
        }

        function doBlockchainStats() {
          loadJson("https://api.blockchair.com/bitcoin/stats", function(response) {
            statsapi = JSON.parse(response);
            console.log(statsapi);
            priceusd = statsapi["data"]["market_price_usd"];

            document.getElementById("blockchain_height").innerText = numeral(statsapi["data"]["best_block_height"]).format('0,0');
            document.getElementById("blockchain_circulation").innerText = numeral(statsapi["data"]["circulation"]/Math.pow(10, 8)).format('0,0.00000000a');
            document.getElementById("blockchain_outputs").innerText = numeral(statsapi["data"]["outputs"]).format('0,0.00a');
            document.getElementById("blockchain_difficulty").innerText = numeral(statsapi["data"]["difficulty"]).format('0,0a');
            document.getElementById("blockchain_hashrate").innerText = numeral(statsapi["data"]["hashrate_24h"]).format('0,0a');
            document.getElementById("blockchain_size").innerText = numeral(statsapi["data"]["blockchain_size"]).format('0,0b');
            document.getElementById("blockchain_blocks").innerText = numeral(statsapi["data"]["blocks_24h"]).format('0,0a');
            document.getElementById("blockchain_transactions").innerText = numeral(statsapi["data"]["transactions_24h"]).format('0,0a');
            addBTC2USDHover(priceusd, "blockchain_inflation", statsapi["data"]["inflation_24h"]);
            addBTC2USDHover(priceusd, "blockchain_volume", statsapi["data"]["volume_24h"]);

            document.getElementById("mempool_transactions").innerText = numeral(statsapi["data"]["mempool_transactions"]).format('0,0a');
            document.getElementById("mempool_size").innerText = numeral(statsapi["data"]["mempool_size"]).format('0,0b');
            document.getElementById("mempool_tps").innerText = numeral(statsapi["data"]["mempool_tps"]).format('0,0.00a');
            document.getElementById("mempool_fee").innerText = numeral(statsapi["data"]["mempool_total_fee_usd"]).format('$0,0a');
            document.getElementById("mempool_output").innerText = numeral(statsapi["data"]["mempool_outputs"]).format('0,0a');

            document.getElementById("txs_count").innerText = numeral(statsapi["data"]["transactions"]).format('0,0a');
            addBTC2USDHover(priceusd, "txs_avgfee", statsapi["data"]["average_transaction_fee_24h"], '0.00000000');
            addBTC2USDHover(priceusd, "txs_medfee", statsapi["data"]["median_transaction_fee_24h"], '0.00000000');

            document.getElementById("txs_sugfee").innerText = statsapi["data"]["suggested_transaction_fee_per_byte_sat"] + " sats/byte";

            document.getElementById("market_price").innerText = numeral(statsapi["data"]["market_price_usd"]).format('$0.00a');
            document.getElementById("market_change").innerText = numeral(statsapi["data"]["market_price_usd_change_24h_percentage"]).format('0.00a') + "%";
            if (statsapi["data"]["market_price_usd_change_24h_percentage"] > 0) {
              document.getElementById("market_change").style.color = "#5cb25e";
            } else if (statsapi["data"]["market_price_usd_change_24h_percentage"] < 0) {
              document.getElementById("market_change").style.color = "#fc580c";
            }
            else {
              document.getElementById("market_change").style.color = "#5b92e5";
            }
            document.getElementById("market_cap").innerText = numeral(statsapi["data"]["market_cap_usd"]).format('$0,0a');
            document.getElementById("market_dominance").innerText = numeral(statsapi["data"]["market_dominance_percentage"]).format('0a') + "%";

            loadJson("https://api.blockchair.com/tools/halvening", function(response) {
              hlvapi = JSON.parse(response);
              console.log(hlvapi);
              document.getElementById("hlvng_currheight").innerText = numeral(hlvapi["data"]["bitcoin"]["current_block"]).format('0,0');
              addBTC2USDHover(priceusd, "hlvng_currreward", hlvapi["data"]["bitcoin"]["current_reward"], '0.000');
              document.getElementById("hlvng_hlvheight").innerText = numeral(hlvapi["data"]["bitcoin"]["halvening_block"]).format('0,0a') + " (" + numeral(hlvapi["data"]["bitcoin"]["blocks_left"]).format('0,0a') + " blocks left)";
              addBTC2USDHover(priceusd, "hlvng_hlvreward", hlvapi["data"]["bitcoin"]["halvening_reward"], '0.000');
              document.getElementById("hlvng_timeest").innerText = timeago.format(Date.now()+hlvapi["data"]["bitcoin"]["seconds_left"]*1000);
            });

          loadJson("https://raw.githubusercontent.com/7h3rAm/datastore/master/bitcoin.json", function(response) {
            bitcoin = JSON.parse(response);
            console.log(bitcoin);

            maxi = 1000;
            if (bitcoin["nodes"].length) {
              var bounds = L.latLngBounds()
              var nodesmap = L.map('nodesmap').setView([0, 0], 1.5);
              var osmlayer = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
              L.tileLayer(osmlayer, {
                attribution: '<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
              }).addTo(nodesmap);
              const size = 15;
              const btcico = L.icon({iconUrl: "https://raw.githubusercontent.com/7h3rAm/datastore/master/Bitcoin_evergreen.png", iconSize: [size, size]})
              const markerOptions = { draggable: true, icon: btcico }
              var tor = 0; var clearnet = 0;
              for (var i = 0; i < bitcoin["nodes"].length; i++) {
                if (bitcoin["nodes"][i]["latitude"] === "Unknown" || bitcoin["nodes"][i]["longitude"] === "Unknown" || bitcoin["nodes"][i]["hostname"] === "Unknown") {
                  continue;
                } else {
                  clearnet += 1;
                  marker = new L.marker([bitcoin["nodes"][i]["latitude"], bitcoin["nodes"][i]["longitude"]], markerOptions);
                  var text = '<a href="https://bitnodes.io/nodes/"><b>' + bitcoin["nodes"][i]["ipurl"] + "</b></a><br/><b>UserAgent</b>: " + bitcoin["nodes"][i]["useragent"] + " (" + bitcoin["nodes"][i]["protoversion"] + ")" + "<br/><b>Height</b>: " + bitcoin["nodes"][i]["height"] + "<br/><b>Connected</b>: " + bitcoin["nodes"][i]["connectedsincehuman"] + " (" + timeago.format(bitcoin["nodes"][i]["connectedsince"]*1000) + ")";
                  marker.bindPopup(text).addTo(nodesmap);
                  bounds.extend([bitcoin["nodes"][i]["latitude"], bitcoin["nodes"][i]["longitude"]]);
                }
                if (clearnet >= maxi) { break; }
              }
              const opt = {
                color: '#000',
                opacity: 0.1,
                fillColor: '#000',
                fillOpacity: 0.3,
                resolution: 2
              };
              const t = L.terminator(opt);
              t.addTo(nodesmap);
              const updateTerminator = function(t) {
                let t2 = L.terminator(opt);
                t.setLatLngs(t2.getLatLngs());
                t.redraw();
              };
              L.control.scale().addTo(nodesmap);
              nodesmap.fitBounds(bounds)
            }

            document.getElementById("count_wallet").style.fontWeight = "bold";
            document.getElementById("count_address").style.fontWeight = "bold";

            document.getElementById("count_wallet").innerText = bitcoin["stats"]["count_wallet"];
            document.getElementById("count_address").innerText = bitcoin["stats"]["count_address"];
            addBTC2USDHover(priceusd, "count_received", bitcoin["stats"]["count_received"], '0,0a', "#5cb25e", isbtc=false, fontbold=true);
            addBTC2USDHover(priceusd, "count_sent", bitcoin["stats"]["count_sent"], '0,0a', "#fc580c", isbtc=false, fontbold=true);
            addBTC2USDHover(priceusd, "count_balance", bitcoin["stats"]["count_balance"], '0,0a', "#5b92e5", isbtc=false, fontbold=true);

            document.getElementById("count_wallet_donation").innerText = bitcoin["stats"]["donation"]["count_wallet"];
            document.getElementById("count_address_donation").innerText = bitcoin["stats"]["donation"]["count_address"];
            addBTC2USDHover(priceusd, "count_received_donation", bitcoin["stats"]["donation"]["count_received"], '0,0a', "#5cb25e", isbtc=false);
            addBTC2USDHover(priceusd, "count_sent_donation", bitcoin["stats"]["donation"]["count_sent"], '0,0a', "#fc580c", isbtc=false);
            addBTC2USDHover(priceusd, "count_balance_donation", bitcoin["stats"]["donation"]["count_balance"], '0,0a', "#5b92e5", isbtc=false);

            document.getElementById("count_wallet_popular").innerText = bitcoin["stats"]["popular"]["count_wallet"];
            document.getElementById("count_address_popular").innerText = bitcoin["stats"]["popular"]["count_address"];
            addBTC2USDHover(priceusd, "count_received_popular", bitcoin["stats"]["popular"]["count_received"], '0,0a', "#5cb25e", isbtc=false);
            addBTC2USDHover(priceusd, "count_sent_popular", bitcoin["stats"]["popular"]["count_sent"], '0,0a', "#fc580c", isbtc=false);
            addBTC2USDHover(priceusd, "count_balance_popular", bitcoin["stats"]["popular"]["count_balance"], '0,0a', "#5b92e5", isbtc=false);

            document.getElementById("count_wallet_ransom").innerText = bitcoin["stats"]["ransom"]["count_wallet"];
            document.getElementById("count_address_ransom").innerText = bitcoin["stats"]["ransom"]["count_address"];
            addBTC2USDHover(priceusd, "count_received_ransom", bitcoin["stats"]["ransom"]["count_received"], '0,0a', "#5cb25e", isbtc=false);
            addBTC2USDHover(priceusd, "count_sent_ransom", bitcoin["stats"]["ransom"]["count_sent"], '0,0a', "#fc580c", isbtc=false);
            addBTC2USDHover(priceusd, "count_balance_ransom", bitcoin["stats"]["ransom"]["count_balance"], '0,0a', "#5b92e5", isbtc=false);

            function add_category_table(category, categorynode) {
              var thead = document.createElement("thead");
              var tr = document.createElement("tr");
              //var th = document.createElement("th"); var text = document.createTextNode("#"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("VisSum"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("Wallet"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              //var th = document.createElement("th"); var text = document.createTextNode("Funds"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("Received"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("Sent"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("Balance"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              var th = document.createElement("th"); var text = document.createTextNode("LastActivity"); th.appendChild(text); th.style.fontWeight = "bold"; tr.appendChild(th);
              thead.appendChild(tr);
              categorynode.appendChild(thead);
              var tbody = document.createElement("tbody");
              var i = 0;
              Object.keys(bitcoin["category"][category]).forEach(function(wallet) {
                if (bitcoin["category"][category][wallet]["txcount"] > 0) {
                  var tr = document.createElement("tr");
                  //var td = document.createElement("td");
                  //var text = document.createTextNode(i+1 + ".");
                  //td.appendChild(text);
                  //tr.appendChild(td);
                  var td = document.createElement("td");
                  var span = document.createElement("span")
                  span.setAttribute("class", "sparklines");
                  var text = document.createTextNode(bitcoin["category"][category][wallet]["sparkid"]);
                  span.appendChild(text);
                  colorspark(span);
                  td.appendChild(span);
                  tr.appendChild(td);
                  var td = document.createElement("td");
                  var link = document.createElement("a");
                  var text = document.createTextNode(truncateWithEllipses(wallet, 60));
                  link.appendChild(text);
                  var addr = bitcoin["category"][category][wallet]["addresses"].length > 1 ? "addresses" : "address";
                  var txs = bitcoin["category"][category][wallet]["txcount"] > 1 ? "transactions" : "transaction";
                  link.title = "'" + wallet + "' wallet has " + bitcoin["category"][category][wallet]["addresses"].length + " " + addr + " with " + numeral(bitcoin["category"][category][wallet]["txcount"]).format('0,0a') + " " + txs + ".";
                  link.style.color = "#000000";
                  td.appendChild(link);
                  tr.appendChild(td);

                  //var td = document.createElement("td");
                  //td.setAttribute("data-sort", bitcoin["category"][category][wallet]["balance"]);
                  //addBTC2USDHover(priceusd, td, bitcoin["category"][category][wallet]["received"], '0.00000000', "#5cb25e", isbtc=false); var para = document.createElement("p"); td.append(para);
                  //addBTC2USDHover(priceusd, td, bitcoin["category"][category][wallet]["sent"], '0.00000000', "#fc580c", isbtc=false); var para = document.createElement("p"); td.append(para);
                  //addBTC2USDHover(priceusd, td, isNaN(numeral(bitcoin["category"][category][wallet]["balance"]).format('0'))? 0 : bitcoin["category"][category][wallet]["balance"], '0.00000000', "#5b92e5", isbtc=false); var para = document.createElement("p"); td.append(para);
                  //tr.appendChild(td);

                  var td = document.createElement("td");
                  td.setAttribute("data-sort", bitcoin["category"][category][wallet]["received"]);
                  addBTC2USDHover(priceusd, td, bitcoin["category"][category][wallet]["received"], '0.00000000', "#5cb25e", isbtc=false);
                  tr.appendChild(td);

                  var td = document.createElement("td");
                  td.setAttribute("data-sort", bitcoin["category"][category][wallet]["sent"]);
                  addBTC2USDHover(priceusd, td, bitcoin["category"][category][wallet]["sent"], '0.00000000', "#fc580c", isbtc=false);
                  tr.appendChild(td);

                  var td = document.createElement("td");
                  td.setAttribute("data-sort", bitcoin["category"][category][wallet]["balance"]);
                  addBTC2USDHover(priceusd, td, isNaN(numeral(bitcoin["category"][category][wallet]["balance"]).format('0'))? 0 : bitcoin["category"][category][wallet]["balance"], '0.00000000', "#5b92e5", isbtc=false);

                  tr.appendChild(td);

                  var td = document.createElement("td");
                  if (bitcoin["category"][category][wallet]["lasttx"]["epoch"]) {
                    var summary = document.createElement("span");
                    if (bitcoin["category"][category][wallet]["lasttx"]["summary"] > 0) {
                      addBTC2USDHover(priceusd, summary, bitcoin["category"][category][wallet]["lasttx"]["summary"], '0.00000000', "#5cb25e", isbtc=false);
                    } else if (bitcoin["category"][category][wallet]["lasttx"]["summary"] < 0) {
                      addBTC2USDHover(priceusd, summary, bitcoin["category"][category][wallet]["lasttx"]["summary"], '0.00000000', "#fc580c", isbtc=false);
                    } else {
                      addBTC2USDHover(priceusd, summary, bitcoin["category"][category][wallet]["lasttx"]["summary"], '0.00000000', "#5b92e5", isbtc=false);
                    }
                    td.appendChild(summary);
                    td.setAttribute("data-sort", bitcoin["category"][category][wallet]["lasttx"]["epoch"]);
                    var para = document.createElement("p"); td.append(para);
                    var link = document.createElement("a");
                    link.title = bitcoin["category"][category][wallet]["lasttx"]["epochhuman"];
                    link.text = "üîó " + timeago.format(bitcoin["category"][category][wallet]["lasttx"]["epoch"]*1000);
                    link.href = "https://mempool.space/tx/" + bitcoin["category"][category][wallet]["lasttx"]["hash"];
                    td.appendChild(link);
                  } else {
                    var text = document.createTextNode("");
                    td.setAttribute("data-sort", 0);
                    td.appendChild(text);
                  }
                  tr.appendChild(td);
                  tbody.appendChild(tr);
                  i = i+1;
                }
                categorynode.appendChild(tbody);
              })
            }
            var donationtable = document.getElementById("donationtable"); add_category_table("donation", donationtable);
            var populartable = document.getElementById("populartable"); add_category_table("popular", populartable);
            var ransomtable = document.getElementById("ransomtable"); add_category_table("ransom", ransomtable);
            var statstable = document.getElementById("statstable");
            var statssort = new Tablesort(statstable);
            statssort.refresh();
            var donationtable = document.getElementById("donationtable");
            var donationsort = new Tablesort(donationtable);
            donationsort.refresh();
            var populartable = document.getElementById("populartable");
            var popularsort = new Tablesort(populartable);
            popularsort.refresh();
            var ransomtable = document.getElementById("ransomtable");
            var ransomsort = new Tablesort(ransomtable);
            ransomsort.refresh();

            // last updated timestamp
            document.getElementById("lastupdate").innerText = "Last Update: " + bitcoin["last_update"];
          });
          });
        }

        // https://stackoverflow.com/a/54248600/1079836
        function colorspark(element) {
          var colors = ["#007bff", "#00bcd4", "#17a2b8", "#20c997", "#2196f3", "#28a745", "#4caf50", "#6610f2", "#6c757d", "#6f42c1", "#8357ff", "#dc3545", "#e83e8c", "#f44336", "#fd7e14", "#ffc107", "#20b2aa", "#99cc99", "#0c9", "#5b92e5", "#ffcc66", "#00b7eb", "#69359c", "#fe4164", "#a50b5e"];
          var text = element.innerText;
          element.innerText = '';
          var chars = text.split('');
          for(var ch of chars) {
             var charspan = document.createElement('span');
             charspan.innerText = ch;
             var index = Math.floor(Math.random()*colors.length);
             charspan.style.color = colors[index]
             element.appendChild(charspan);
          }
        }

        window.onload = () => {
          //setInterval(() => {doTime();},1000); // every .5s
          doBlockchainStats();
        }
      </script>

      </div>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h3")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if (t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if (i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if (a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
      </div>
      <div><a class="footer" href="https://github.com/7h3rAm/7h3rAm.github.io">Óäë Óäê Óäó</a></div>
    </div>
  </body>
</html>
