<!DOCTYPE html>
<html lang="en" data-theme-mode="light">
<head>
  <meta charset="utf-8">
  <meta name="author" content="Ankur Tyagi (7h3rAm)">
  <meta name="description" content="Personal Weblog">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Manthan</title>
  <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp">
  <link rel="stylesheet" href="/static/css/base.css">
  <link rel="stylesheet" href="/static/css/atelier-forest-light.css">
  <script src="/static/js/theme.js"></script>
  <script src="/static/js/highlight.min.js"></script>
  <script src="/static/js/hljs-bash.min.js"></script>
  <script src="/static/js/hljs-python.min.js"></script>
  <script src="/static/js/hljs-sql.min.js"></script>
  <script src="/static/js/hljs-powershell.min.js"></script>
  <script src="/static/js/hljs-line-numbers.min.js"></script>
</head>
<body>

<header>
  <div class="header-top">
    <div class="title-wrapper">
      <h1 class="site-title"><a href="/" style="color:inherit;text-decoration:none;">manthan</a></h1>
      <span class="meta">security research | code | writeups</span>
    </div>
    <div class="nav-and-toggles">
      <div class="nav-links">
        <a href="/archive.html">archive</a>
        <a href="/tags.html">tags</a>
        <a href="/stats.html">stats</a>
      </div>
      <div class="toggle-buttons">
        <button class="toggle-btn toggle-theme" onclick="toggleThemeMode()">&#xf05a8;</button>
        <button class="toggle-btn toggle-density" onclick="toggleDensity()">&#xf084f;</button>
        <button class="toggle-btn toggle-width" onclick="toggleWidth()">&#xf084e;</button>
        <button class="toggle-btn toggle-justify" onclick="toggleJustify()">&#xf039;</button>
        <button class="toggle-btn toggle-collapse" onclick="toggleAllSections()">&#xf151;</button>
      </div>
    </div>
  </div>
</header>

<article id="top">
  <div class="post-header">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <div>
        <h1 class="post-title" style="margin:0; cursor:pointer;" onclick="toggleAllSections()">Northrop's Online Challenge</h1>
      </div>
      <div class="meta" style="text-align:right;">
        <div>27/Mar/2014</div>
        <div class="tags"><a href="/tags.html#code">code</a>, <a href="/tags.html#ctf">ctf</a></div>
      </div>
    </div>
    
  </div>

  <div class="content">
    <h2 class="h2 collapsible" onclick="toggle(this);">Introduction</h2>
<p class="nested active">A while back I was checking out the <a href="http://www.reddit.com/r/netsec/comments/1ubzv9/rnetsecs_q1_2014_information_security_hiring/">/r/netsec's Q1 2014 Information Security Hiring Thread</a> at Reddit and there I found an interesting challenge posted by someone from Northrop Grumman Cyber Intelligence Division. They were looking for people with interesting skills (IDS/IPS, Big Data, web app development, etc.) and mentioned that candidates solving their <a href="https://googledrive.com/host/0B7WgiVv_ihnhX1VRWHVXZmZmMW8/challengeWebpage.html">online challenge</a> will be preferred. I find such challenges really interesting and immediately got on top of it. A few hours later I solved it and decided to write about the process. This post details steps I took and lessons learned.</p>
<h2 class="h2 collapsible" onclick="toggle(this);">Research and Testing</h2>
<p class="nested active">The online challenge page looks something like this:</p>
<p class="nested active"><img alt="onlinechallenge.png" src="/static/files/posts_northrop_challenge/onlinechallenge.png.webp" /></p>
<p class="nested active">It includes a <code>.png</code> image which, as mentioned, contains a hidden message that has to be found to solve the challenge. Here is the challenge image for your reference:</p>
<p class="nested active"><img alt="cryptImg.png" src="/static/files/posts_northrop_challenge/cryptImg.png.webp" /></p>
<p class="nested active">The first thing I did upon opening up this page was looking at its source. In there I found an <code>iframe</code> with a <code>png</code> file embedded in it. The <code>iframe</code> had a comment preceding it: <code>A frame for my key</code>. This suggested that the embedded image is a key of some kind that has to be used in the challenge. I immediately extracted it and here it is (in actual dimensions: 128x96):</p>
<p class="nested active"><img alt="key.png" src="/static/files/posts_northrop_challenge/key.png.webp" /></p>
<p class="nested active">There was also a hint in the page, a link to <a href="http://www.pythonware.com/products/pil/">Python Imaging Library (PIL)</a>, which suggested that some image manipulation would be needed to find the hidden message. Before exploring the python library I thought of spending some time with the challenge image itself, though not exactly sure of what I was looking for. The image seemed to have sections in it, actually a grid like structure, comprising of 5x5 cells (ie. a total of 25 sections). Interestingly, the key image is exactly 1/5th the size of challenge image. I immediately had the idea that the base image might be mutated with key image operating on each of its 25 sections individually. This mutation created a seemingly gibberish image with lots of noise but failed to hide the algorithm's cellular structure. The only unknown at this time was the mutation algorithm, which I assumed to be XOR. I immediately crafted a poc to test this hypothesis. It downloads the <code>.html</code> webpage, the <code>.png</code> challenge image, extract <code>.png</code> key file and performs a XOR between the challenge and the key image, on a per cell fashion, rounding up the start of each cell with the start of the key file. Once this operation is completed over all 25 cells, the decoded image will be saved as a <code>.png</code> to disk. Here is a test run:</p>
<pre class="nested active"><code class="language-python">$ ./cry.py

[+] Downloading challenge webpage: https://googledrive.com/host/0B7WgiVv_ihnhX1VRWHVXZmZmMW8challengeWebpage.html ...
[+] Downloading basefile: https://googledrive.com/host/0B7WgiVv_ihnhX1VRWHVXZmZmMW8/cryptImg.png ...
[+] Extracting keyfile: key.png ...

[+] cryptImg.png: (RGB, (640, 480))
[+] key.png: (RGBA, (128, 96))

[+] Decoding basefile: cryptImg.png XOR keyfile: key.png ...
[+] Decoding complete! Saved to decoded.png: (RGB, (640, 480))
</code></pre>
<p class="nested active">And here is the <code>decoded.png</code> image file:</p>
<p class="nested active"><img alt="decoded.png" src="/static/files/posts_northrop_challenge/decoded.png.webp" /></p>
<h2 class="h2 collapsible" onclick="toggle(this);">Conclusion</h2>
<p class="nested active">This indeed was an interesting challenge and a one that proved to be good source of learning. Stay tuned for more writeups on similar topics.</p>
  </div>

  <nav class="post-nav" style="margin-top:1em;">
    <a class="nav-prev" href="/posts/20140318_shellcode-pipeline.html"><span class="arrow">&lt;&lt;&lt;</span> <span class="nav-title">Shellcode Analysis Pipleine</span></a>    <a class="nav-next" href="/posts/20140506_confidence-ds-ctf-stego50.html"><span class="nav-title">CONFidence DS CTF Teaser: Stegano50</span> <span class="arrow">&gt;&gt;&gt;</span></a>  </nav>
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var content = document.querySelector('.content');
  if (content) {
    var headings = content.querySelectorAll('h2,h3,h4,h5,h6');
    headings.forEach(function(h) {
      var link = document.createElement('a');
      link.href = '#top';
      link.className = 'top-link';
      link.textContent = ' [^]';
      link.style.fontSize = '0.8em';
      link.style.color = 'var(--muted)';
      h.appendChild(link);
    });
  }
});
</script>

<footer>
  <p class="nested active">cc-by-sa-4.0</p>
</footer>

<script>hljs.configure({ignoreUnescapedHTML: true}); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>
</body>
</html>