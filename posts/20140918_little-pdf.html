<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=author content="Ankur Tyagi (@7h3rAm)"><meta name=description content="Personal Weblog"><meta content="width=device-width, initial-scale=1" name=viewport><title>‡§Æ‡§Ç‡§•‡§® | Mannthan</title><link href=/static/images/mannthan-32x32.png.webp sizes=32x32 rel=icon type=image/webp><script src=/static/js/highlight.min.js></script><script src=/static/js/highlightjs-line-numbers.min.js></script><script charset=UTF-8 src=/static/js/go.min.js></script><link rel=stylesheet href=/static/css/github-gist.min.css><link rel=stylesheet type=text/css href=/static/css/style.md.post.css media=screen></head><body><div class=header><table><tr><td><a href=/index.html style="color:#fe4164; font-size:14pt;">üè° ‡§Æ‡§Ç‡§•‡§® </a></td><td><a href=/archive.html style="color:#f90; font-size:14pt;">üíæ Archive </a></td><td><a href=/tags.html style="color:#69359c; font-size:14pt;">üîñ Tags </a></td><td><a href=/stats.html style="color:#20b2aa; font-size:14pt;">üìä Stats</a></td></tr></table></div><div class=body><h1 class="h1 collapsible" onclick=toggle(this);>Little PDF Puzzle from Didier Stevens</h1><p><a href=/posts/20140618_pcapgentools-contentype-patch.html> ¬´ </a>üìÖ published on <code>18/Sep/2014</code><a href=/posts/20141115_pcapedit.html> ¬ª </a></p><h2 class="h2 collapsible" onclick=toggle(this);>Introduction</h2><p class=nested>While reading an article about <a href=http://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/ >Physical and Logical Structure of PDF Files</a> on Didier Stevens's blog, I came across an interesting <a href=http://blog.didierstevens.com/2008/05/06/a-little-pdf-puzzle/ >puzzle</a>. You can download the <a href=/static/files/posts_little_pdf/pdf-puzzle.pdf>file</a> to follow along or read the <a href=http://blog.didierstevens.com/2008/05/07/solving-a-little-pdf-puzzle/ >writeup</a> from the author itself.</p><h2 class="h2 collapsible" onclick=toggle(this);>Challenge Analysis and Testing</h2><p class=nested>Still here, great! Let's get started. First thing is to check what <code>exiftool</code> has to tell us about this file:</p><pre class=nested><code>$ exiftool pdf-puzzle.pdf
ExifTool Version Number         : 9.46
File Name                       : pdf-puzzle.pdf
Directory                       : .
File Size                       : 1243 bytes
File Modification Date/Time     : 2014:09:18 17:00:16+05:30
File Access Date/Time           : 2014:09:18 17:00:19+05:30
File Inode Change Date/Time     : 2014:09:18 17:00:16+05:30
File Permissions                : rw-rw-r--
File Type                       : PDF
MIME Type                       : application/pdf
PDF Version                     : 1.1
Linearized                      : No
Page Count                      : 1
</code></pre><p class=nested>All these attributes look standard and nothing suspicious pops out in the output. The author, Didier Stevens, hints that it is a simple challenge and can be solved using just Notepad or a standard PDF reader. Let's view contents of this file in a text editor:</p><p class=nested><img alt=littlepdf-texteditor src=/static/files/posts_little_pdf/littlepdf-texteditor.png.webp></p><p class=nested>If you have not read Didier Stevens's <a href=http://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/ >Physical and Logical Structure of PDF Files</a> post I strongly recommend reading it before reading further. It will help you identify something out of the ordinary in above output. There are two copies of xref table and trailer in this file hinting that it is probably a PDF with <a href=https://en.wikipedia.org/wiki/Portable_Document_Format#File_structure>Incremental Updates</a>. The new content (after the first <code>%%EOF</code>) has redefined object 5 and updated the xref table to help renders know its new offset. If you open this file in a PDF viewer, you will see something like this:</p><p class=nested><img alt=littlepdf-pdfjs src=/static/files/posts_little_pdf/littlepdf-pdfjs.png.webp></p><p class=nested>The reader is using updated object and renders its content, thus overriding the older object definition. Since both object definitions contain <code>ASCII85Decode</code> encoded streams, we can manually decode and look at the raw content:</p><pre class=nested><code class=python>$ ipython --no-banner

&gt;&gt;&gt; import ascii85
&gt;&gt;&gt;
&gt;&gt;&gt; ascii85.ascii85decode(&quot;'\7PQ#@1a#b0+&gt;GQ(+?(u.+B2ko-rakk+E1b1F)Yf5@&lt;6!&amp;BlbD!=BJ[-=BJ[-=BJ[-=BJ[-=BI!p&lt;,*OE;u~&quot;)
'\x14h\xd5&quot;4 Tf 100 700 Td (The passphrase is XXXXXXXXXXXXXXXXXXX) Tj ET'
&gt;&gt;&gt;
&gt;&gt;&gt; ascii85.ascii85decode(&quot;'\7PQ#@1a#b0+&gt;GQ(+?(u.+B2ko-rakk+E1b1F)Yf5@&lt;6!&amp;BlbCgDI[]uD.RU,@;I&amp;dE+EC!ATK:C&lt;,*OE;u~&quot;)
'\x14h\xd5&quot;4 Tf 100 700 Td (The passphrase is Incremental Updates) Tj ET'
&gt;&gt;&gt;
</code></pre><h2 class="h2 collapsible" onclick=toggle(this);>Conclusion</h2><p class=nested>Awesome! The older object stream, when decoded (I'm using the ascii85 decoder from <a href=https://github.com/euske/pdfminer/blob/master/pdfminer/ascii85.py>pdfminer</a>), shows the passphrase. As suggested by Didier Stevens in his <a href=http://blog.didierstevens.com/2008/05/07/solving-a-little-pdf-puzzle/ >writeup</a>, you could also remove the updated object content and xref table from the file to view the passphrase.</p><p style=text-align:center;>(üîñ tagged <a href=/tags.html#ctf>ctf</a> and <a href=/tags.html#reversing>reversing</a>)</p><p style=text-align:center;>¬´ <a href=/posts/20140618_pcapgentools-contentype-patch.html>PCAP-GenerationTools and Conte...</a> ¬´ | ¬ª <a href=/posts/20141115_pcapedit.html>pcapedit: An Interactive Scapy...</a> ¬ª</p></div><script>hljs.initHighlightingOnLoad();</script><script>hljs.initLineNumbersOnLoad();</script><script>function toggle(s){s.classList.toggle("expanded");var t=!1,i=!1,a=!1;s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0),console.log(s),console.log(t),console.log(i),console.log(a);for(var l=s.nextElementSibling;l;){if(t&&l.classList.contains("h2")){l.classList.toggle("active");break}if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){l.classList.toggle("active");break}if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){l.classList.toggle("active");break}l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling}}</script><div class=footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=license><img src=/static/files/ccbysa4.svg></a></p></div></body></html>