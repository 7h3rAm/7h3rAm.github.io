<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="Ankur Tyagi (@7h3rAm)"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>मंथन | Manthan</title>
    <link rel="icon" type="image/webp" sizes="32x32" href="/static/images/manthan-32x32.png.webp"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css"/>
    <link id="codestylesheet" rel="stylesheet" type="text/css" media="screen" href="/static/css/atelier-forest-light.css">
    <script charset="UTF-8" src="/static/js/highlight.min.js"></script>
    <script charset="UTF-8" src="/static/js/highlightjs-line-numbers.min.js"></script>
    <script charset="UTF-8" src="/static/js/go.min.js"></script>
   </head>
  <body>
    <div class="body">
      <div class="menu">
        <table>
          <tr>
            <td colspan="3"><a class="menu_home" href="/index.html">मंथन</a></td>
          </tr>
          <tr>
            <td><a class="menu_archive" href="/archive.html">💾 Archive</a></td>
            <td><a class="menu_tags" href="/tags.html">🔖 Tags</a></td>
            <td><a class="menu_stats" href="/stats.html">📊 Stats</a></td>
            <!--<td>-->
            <!--  <label class="theme-switch" for="checkbox">-->
            <!--    <input type="checkbox" id="checkbox" />-->
            <!--    <div class="slider round"></div>-->
            <!--  </label>-->
            <!--</td>-->
          </tr>
        </table>
      </div>
      <div class="content">
          <h1 class="h1 title collapsible" onclick="toggle(this);">Visualizing (non-POSIX) Regular Expressions</h1>
    <div class="title"><code><span class="sparklines"><span style="color:#e83e8c;">█</span><span style="color:#2196f3;">▄</span><span style="color:#a50b5e;">▄</span><span style="color:#fd7e14;">▂</span><span style="color:#69359c;">▃</span><span style="color:#20b2aa;">▇</span><span style="color:#dc3545;">▄</span><span style="color:#2196f3;">▅</span><span style="color:#4caf50;">▆</span><span style="color:#007bff;">▆</span><span style="color:#e83e8c;">▄</span><span style="color:#0c9;">▁</span><span style="color:#dc3545;">▃</span><span style="color:#28a745;">▃</span><span style="color:#20c997;">▃</span><span style="color:#e83e8c;">▄</span><span style="color:#4caf50;">▁</span><span style="color:#e83e8c;">▅</span><span style="color:#6610f2;">▇</span><span style="color:#99cc99;">▃</span><span style="color:#e83e8c;">▁</span><span style="color:#ffcc66;">▂</span><span style="color:#00bcd4;">▃</span><span style="color:#2196f3;">▄</span><span style="color:#dc3545;">▂</span><span style="color:#2196f3;">▆</span><span style="color:#20b2aa;">▁</span><span style="color:#fe4164;">▆</span><span style="color:#69359c;">▂</span><span style="color:#ffcc66;">▁</span><span style="color:#f44336;">▇</span><span style="color:#4caf50;">▅</span><span style="color:#e83e8c;">▇</span><span style="color:#8357ff;">▃</span><span style="color:#00b7eb;">█</span><span style="color:#4caf50;">▆</span><span style="color:#99cc99;">▆</span><span style="color:#17a2b8;">█</span><span style="color:#99cc99;">▅</span><span style="color:#20b2aa;">▅</span><span style="color:#dc3545;">▅</span><span style="color:#e83e8c;">▁</span><span style="color:#4caf50;">▃</span><span style="color:#69359c;">▂</span><span style="color:#2196f3;">▇</span><span style="color:#6f42c1;">▃</span><span style="color:#e83e8c;">█</span><span style="color:#ffcc66;">▆</span><span style="color:#8357ff;">▇</span><span style="color:#e83e8c;">▂</span><span style="color:#ffc107;">█</span><span style="color:#5b92e5;">▂</span><span style="color:#6f42c1;">▅</span><span style="color:#fe4164;">▇</span><span style="color:#5b92e5;">█</span><span style="color:#20b2aa;">▇</span><span style="color:#fd7e14;">▅</span><span style="color:#ffc107;">▇</span><span style="color:#ffc107;">▅</span><span style="color:#ffcc66;">▆</span><span style="color:#5b92e5;">▁</span><span style="color:#69359c;">▁</span><span style="color:#2196f3;">▆</span><span style="color:#ffc107;">▄</span></span></code></div>
    <hr>
          <p style="float:left;"><a href="/posts/20130915_libnids-python-ids.html"> « </a>📅 published on <code>27/Nov/2013</code><a href="/posts/20140106_buf0-challenge.html"> » </a></p>
        <p style="float:right;">🔖 tagged <a href=/tags.html#code>code</a></p>
    <div style="clear:both;"></div>
    <hr><h2 class="h2 collapsible" onclick="toggle(this);">Introduction</h2>
<p class="nested active">I recently came across the <a href="http://www.osteele.com/software/python/fsa/">pyFSA</a> project and played with it for sometime. It includes a built-in API to render finite state machines as <a href="http://www.graphviz.org/doc/info/lang.html">dotstring</a>. Regular expressions can be represented as FSMs and then be rendered to a dot-string for visual introspection. I quickly wrote a proof-of-concept tool to implement this idea and hence <a href="https://github.com/7h3rAm/re2dotgraph">re2dotgraph</a> was born.</p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Installation and Testing</h2>
<p class="nested active">First, the pyFSA module has to be installed. Download the package, unzip it and follow the standard Python module installation steps:</p>
<pre class="nested active"><code>$ python setup.py build
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying FSA.py -&gt; build/lib.linux-x86_64-2.7
copying NumFSAUtils.py -&gt; build/lib.linux-x86_64-2.7
copying FSChartParser.py -&gt; build/lib.linux-x86_64-2.7
copying reCompiler.py -&gt; build/lib.linux-x86_64-2.7
$
$ sudo python setup.py install
running install
running build
running build_py
running install_lib
copying build/lib.linux-x86_64-2.7/FSChartParser.py -&gt; /usr/local/lib/python2.7/dist-packages
copying build/lib.linux-x86_64-2.7/FSA.py -&gt; /usr/local/lib/python2.7/dist-packages
copying build/lib.linux-x86_64-2.7/reCompiler.py -&gt; /usr/local/lib/python2.7/dist-packages
copying build/lib.linux-x86_64-2.7/NumFSAUtils.py -&gt; /usr/local/lib/python2.7/dist-packages
byte-compiling /usr/local/lib/python2.7/dist-packages/FSChartParser.py to FSChartParser.pyc
byte-compiling /usr/local/lib/python2.7/dist-packages/FSA.py to FSA.pyc
byte-compiling /usr/local/lib/python2.7/dist-packages/reCompiler.py to reCompiler.pyc
byte-compiling /usr/local/lib/python2.7/dist-packages/NumFSAUtils.py to NumFSAUtils.pyc
running install_data
warning: install_data: setup script did not provide a directory for 'README.txt' -- installing right in '/usr/local'

copying README.txt -&gt; /usr/local
warning: install_data: setup script did not provide a directory for 'LICENSE.txt' -- installing right in '/usr/local'

error: can't copy 'LICENSE.txt': doesn't exist or not a regular file
</code></pre>
<p class="nested active">Ignore the <code>LICENSE.txt</code> copy error. Now you need to install the <code>graphviz</code> package which includes the <code>dot</code> tool useful in rendering <code>.dot</code> files into images. Once the dependencies are successfully installed, you can use <code>re2dotgraph</code> and test it with a sample regex:</p>
<pre class="nested active"><code>$ ./re2dotgraph.py 'a*b?c+'

[+] Generating dot string ...
[+] Label: a*b?c+
[+] states: [0, 1, 2]
[+] states count: 3
[+] initialState: 0
[+] finalStates: [2]
[+] alphabet: None
[+] transitions:
        (0, 0, &lt;CharacterSet a&gt;)
        (0, 1, &lt;CharacterSet b&gt;)
        (0, 2, &lt;CharacterSet c&gt;)
        (1, 2, &lt;CharacterSet c&gt;)
        (2, 2, &lt;CharacterSet c&gt;)

[+] Generating dot graph ...
[+] regex: 'a*b?c+' -&gt; regex.png
</code></pre>
<p class="nested active">The input regex is represented using a FSM which is then rendered to a <code>dot</code> file. This <code>dot</code> file is then rendered to an image name <code>regex.png</code> (name can be changed by passing a custom value as the second argument) using the installed <code>dot</code> program, called natively from inside Python runtime using the <code>os.system</code> method. Here is how the graph looks like:</p>
<p class="nested active"><img alt="image" src="/static/files/posts_regex_to_dotgraph/regex1.png.webp" /></p>
<p class="nested active">I would like to point out that representing regular expressions as FSMs is really tricky. There are certain aspects of a regex that can never be represented (like backreferences and lookaheads) due to the fact that FSMs don't have memory to keep note of what was matched previously. This highlights the fact that any regexes, with backreferences or lookaheads won't be rendered correctly. Also, the pyFSA page mentions that the project currently is not fully compliant with POSIX regex guidelines. This severely limits the real-world use-cases:</p>
<pre class="nested active"><code>$ ./re2dotgraph.py 'a\dc'

[+] Generating dot string ...
[+] Label: a\dc
[+] states: [2, 0, 3, 1]
[+] states count: 4
[+] initialState: 0
[+] finalStates: [3]
[+] alphabet: None
[+] transitions:
        (0, 1, &lt;CharacterSet a&gt;)
        (1, 2, &lt;CharacterSet \d&gt;)
        (2, 3, &lt;CharacterSet c&gt;)

[+] Generating dot graph ...
[+] regex: 'a\dc' -&gt; regex.png
</code></pre>
<p class="nested active">And here's the generated image:</p>
<p class="nested active"><img alt="image" src="/static/files/posts_regex_to_dotgraph/regex2.png.webp" /></p>
<hr><h2 class="h2 collapsible" onclick="toggle(this);">Conclusion</h2>
<p class="nested active">As is evident from the above image, the <code>\d</code> escape sequence was not identified and the graph as such is incorrect. However, this still is an interesting project and a really easy way of visualizing regular expressions. For POSIX compliant solutions, refer these projects: <a href="http://regexvisualizer.apphb.com/">RegExVis</a>, <a href="https://www.debuggex.com/">Debuggex</a> and <a href="http://www.regexper.com/">Regexper</a></p>
<p class="nested active">You can get the source files through the project repository on <a href="https://github.com/7h3rAm/re2dotgraph">GitHub</a>.</p>
    <hr>
          <p style="float:left;">« <a href="/posts/20130915_libnids-python-ids.html">Developing a Minimal IPS from ...</a> «</p>
      <p style="float:right;">» <a href="/posts/20140106_buf0-challenge.html">buf0 - A Buffer Overflow Chall...</a> »</p>
          </div>
      <div><a class="footer" href="https://github.com/7h3rAm/7h3rAm.github.io">  </a></div>
      <script>hljs.initHighlightingOnLoad();</script>
      <script>hljs.initLineNumbersOnLoad();</script>
      <script>
        function toggle(s){
          s.classList.toggle("expanded");
          var t=!1,i=!1,a=!1;
          s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0);
          for(var l=s.nextElementSibling;l;){
            if(t&&l.classList.contains("h2")){
              l.classList.toggle("active");
              break
            }
            if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){
              l.classList.toggle("active");
              break
            }
            if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){
              l.classList.toggle("active");
              break
            }
            l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling
          }
        }
      </script>
      <script type="text/javascript">
        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
        const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
        if (currentTheme) {
          document.documentElement.setAttribute('data-theme', currentTheme);
          if (currentTheme === 'dark') {
            toggleSwitch.checked = true;
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/zenburn.min.css');
            localStorage.setItem('theme', 'dark');
          } else {
            toggleSwitch.checked = false;
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/atelier-forest-light.css');
            localStorage.setItem('theme', 'light');
          }
          console.log("pageload: theme:" + currentTheme + " switch:" + toggleSwitch.checked);
        }
        function switchTheme(e) {
          if (e.target.checked) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/zenburn.min.css');
            localStorage.setItem('theme', 'dark');
          } else {
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('codestylesheet').setAttribute('href', '/static/css/atelier-forest-light.css');
            localStorage.setItem('theme', 'light');
          }    
          const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
          const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
          console.log("pageload: theme:" + currentTheme + " switch:" + toggleSwitch.checked);
        }
        toggleSwitch.addEventListener('change', switchTheme, false);
      </script>
    </div>
  </body>
</html>