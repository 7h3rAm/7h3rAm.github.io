<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="7h3rAm"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Grey Matter</title>
    <link href="/static/css/main.css" rel="stylesheet" type="text/css">
    <link href="/static/css/codehilite/zenburn.css" rel="stylesheet" type="text/css">
    <link href="/static/images/favicon-32x32.png" sizes="32x32" rel="icon" type="image/png"/>
  </head>
  <body>
    <section id="content" class="body">
              <div class="header">
          <table>
            <tr>
              <td class="blogtitle"><a href="/">Grey Matter</a></td>
              <td class="blognavbar">
                <a href="/archive.html">[Archive]</a> <a href="/tags.html">[Tags]</a> <a href="/research.html">[Research]</a></a>
              </td>
            </tr>
          </table>
        </div>
                  <article class="post">
  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default section compact">
        <div class="body">
          <p class="heading">Flowinspect: A Network Inspection Tool</p>
                                                                                                                                                                                                                                                                                                                <p class="date">
                  <a href="/2014/pcapedit.html">&lt&lt;</a> published on 27/Nov/2014<a href="/2015/chopshop-shellcode.html"> &gt;&gt;</i></a><br/>
                </p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="post-content">
          <p>For last couple of months I&#8217;ve been working on a network inspection tool, Flowinspect. I was honored to be able to present it at <a href="http://nullcon.net/website/goa-14/speakers/ankur-tyagi.php">Nullcon 2014</a> and <a href="https://www.blackhat.com/us-14/arsenal.html#Tyagi">Black Hat USA 2014 Arsenal</a>. It started as an internal tool that proved useful for me and my colleagues at Juniper Networks for our signature development tasks. However, within just few months of inception, it started taking shape of a generic network inspection utility that allows automation of a number of tasks. It is opensource, released under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a> license terms and available on <a href="https://github.com/7h3rAm/flowinspect">Github</a>.</p>

<p>At its core, Flowinspect uses <a href="http://libnids.sourceforge.net/">libnids</a> and its Python binding <a href="http://jon.oberheide.org/pynids/">pynids</a> to defragment IP and reassemble TCP packets. The result of this operation results in the generation of a TCP stream that can then be either dumped to file, saved as a pcap, analyzed via multiple inspection engines, etc.</p>

<p>Here&#8217;s a brief summary of available options:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -h
        ______              _                            __
       / __/ /___ _      __<span class="o">(</span>_<span class="o">)</span>___  _________  ___  _____/ /_
      / /_/ / __ <span class="se">\ </span><span class="p">|</span> /<span class="p">|</span> / / / __ <span class="se">\/</span> ___/ __ <span class="se">\/</span> _ <span class="se">\/</span> ___/ __/
     / __/ / /_/ / <span class="p">|</span>/ <span class="p">|</span>/ / / / / <span class="o">(</span>__  <span class="o">)</span> /_/ /  __/ /__/ /_
    /_/ /_/<span class="se">\_</span>___/<span class="p">|</span>__/<span class="p">|</span>__/_/_/ /_/____/ .___/<span class="se">\_</span>__/<span class="se">\_</span>__/<span class="se">\_</span>_/
                                    /_/

          flowinspect - A network inspection tool
          Ankur Tyagi <span class="o">(</span>7h3rAm<span class="o">)</span>

usage: flowinspect.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">(</span>-p --pcap <span class="p">|</span> -d --device<span class="o">)</span> <span class="o">[</span>-c --cregex<span class="o">]</span>
                      <span class="o">[</span>-s --sregex<span class="o">]</span> <span class="o">[</span>-a --aregex<span class="o">]</span> <span class="o">[</span>-i<span class="o">]</span> <span class="o">[</span>-m<span class="o">]</span> <span class="o">[</span>-G --cfuzz<span class="o">]</span>
                      <span class="o">[</span>-H --sfuzz<span class="o">]</span> <span class="o">[</span>-I --afuzz<span class="o">]</span> <span class="o">[</span>-r fuzzminthreshold<span class="o">]</span>
                      <span class="o">[</span>-P --cyararules<span class="o">]</span> <span class="o">[</span>-Q --syararules<span class="o">]</span> <span class="o">[</span>-R --ayararules<span class="o">]</span>
                      <span class="o">[</span>-M<span class="o">]</span> <span class="o">[</span>-J<span class="o">]</span> <span class="o">[</span>-y<span class="o">]</span> <span class="o">[</span>-Y --emuprofileoutsize<span class="o">]</span> <span class="o">[</span>-O --offset<span class="o">]</span>
                      <span class="o">[</span>-D --depth<span class="o">]</span> <span class="o">[</span>-T --maxinspstreams<span class="o">]</span> <span class="o">[</span>-U --maxinsppackets<span class="o">]</span>
                      <span class="o">[</span>-t --maxdispstreams<span class="o">]</span> <span class="o">[</span>-u --maxdisppackets<span class="o">]</span>
                      <span class="o">[</span>-b --maxdispbytes<span class="o">]</span> <span class="o">[</span>-w <span class="o">[</span>logdir<span class="o">]]</span>
                      <span class="o">[</span>-o <span class="o">{</span>quite,meta,hex,print,raw<span class="o">}]</span> <span class="o">[</span>-f --bpf<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> <span class="o">[</span>-V<span class="o">]</span>
                      <span class="o">[</span>-e<span class="o">]</span> <span class="o">[</span>-k<span class="o">]</span> <span class="o">[</span>-j<span class="o">]</span> <span class="o">[</span>-z <span class="p">|</span> -Z<span class="o">]</span> <span class="o">[</span>-q pcappacketct<span class="o">]</span> <span class="o">[</span>-L<span class="o">]</span> <span class="o">[</span>-B<span class="o">]</span>
                      <span class="o">[</span>-S<span class="o">]</span> <span class="o">[</span>-n<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -p --pcap             input pcap file
  -d --device           listening device
  -z                    write matching flows to pcap w/ <span class="m">5</span> post match packets
  -Z                    write matching flows to pcap w/ all post match packets

RegEx per Direction:
  -c --cregex           regex to match against CTS data
  -s --sregex           regex to match against STC data
  -a --aregex           regex to match against ANY data

RegEx Options:
  -i                    ignore <span class="k">case</span>
  -m                    disable multiline match

Fuzzy Patterns per Direction:
  -G --cfuzz            string to fuzzy match against CTS data
  -H --sfuzz            string to fuzzy match against STC data
  -I --afuzz            string to fuzzy match against ANY data

Fuzzy Options:
  -r fuzzminthreshold   threshold <span class="k">for</span> fuzzy match <span class="o">(</span><span class="m">1</span>-100<span class="o">)</span> - default <span class="m">75</span>

Yara Rules per Direction:
  -P --cyararules       Yara rules to match on CTS data
  -Q --syararules       Yara rules to match on STC data
  -R --ayararules       Yara rules to match on ANY data

Shellcode Detection:
  -M                    <span class="nb">enable</span> shellcode detection
  -J                    <span class="nb">enable</span> shellcode disassembly
  -y                    generate emulator profile <span class="k">for</span> detected shellcode
  -Y --emuprofileoutsize
                        emulator profile memory size <span class="o">(</span>default 1024K <span class="p">|</span> max:
                        10240K<span class="o">)</span>

Content Modifiers:
  -O --offset           bytes to skip before matching
  -D --depth            bytes to look at <span class="k">while</span> matching <span class="o">(</span>starting from offset<span class="o">)</span>

Inspection Limits:
  -T --maxinspstreams   max streams to inspect
  -U --maxinsppackets   max packets to inspect

Display Limits:
  -t --maxdispstreams   max streams to display
  -u --maxdisppackets   max packets to display
  -b --maxdispbytes     max bytes to display

Output Options:
  -w <span class="o">[</span>logdir<span class="o">]</span>           write matching packets/streams
  -o <span class="o">{</span>quite,meta,hex,print,raw<span class="o">}</span>
                        match output modes

Misc. Options:
  -f --bpf              BPF expression
  -v                    invert match
  -V                    verbose output <span class="o">(</span>max: <span class="m">3</span><span class="o">)</span>
  -e                    highlight CTS/STC matches
  -k                    <span class="nb">kill</span> matching TCP stream
  -j                    <span class="nb">enable</span> TCP multi match mode
  -q pcappacketct       <span class="c1"># of post match packets to write to pcap</span>
  -L                    <span class="nb">enable</span> linemode <span class="o">(</span>disables inspection<span class="o">)</span>
  -B                    skip banner/version display on startup
  -S                    skip match summary display at <span class="nb">exit</span>
  -n                    show argument stats
</code></pre></div>

<p>There are two modes of input: a pcap file or an interface name for live network traffic inspection. Let&#8217;s try a pcap file that has HTTP trace for <code>google.com</code>:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.920648 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.921427 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> <span class="o">(</span>627B<span class="o">)</span>
<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span> 0d 0a   <span class="p">|</span>GET / HTTP/1.1..<span class="p">|</span>
<span class="m">00000010</span>:  <span class="m">48</span> 6f <span class="m">73</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">77</span> <span class="m">77</span> <span class="m">77</span> 2e <span class="m">67</span> 6f 6f <span class="m">67</span> 6c <span class="m">65</span>   <span class="p">|</span>Host: www.google<span class="p">|</span>
<span class="m">00000020</span>:  2e <span class="m">63</span> 6f 6d 0d 0a <span class="m">55</span> <span class="m">73</span> <span class="m">65</span> <span class="m">72</span> 2d <span class="m">41</span> <span class="m">67</span> <span class="m">65</span> 6e <span class="m">74</span>   <span class="p">|</span>.com..User-Agent<span class="p">|</span>
<span class="m">00000030</span>:  3a <span class="m">20</span> 4d 6f 7a <span class="m">69</span> 6c 6c <span class="m">61</span> 2f <span class="m">35</span> 2e <span class="m">30</span> <span class="m">20</span> <span class="m">28</span> <span class="m">57</span>   <span class="p">|</span>: Mozilla/5.0 <span class="o">(</span>W<span class="p">|</span>
<span class="m">00000040</span>:  <span class="m">69</span> 6e <span class="m">64</span> 6f <span class="m">77</span> <span class="m">73</span> 3b <span class="m">20</span> <span class="m">55</span> 3b <span class="m">20</span> <span class="m">57</span> <span class="m">69</span> 6e <span class="m">64</span> 6f   <span class="p">|</span>indows<span class="p">;</span> U<span class="p">;</span> Windo<span class="p">|</span>
<span class="m">00000050</span>:  <span class="m">77</span> <span class="m">73</span> <span class="m">20</span> 4e <span class="m">54</span> <span class="m">20</span> <span class="m">36</span> 2e <span class="m">31</span> 3b <span class="m">20</span> <span class="m">65</span> 6e 2d <span class="m">55</span> <span class="m">53</span>   <span class="p">|</span>ws NT <span class="m">6</span>.1<span class="p">;</span> en-US<span class="p">|</span>
<span class="m">00000060</span>:  3b <span class="m">20</span> <span class="m">72</span> <span class="m">76</span> 3a <span class="m">31</span> 2e <span class="m">39</span> 2e <span class="m">31</span> 2e <span class="m">37</span> <span class="m">29</span> <span class="m">20</span> <span class="m">47</span> <span class="m">65</span>   <span class="p">|;</span> rv:1.9.1.7<span class="o">)</span> Ge<span class="p">|</span>
<span class="m">00000070</span>:  <span class="m">63</span> 6b 6f 2f <span class="m">32</span> <span class="m">30</span> <span class="m">30</span> <span class="m">39</span> <span class="m">31</span> <span class="m">32</span> <span class="m">32</span> <span class="m">31</span> <span class="m">20</span> <span class="m">46</span> <span class="m">69</span> <span class="m">72</span>   <span class="p">|</span>cko/20091221 Fir<span class="p">|</span>
<span class="m">00000080</span>:  <span class="m">65</span> <span class="m">66</span> 6f <span class="m">78</span> 2f <span class="m">33</span> 2e <span class="m">35</span> 2e <span class="m">37</span> 0d 0a <span class="m">41</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span>   <span class="p">|</span>efox/3.5.7..Acce<span class="p">|</span>
<span class="m">00000090</span>:  <span class="m">70</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">74</span> <span class="m">65</span> <span class="m">78</span> <span class="m">74</span> 2f <span class="m">68</span> <span class="m">74</span> 6d 6c 2c <span class="m">61</span> <span class="m">70</span>   <span class="p">|</span>pt: text/html,ap<span class="p">|</span>
000000a0:  <span class="m">70</span> 6c <span class="m">69</span> <span class="m">63</span> <span class="m">61</span> <span class="m">74</span> <span class="m">69</span> 6f 6e 2f <span class="m">78</span> <span class="m">68</span> <span class="m">74</span> 6d 6c 2b   <span class="p">|</span>plication/xhtml+<span class="p">|</span>
000000b0:  <span class="m">78</span> 6d 6c 2c <span class="m">61</span> <span class="m">70</span> <span class="m">70</span> 6c <span class="m">69</span> <span class="m">63</span> <span class="m">61</span> <span class="m">74</span> <span class="m">69</span> 6f 6e 2f   <span class="p">|</span>xml,application/<span class="p">|</span>
000000c0:  <span class="m">78</span> 6d 6c 3b <span class="m">71</span> 3d <span class="m">30</span> 2e <span class="m">39</span> 2c 2a 2f 2a 3b <span class="m">71</span> 3d   <span class="p">|</span>xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span><span class="m">0</span>.9,*/*<span class="p">;</span><span class="nv">q</span><span class="o">=</span><span class="p">|</span>
000000d0:  <span class="m">30</span> 2e <span class="m">38</span> 0d 0a <span class="m">41</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span> <span class="m">70</span> <span class="m">74</span> 2d 4c <span class="m">61</span> 6e <span class="m">67</span>   <span class="p">|</span><span class="m">0</span>.8..Accept-Lang<span class="p">|</span>
000000e0:  <span class="m">75</span> <span class="m">61</span> <span class="m">67</span> <span class="m">65</span> 3a <span class="m">20</span> <span class="m">65</span> 6e 2d <span class="m">75</span> <span class="m">73</span> 2c <span class="m">65</span> 6e 3b <span class="m">71</span>   <span class="p">|</span>uage: en-us,en<span class="p">;</span>q<span class="p">|</span>
000000f0:  3d <span class="m">30</span> 2e <span class="m">35</span> 0d 0a <span class="m">41</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span> <span class="m">70</span> <span class="m">74</span> 2d <span class="m">45</span> 6e <span class="m">63</span>   <span class="p">|</span><span class="o">=</span><span class="m">0</span>.5..Accept-Enc<span class="p">|</span>
<span class="m">00000100</span>:  6f <span class="m">64</span> <span class="m">69</span> 6e <span class="m">67</span> 3a <span class="m">20</span> <span class="m">67</span> 7a <span class="m">69</span> <span class="m">70</span> 2c <span class="m">64</span> <span class="m">65</span> <span class="m">66</span> 6c   <span class="p">|</span>oding: gzip,defl<span class="p">|</span>
<span class="m">00000110</span>:  <span class="m">61</span> <span class="m">74</span> <span class="m">65</span> 0d 0a <span class="m">41</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span> <span class="m">70</span> <span class="m">74</span> 2d <span class="m">43</span> <span class="m">68</span> <span class="m">61</span> <span class="m">72</span>   <span class="p">|</span>ate..Accept-Char<span class="p">|</span>
<span class="m">00000120</span>:  <span class="m">73</span> <span class="m">65</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">49</span> <span class="m">53</span> 4f 2d <span class="m">38</span> <span class="m">38</span> <span class="m">35</span> <span class="m">39</span> 2d <span class="m">31</span> 2c   <span class="p">|</span>set: ISO-8859-1,<span class="p">|</span>
<span class="m">00000130</span>:  <span class="m">75</span> <span class="m">74</span> <span class="m">66</span> 2d <span class="m">38</span> 3b <span class="m">71</span> 3d <span class="m">30</span> 2e <span class="m">37</span> 2c 2a 3b <span class="m">71</span> 3d   <span class="p">|</span>utf-8<span class="p">;</span><span class="nv">q</span><span class="o">=</span><span class="m">0</span>.7,*<span class="p">;</span><span class="nv">q</span><span class="o">=</span><span class="p">|</span>
<span class="m">00000140</span>:  <span class="m">30</span> 2e <span class="m">37</span> 0d 0a 4b <span class="m">65</span> <span class="m">65</span> <span class="m">70</span> 2d <span class="m">41</span> 6c <span class="m">69</span> <span class="m">76</span> <span class="m">65</span> 3a   <span class="p">|</span><span class="m">0</span>.7..Keep-Alive:<span class="p">|</span>
<span class="m">00000150</span>:  <span class="m">20</span> <span class="m">33</span> <span class="m">30</span> <span class="m">30</span> 0d 0a <span class="m">43</span> 6f 6e 6e <span class="m">65</span> <span class="m">63</span> <span class="m">74</span> <span class="m">69</span> 6f 6e   <span class="p">|</span> <span class="m">300</span>..Connection<span class="p">|</span>
<span class="m">00000160</span>:  3a <span class="m">20</span> 6b <span class="m">65</span> <span class="m">65</span> <span class="m">70</span> 2d <span class="m">61</span> 6c <span class="m">69</span> <span class="m">76</span> <span class="m">65</span> 0d 0a <span class="m">43</span> 6f   <span class="p">|</span>: keep-alive..Co<span class="p">|</span>
<span class="m">00000170</span>:  6f 6b <span class="m">69</span> <span class="m">65</span> 3a <span class="m">20</span> <span class="m">50</span> <span class="m">52</span> <span class="m">45</span> <span class="m">46</span> 3d <span class="m">49</span> <span class="m">44</span> 3d <span class="m">32</span> <span class="m">35</span>   <span class="p">|</span>okie: <span class="nv">PREF</span><span class="o">=</span><span class="nv">ID</span><span class="o">=</span><span class="m">25</span><span class="p">|</span>
<span class="m">00000180</span>:  <span class="m">37</span> <span class="m">39</span> <span class="m">31</span> <span class="m">33</span> <span class="m">61</span> <span class="m">39</span> <span class="m">33</span> <span class="m">38</span> <span class="m">65</span> <span class="m">36</span> <span class="m">63</span> <span class="m">32</span> <span class="m">34</span> <span class="m">38</span> 3a <span class="m">55</span>   <span class="p">|</span>7913a938e6c248:U<span class="p">|</span>
<span class="m">00000190</span>:  3d <span class="m">32</span> <span class="m">36</span> <span class="m">37</span> <span class="m">63</span> <span class="m">38</span> <span class="m">39</span> <span class="m">36</span> <span class="m">62</span> <span class="m">35</span> <span class="m">66</span> <span class="m">33</span> <span class="m">39</span> <span class="m">66</span> <span class="m">62</span> <span class="m">30</span>   <span class="p">|</span><span class="o">=</span>267c896b5f39fb0<span class="p">|</span>
000001a0:  <span class="m">62</span> 3a <span class="m">46</span> <span class="m">46</span> 3d <span class="m">34</span> 3a 4c <span class="m">44</span> 3d <span class="m">65</span> 6e 3a 4e <span class="m">52</span> 3d   <span class="p">|</span>b:FF<span class="o">=</span><span class="m">4</span>:LD<span class="o">=</span>en:NR<span class="o">=</span><span class="p">|</span>
000001b0:  <span class="m">31</span> <span class="m">30</span> 3a <span class="m">54</span> 4d 3d <span class="m">31</span> <span class="m">32</span> <span class="m">36</span> <span class="m">30</span> <span class="m">37</span> <span class="m">33</span> <span class="m">30</span> <span class="m">36</span> <span class="m">35</span> <span class="m">34</span>   <span class="p">|</span><span class="m">10</span>:TM<span class="o">=</span><span class="m">1260730654</span><span class="p">|</span>
000001c0:  3a 4c 4d 3d <span class="m">31</span> <span class="m">32</span> <span class="m">36</span> <span class="m">35</span> <span class="m">34</span> <span class="m">37</span> <span class="m">39</span> <span class="m">33</span> <span class="m">33</span> <span class="m">36</span> 3a <span class="m">47</span>   <span class="p">|</span>:LM<span class="o">=</span><span class="m">1265479336</span>:G<span class="p">|</span>
000001d0:  4d 3d <span class="m">31</span> 3a <span class="m">53</span> 3d <span class="m">68</span> <span class="m">31</span> <span class="m">55</span> <span class="m">42</span> <span class="m">47</span> 6f 6e <span class="m">54</span> <span class="m">75</span> <span class="m">57</span>   <span class="p">|</span><span class="nv">M</span><span class="o">=</span><span class="m">1</span>:S<span class="o">=</span>h1UBGonTuW<span class="p">|</span>
000001e0:  <span class="m">55</span> <span class="m">33</span> <span class="m">44</span> <span class="m">32</span> <span class="m">33</span> 4c 3b <span class="m">20</span> 4e <span class="m">49</span> <span class="m">44</span> 3d <span class="m">33</span> <span class="m">31</span> 3d 5a   <span class="p">|</span>U3D23L<span class="p">;</span> <span class="nv">NID</span><span class="o">=</span><span class="nv">31</span><span class="o">=</span>Z<span class="p">|</span>
000001f0:  2d 6e <span class="m">68</span> <span class="m">77</span> 4d 6a <span class="m">55</span> <span class="m">50</span> <span class="m">36</span> <span class="m">33</span> <span class="m">65</span> <span class="m">30</span> <span class="m">74</span> <span class="m">59</span> 4d <span class="m">54</span>   <span class="p">|</span>-nhwMjUP63e0tYMT<span class="p">|</span>
<span class="m">00000200</span>:  <span class="m">70</span> 2d <span class="m">33</span> <span class="m">54</span> <span class="m">31</span> <span class="m">69</span> <span class="m">67</span> 4d <span class="m">53</span> <span class="m">50</span> 6e 4e <span class="m">53</span> <span class="m">31</span> <span class="m">65</span> 4d   <span class="p">|</span>p-3T1igMSPnNS1eM<span class="p">|</span>
<span class="m">00000210</span>:  <span class="m">31</span> 6b 4e <span class="m">31</span> 5f <span class="m">44</span> <span class="m">55</span> <span class="m">72</span> 6e 4f <span class="m">32</span> 7a <span class="m">57</span> <span class="m">31</span> <span class="m">63</span> <span class="m">50</span>   <span class="p">|</span>1kN1_DUrnO2zW1cP<span class="p">|</span>
<span class="m">00000220</span>:  4d <span class="m">34</span> 4a <span class="m">45</span> <span class="m">33</span> <span class="m">41</span> 4a <span class="m">65</span> <span class="m">63</span> <span class="m">39</span> <span class="m">62</span> 5f <span class="m">76</span> <span class="m">47</span> 2d <span class="m">59</span>   <span class="p">|</span>M4JE3AJec9b_vG-Y<span class="p">|</span>
<span class="m">00000230</span>:  <span class="m">46</span> <span class="m">69</span> <span class="m">62</span> <span class="m">46</span> <span class="m">58</span> <span class="m">73</span> 7a 4f <span class="m">41</span> <span class="m">70</span> <span class="m">66</span> <span class="m">62</span> <span class="m">68</span> <span class="m">42</span> <span class="m">41</span> <span class="m">31</span>   <span class="p">|</span>FibFXszOApfbhBA1<span class="p">|</span>
<span class="m">00000240</span>:  <span class="m">42</span> 4f <span class="m">58</span> <span class="m">34</span> <span class="m">64</span> 4b <span class="m">78</span> <span class="m">34</span> 4c <span class="m">38</span> 5a <span class="m">44</span> <span class="m">64</span> <span class="m">65</span> <span class="m">69</span> 4b   <span class="p">|</span>BOX4dKx4L8ZDdeiK<span class="p">|</span>
<span class="m">00000250</span>:  <span class="m">77</span> <span class="m">71</span> <span class="m">65</span> 6b <span class="m">67</span> <span class="m">50</span> <span class="m">35</span> 5f 6b 7a <span class="m">45</span> 4c <span class="m">74</span> <span class="m">43</span> <span class="m">32</span> 6d   <span class="p">|</span>wqekgP5_kzELtC2m<span class="p">|</span>
<span class="m">00000260</span>:  <span class="m">55</span> <span class="m">48</span> <span class="m">78</span> <span class="m">37</span> <span class="m">52</span> <span class="m">48</span> <span class="m">78</span> <span class="m">33</span> <span class="m">50</span> <span class="m">49</span> <span class="m">74</span> <span class="m">74</span> <span class="m">63</span> <span class="m">75</span> 5a 0d   <span class="p">|</span>UHx7RHx3PIttcuZ.<span class="p">|</span>
<span class="m">00000270</span>:  0a 0d 0a                                          <span class="p">|</span>...<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.926528 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">0</span>:1406<span class="o">]</span> <span class="o">(</span>1406B<span class="o">)</span>
<span class="m">00000000</span>:  <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span> <span class="m">20</span> <span class="m">32</span> <span class="m">30</span> <span class="m">30</span> <span class="m">20</span> 4f 4b 0d   <span class="p">|</span>HTTP/1.1 <span class="m">200</span> OK.<span class="p">|</span>
<span class="m">00000010</span>:  0a <span class="m">44</span> <span class="m">61</span> <span class="m">74</span> <span class="m">65</span> 3a <span class="m">20</span> <span class="m">54</span> <span class="m">75</span> <span class="m">65</span> 2c <span class="m">20</span> <span class="m">30</span> <span class="m">39</span> <span class="m">20</span> <span class="m">46</span>   <span class="p">|</span>.Date: Tue, <span class="m">09</span> F<span class="p">|</span>
<span class="m">00000020</span>:  <span class="m">65</span> <span class="m">62</span> <span class="m">20</span> <span class="m">32</span> <span class="m">30</span> <span class="m">31</span> <span class="m">30</span> <span class="m">20</span> <span class="m">30</span> <span class="m">31</span> 3a <span class="m">31</span> <span class="m">38</span> 3a <span class="m">33</span> <span class="m">37</span>   <span class="p">|</span>eb <span class="m">2010</span> <span class="m">01</span>:18:37<span class="p">|</span>
<span class="m">00000030</span>:  <span class="m">20</span> <span class="m">47</span> 4d <span class="m">54</span> 0d 0a <span class="m">45</span> <span class="m">78</span> <span class="m">70</span> <span class="m">69</span> <span class="m">72</span> <span class="m">65</span> <span class="m">73</span> 3a <span class="m">20</span> 2d   <span class="p">|</span> GMT..Expires: -<span class="p">|</span>
<span class="m">00000040</span>:  <span class="m">31</span> 0d 0a <span class="m">43</span> <span class="m">61</span> <span class="m">63</span> <span class="m">68</span> <span class="m">65</span> 2d <span class="m">43</span> 6f 6e <span class="m">74</span> <span class="m">72</span> 6f 6c   <span class="p">|</span><span class="m">1</span>..Cache-Control<span class="p">|</span>
<span class="m">00000050</span>:  3a <span class="m">20</span> <span class="m">70</span> <span class="m">72</span> <span class="m">69</span> <span class="m">76</span> <span class="m">61</span> <span class="m">74</span> <span class="m">65</span> 2c <span class="m">20</span> 6d <span class="m">61</span> <span class="m">78</span> 2d <span class="m">61</span>   <span class="p">|</span>: private, max-a<span class="p">|</span>
<span class="m">00000060</span>:  <span class="m">67</span> <span class="m">65</span> 3d <span class="m">30</span> 0d 0a <span class="m">43</span> 6f 6e <span class="m">74</span> <span class="m">65</span> 6e <span class="m">74</span> 2d <span class="m">54</span> <span class="m">79</span>   <span class="p">|</span><span class="nv">ge</span><span class="o">=</span><span class="m">0</span>..Content-Ty<span class="p">|</span>
<span class="m">00000070</span>:  <span class="m">70</span> <span class="m">65</span> 3a <span class="m">20</span> <span class="m">74</span> <span class="m">65</span> <span class="m">78</span> <span class="m">74</span> 2f <span class="m">68</span> <span class="m">74</span> 6d 6c 3b <span class="m">20</span> <span class="m">63</span>   <span class="p">|</span>pe: text/html<span class="p">;</span> c<span class="p">|</span>
<span class="m">00000080</span>:  <span class="m">68</span> <span class="m">61</span> <span class="m">72</span> <span class="m">73</span> <span class="m">65</span> <span class="m">74</span> 3d <span class="m">55</span> <span class="m">54</span> <span class="m">46</span> 2d <span class="m">38</span> 0d 0a <span class="m">43</span> 6f   <span class="p">|</span><span class="nv">harset</span><span class="o">=</span>UTF-8..Co<span class="p">|</span>
<span class="m">00000090</span>:  6e <span class="m">74</span> <span class="m">65</span> 6e <span class="m">74</span> 2d <span class="m">45</span> 6e <span class="m">63</span> 6f <span class="m">64</span> <span class="m">69</span> 6e <span class="m">67</span> 3a <span class="m">20</span>   <span class="p">|</span>ntent-Encoding: <span class="p">|</span>
000000a0:  <span class="m">67</span> 7a <span class="m">69</span> <span class="m">70</span> 0d 0a <span class="m">53</span> <span class="m">65</span> <span class="m">72</span> <span class="m">76</span> <span class="m">65</span> <span class="m">72</span> 3a <span class="m">20</span> <span class="m">67</span> <span class="m">77</span>   <span class="p">|</span>gzip..Server: gw<span class="p">|</span>
000000b0:  <span class="m">73</span> 0d 0a <span class="m">43</span> 6f 6e <span class="m">74</span> <span class="m">65</span> 6e <span class="m">74</span> 2d 4c <span class="m">65</span> 6e <span class="m">67</span> <span class="m">74</span>   <span class="p">|</span>s..Content-Lengt<span class="p">|</span>
000000c0:  <span class="m">68</span> 3a <span class="m">20</span> <span class="m">34</span> <span class="m">36</span> <span class="m">33</span> <span class="m">33</span> 0d 0a <span class="m">58</span> 2d <span class="m">58</span> <span class="m">53</span> <span class="m">53</span> 2d <span class="m">50</span>   <span class="p">|</span>h: <span class="m">4633</span>..X-XSS-P<span class="p">|</span>
000000d0:  <span class="m">72</span> 6f <span class="m">74</span> <span class="m">65</span> <span class="m">63</span> <span class="m">74</span> <span class="m">69</span> 6f 6e 3a <span class="m">20</span> <span class="m">30</span> 0d 0a 0d 0a   <span class="p">|</span>rotection: <span class="m">0</span>....<span class="p">|</span>
000000e0:  1f 8b <span class="m">08</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">02</span> ff ad 3a 6b <span class="m">57</span> db ba   <span class="p">|</span>...........:kW..<span class="p">|</span>
000000f0:  b2 df fb 2b 8c b9 0d f6 c1 <span class="m">38</span> 0f ca 2b <span class="m">46</span> <span class="m">74</span> <span class="m">01</span>   <span class="p">|</span>...+.....8..+Ft.<span class="p">|</span>
&lt;snipped&gt;

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.930391 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000003</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000003</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">1406</span>:2812<span class="o">]</span> <span class="o">(</span>1406B<span class="o">)</span>
<span class="m">00000000</span>:  a5 <span class="m">02</span> 0b db <span class="m">75</span> d1 be ab <span class="m">38</span> <span class="m">66</span> <span class="m">95</span> <span class="m">33</span> <span class="m">81</span> d7 0e a0   <span class="p">|</span>....u...8f.3....<span class="p">|</span>
<span class="m">00000010</span>:  5c <span class="m">49</span> <span class="m">67</span> <span class="m">94</span> <span class="m">86</span> ce 5d 8c <span class="m">00</span> fd <span class="m">55</span> <span class="m">47</span> <span class="m">40</span> <span class="m">18</span> <span class="m">12</span> e1   <span class="p">|</span>.Ig...<span class="o">]</span>...UG@...<span class="p">|</span>
<span class="m">00000020</span>:  <span class="m">67</span> <span class="m">37</span> 8a <span class="m">67</span> e3 d1 ff c1 ea 9b d6 <span class="m">94</span> 5c bd <span class="m">42</span> 4f   <span class="p">|</span>g7.g..........BO<span class="p">|</span>
<span class="m">00000030</span>:  3e <span class="m">31</span> a9 dc fa 9d <span class="m">61</span> <span class="m">48</span> ca 0c <span class="m">65</span> <span class="m">95</span> <span class="m">91</span> 1f e1 7d   <span class="p">|</span>&gt;1....aH..e....<span class="o">}</span><span class="p">|</span>
<span class="m">00000040</span>:  <span class="m">47</span> <span class="m">93</span> <span class="m">29</span> db <span class="m">26</span> <span class="m">02</span> cb 0c <span class="m">52</span> e6 <span class="m">99</span> <span class="m">42</span> c5 5f 3d 0d   <span class="p">|</span>G.<span class="o">)</span>.<span class="p">&amp;</span>...R..B._<span class="o">=</span>.<span class="p">|</span>
<span class="m">00000050</span>:  b2 <span class="m">98</span> 6e <span class="m">71</span> 4f b3 f7 <span class="m">48</span> a3 cc ec <span class="m">15</span> b4 ac 6f <span class="m">67</span>   <span class="p">|</span>..nqO..H......og<span class="p">|</span>
<span class="m">00000060</span>:  <span class="m">79</span> 0a <span class="m">82</span> d5 ec d5 a6 <span class="m">40</span> ac 6b ff 7e aa e9 <span class="m">77</span> a4   <span class="p">|</span>y......@.k.~..w.<span class="p">|</span>
&lt;snipped&gt;

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.933283 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000004</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000004</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">2812</span>:4218<span class="o">]</span> <span class="o">(</span>1406B<span class="o">)</span>
<span class="m">00000000</span>:  <span class="m">28</span> aa <span class="m">22</span> <span class="m">91</span> 5c 9e <span class="m">89</span> ba <span class="m">44</span> 0b 8a d2 4c 9e <span class="m">06</span> fd   <span class="p">|</span><span class="o">(</span>.<span class="s2">&quot;.....D...L...|</span>
<span class="s2">00000010:  13 86 3c 24 69 cc 58 86 b2 eb 80 0f b1 74 5a c1   |..&lt;</span><span class="nv">$i</span><span class="s2">.X......tZ.|</span>
<span class="s2">00000020:  61 95 bb 37 81 da 29 90 81 c5 13 c8 72 f8 36 f4   |a..7..).....r.6.|</span>
<span class="s2">00000030:  13 30 2d 28 c4 a0 f2 87 fd 94 94 a5 aa 14 15 77   |.0-(...........w|</span>
<span class="s2">00000040:  b3 d9 90 85 6d 69 52 b7 fb 67 67 65 dd 8e 35 bb   |....miR..gge..5.|</span>
<span class="s2">00000050:  e9 73 a8 20 a4 71 b4 b6 36 05 45 00 4f ca e0 62   |.s. .q..6.E.O..b|</span>
<span class="s2">00000060:  53 14 c6 21 9e a0 87 a2 e8 15 f5 22 fc e3 49 ab   |S..!.......&quot;</span>..I.<span class="p">|</span>
&lt;snipped&gt;

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.952326 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000005</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000005</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">4218</span>:4320<span class="o">]</span> <span class="o">(</span>102B<span class="o">)</span>
<span class="m">00000000</span>:  d4 1c <span class="m">83</span> <span class="m">95</span> <span class="m">86</span> <span class="m">09</span> e6 5b 7e <span class="m">62</span> <span class="m">62</span> <span class="m">93</span> <span class="m">86</span> e1 5a 2e   <span class="p">|</span>.......<span class="o">[</span>~bb...Z.<span class="p">|</span>
<span class="m">00000010</span>:  <span class="m">71</span> ae 6d f1 <span class="m">85</span> <span class="m">88</span> c0 f0 c8 4b 3a <span class="m">76</span> <span class="m">81</span> <span class="m">24</span> de e2   <span class="p">|</span>q.m......K:v.$..<span class="p">|</span>
<span class="m">00000020</span>:  c9 a9 f5 <span class="m">71</span> <span class="m">95</span> 4c c7 ea <span class="m">10</span> <span class="m">56</span> <span class="m">90</span> a1 <span class="m">84</span> <span class="m">42</span> <span class="m">52</span> 8d   <span class="p">|</span>...q.L...V...BR.<span class="p">|</span>
<span class="m">00000030</span>:  <span class="m">20</span> 0a 6b 3d ad <span class="m">03</span> e1 ce c0 b8 aa eb d5 <span class="m">79</span> 2d 7a   <span class="p">|</span> .k<span class="o">=</span>.........y-z<span class="p">|</span>
<span class="m">00000040</span>:  6d df <span class="m">58</span> <span class="m">80</span> af e3 0f <span class="m">72</span> 8d ad a1 <span class="m">16</span> <span class="m">17</span> <span class="m">99</span> aa d1   <span class="p">|</span>m.X....r........<span class="p">|</span>
<span class="m">00000050</span>:  <span class="m">30</span> 9a f0 af aa <span class="m">93</span> ab <span class="m">32</span> 3a bd b8 eb <span class="nb">cd</span> ae c6 <span class="m">10</span>   <span class="p">|</span><span class="m">0</span>......2:.......<span class="p">|</span>
<span class="m">00000060</span>:  ab <span class="m">30</span> <span class="m">16</span> b2 5d <span class="m">89</span>                                 <span class="p">|</span>.0..<span class="o">]</span>.<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.952831 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> NORM: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Skipping inspection as linemode is enabled.
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000006</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000006</span>/00000000<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">4320</span>:4857<span class="o">]</span> <span class="o">(</span>537B<span class="o">)</span>
<span class="m">00000000</span>:  be 8e 9c 1e <span class="m">56</span> eb <span class="m">15</span> 6c ba a6 a8 a2 f0 2d <span class="m">21</span> 6f   <span class="p">|</span>....V..l.....-!o<span class="p">|</span>
<span class="m">00000010</span>:  d8 <span class="m">64</span> <span class="m">65</span> ae 3e 9d b4 2a d5 <span class="m">89</span> b0 1d <span class="m">71</span> <span class="m">87</span> <span class="m">56</span> be   <span class="p">|</span>.de.&gt;..*....q.V.<span class="p">|</span>
<span class="m">00000020</span>:  ba af d5 b8 3e <span class="m">12</span> 1f <span class="m">21</span> <span class="m">15</span> <span class="m">61</span> <span class="m">41</span> 9c <span class="m">31</span> 5a c8 1f   <span class="p">|</span>....&gt;..!.aA.1Z..<span class="p">|</span>
<span class="m">00000030</span>:  <span class="m">03</span> b5 d3 <span class="m">59</span> <span class="m">35</span> ae <span class="m">75</span> d1 <span class="m">09</span> 9c 5a <span class="nb">cd</span> <span class="m">31</span> <span class="m">45</span> d9 4b   <span class="p">|</span>...Y5.u...Z.1E.K<span class="p">|</span>
<span class="m">00000040</span>:  d4 c9 <span class="m">17</span> 6e 6a <span class="m">79</span> ff ea <span class="m">00</span> <span class="m">67</span> 1c <span class="m">68</span> <span class="nb">fc</span> <span class="m">32</span> dc c9   <span class="p">|</span>...njy...g.h.2..<span class="p">|</span>
<span class="m">00000050</span>:  ef df <span class="m">16</span> <span class="m">23</span> 9a ff f4 <span class="m">14</span> e8 b5 9a e6 2f <span class="m">11</span> 1b 7e   <span class="p">|</span>...#......../..~<span class="p">|</span>
<span class="m">00000060</span>:  2e <span class="m">11</span> <span class="m">17</span> af <span class="m">55</span> f7 <span class="m">36</span> 1b 0d cb <span class="m">27</span> b6 <span class="m">15</span> <span class="m">10</span> <span class="m">77</span> 0c   <span class="p">|</span>....U.6...<span class="err">&#39;</span>...w.<span class="p">|</span>
&lt;snipped&gt;

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.953561 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.953620 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:35:10.953669 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.097070. Exiting.
</code></pre></div>

<p>With the default options, Flowinspect will trace all TCP sessions from the input pcap and show a hexdump summary on a per packet basis. As can be seen from the output above, there is just one TCP session in the input pcap. The data sent by the client to the server is labelled as CTS (Client-to-Server) and that sent by the server in response is labelled as STC (Server-to-Client). In the last hexdump output, the second MATCH line shows that the STC buffer is of size 4857B, ie, the server replied with ~4.7KB of data for the initial request which was of size 627B.</p>

<h2>Regex Inspection Mode</h2>

<p>Each of the inspection engines are triggered once the <code>libnids</code> engine completes reassembly and provides CTS/STC buffers per session. These buffers are then passed on to respective inspection engines. Let&#8217;s now have a look at each of the inspection mode options, starting with regex mode first. Here&#8217;s a listing of options available for regex mode inspection:</p>

<div class="codehilite"><pre><span></span><code>RegEx per Direction:
  -c --cregex           regex to match against CTS data
  -s --sregex           regex to match against STC data
  -a --aregex           regex to match against ANY data

RegEx Options:
  -i                    ignore <span class="k">case</span>
  -m                    disable multiline match
</code></pre></div>

<p>The first three options allow users to specify regular expressions that will be matched upon respective TCP stream buffers. So let&#8217;s assume you wish to find all HTTP requests initiated by <code>Firefox</code>. From the <a href="http://www.useragentstring.com/pages/Firefox/">UserAgentStrings.com</a> listing for Firefox browser, we know that each such request will start with either <code>Mozilla/5.0</code> or <code>Mozilla/6.0</code> which can be shortened to <code>Mozilla/[56]\.0</code> regex:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -c <span class="s1">&#39;Mozilla/[56]\.0&#39;</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:59:08.385845 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches regex: <span class="s1">&#39;Mozilla/[56]\.0&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">50</span>:61<span class="o">]</span> <span class="o">(</span>11B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  4d 6f 7a <span class="m">69</span> 6c 6c <span class="m">61</span> 2f <span class="m">35</span> 2e <span class="m">30</span>                  <span class="p">|</span>Mozilla/5.0<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:59:08.387225 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:59:08.387584 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 11B <span class="o">(</span><span class="c1">#1), Longest: 11B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">09</span>:59:08.387902 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.017678. Exiting.
</code></pre></div>

<p>So we find a match of 11B within the CTS stream for <code>172.16.16.128:1606 - 74.125.95.104:80</code> TCP session. Another interesting thing to nte in this output is that the match was found within packet #4 itself. Flowinspect will perform a reverse calculation to identify packet boundaries per match. This is an extremely useful feature for those cases when you have millions of packets to scan and even after finding a match you are left clueless about the packet offset.</p>

<p>If you provide multiple regexes per direction, Flowinspect will match them upon streams as new packets arrive and reassembly completes. This means that if you provide both CTS/STC regexes and STC packets arrive first, then it will inspect STC regexes first. Additionally, Flowinspect will also inherently stop inspection on the first match. This is a performance optimization with the assumption that the first match signifies that what you were looking for within the network stream has been found (although partially) and as such there is no need to scan further. However, considering the fact that this behavior might not suffice everyone&#8217;s need, there&#8217;s a <code>multi match</code> mode that is enabled via the <code>-j</code> option and performs inspection even after we find a match. This mode will also help you find all the matches for an input expression within the network stream.</p>

<p>Regex mode also provides two options <code>-i</code> and <code>-m</code> to ignore case and disable multiline matches:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -c <span class="s1">&#39;mozilla/[56]\.0&#39;</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:27.451806 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:27.452312 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:27.452509 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:27.452731 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.018524. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -c <span class="s1">&#39;mozilla/[56]\.0&#39;</span> -i
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:30.960334 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches regex: <span class="s1">&#39;mozilla/[56]\.0&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">50</span>:61<span class="o">]</span> <span class="o">(</span>11B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  4d 6f 7a <span class="m">69</span> 6c 6c <span class="m">61</span> 2f <span class="m">35</span> 2e <span class="m">30</span>                  <span class="p">|</span>Mozilla/5.0<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:30.961976 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:30.962121 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 11B <span class="o">(</span><span class="c1">#1), Longest: 11B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:13:30.962186 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.016381. Exiting.
</code></pre></div>

<h2>Fuzzy String Inspection Mode</h2>

<p>The second inspection mode is Fuzzy string matching that allows inspection via similarity matches rather than exact matches. Fuzzy string matching allows to specify a threshold which can be compared against a match ration between two strings. If the ration satisfies the threshold, the match is considered to be valid else not. Let&#8217;s assume you wish to find all strings similar to <code>http</code>:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -G <span class="s1">&#39;http&#39;</span> -V
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.928901 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.929290 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.929504 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.929761 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.929933 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.930230 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.930506 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 doesnot match <span class="s1">&#39;http&#39;</span> <span class="o">(</span>ratio: <span class="m">50</span> &lt; threshold: <span class="m">75</span><span class="o">)</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.930900 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: Dumping open/tracked TCP streams: <span class="m">1</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.931113 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: <span class="o">[</span><span class="m">00000001</span><span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">{</span> CTS: 627B, STC: 4857B, TOT: 5484B <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.931286 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.931287 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:18:34.931867 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.019189. Exiting.
</code></pre></div>

<p>The <code>-V</code> option increases verbosity and the output shows that Flowinspect found a match, but since ratio (50%) was below the default threshold (75%), it was ignored. You can try different strings or change the default threshold for testing purposes:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -G <span class="s1">&#39;hTTp&#39;</span> -V -b32
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.919888 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.920530 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.921073 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.921394 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.921585 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.921707 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.923321 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 doesnot match <span class="s1">&#39;hTTp&#39;</span> <span class="o">(</span>ratio: <span class="m">50</span> &lt; threshold: <span class="m">75</span><span class="o">)</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.923782 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: Dumping open/tracked TCP streams: <span class="m">1</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.923881 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: <span class="o">[</span><span class="m">00000001</span><span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">{</span> CTS: 627B, STC: 4857B, TOT: 5484B <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.924025 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.924111 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:44.924552 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.028718. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -G <span class="s1">&#39;hTTP&#39;</span> -V -b32
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.258303 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.258539 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.258701 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.258866 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.259011 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.259128 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.259542 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 doesnot match <span class="s1">&#39;hTTP&#39;</span> <span class="o">(</span>ratio: <span class="m">25</span> &lt; threshold: <span class="m">75</span><span class="o">)</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.259896 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: Dumping open/tracked TCP streams: <span class="m">1</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.260022 IST<span class="o">]</span> <span class="o">[</span>dumpopenstreams<span class="o">]</span> INFO: <span class="o">[</span><span class="m">00000001</span><span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">{</span> CTS: 627B, STC: 4857B, TOT: 5484B <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.260084 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.260608 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:52.260818 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.021450. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -G <span class="s1">&#39;HTTP&#39;</span> -V -b32
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.122314 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.122810 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.122976 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.123240 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.123301 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.123301 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.123779 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches <span class="s1">&#39;HTTP&#39;</span> <span class="o">(</span>ratio: <span class="m">100</span> &gt;<span class="o">=</span> threshold: <span class="m">75</span><span class="o">)</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.124808 IST<span class="o">]</span> <span class="o">[</span>showtcpmatches<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> BPF: <span class="o">(</span>ip.src <span class="o">==</span> <span class="m">172</span>.16.16.128 and tcp.srcport <span class="o">==</span> <span class="m">1606</span><span class="o">)</span> and <span class="o">(</span>ip.dst <span class="o">==</span> <span class="m">74</span>.125.95.104 and tcp.dstport <span class="o">==</span> <span class="m">80</span><span class="o">)</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches <span class="s1">&#39;HTTP&#39;</span> <span class="o">(</span>ratio: <span class="m">100</span> &gt;<span class="o">=</span> threshold: <span class="m">75</span><span class="o">)</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> <span class="o">(</span>627B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span> 0d 0a   <span class="p">|</span>GET / HTTP/1.1..<span class="p">|</span>
<span class="m">00000010</span>:  <span class="m">48</span> 6f <span class="m">73</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">77</span> <span class="m">77</span> <span class="m">77</span> 2e <span class="m">67</span> 6f 6f <span class="m">67</span> 6c <span class="m">65</span>   <span class="p">|</span>Host: www.google<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.126556 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 not being tracked any further <span class="o">{</span> tcpmultimatch: False <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.126942 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.127170 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 627B <span class="o">(</span><span class="c1">#1), Longest: 627B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:22:59.127496 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.021806. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -G <span class="s1">&#39;HTTp&#39;</span> -V -b32
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.115715 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.116155 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.116350 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.116673 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.116848 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.117043 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.117043 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches <span class="s1">&#39;HTTp&#39;</span> <span class="o">(</span>ratio: <span class="m">75</span> &gt;<span class="o">=</span> threshold: <span class="m">75</span><span class="o">)</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.117043 IST<span class="o">]</span> <span class="o">[</span>showtcpmatches<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> BPF: <span class="o">(</span>ip.src <span class="o">==</span> <span class="m">172</span>.16.16.128 and tcp.srcport <span class="o">==</span> <span class="m">1606</span><span class="o">)</span> and <span class="o">(</span>ip.dst <span class="o">==</span> <span class="m">74</span>.125.95.104 and tcp.dstport <span class="o">==</span> <span class="m">80</span><span class="o">)</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 matches <span class="s1">&#39;HTTp&#39;</span> <span class="o">(</span>ratio: <span class="m">75</span> &gt;<span class="o">=</span> threshold: <span class="m">75</span><span class="o">)</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> <span class="o">(</span>627B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span> 0d 0a   <span class="p">|</span>GET / HTTP/1.1..<span class="p">|</span>
<span class="m">00000010</span>:  <span class="m">48</span> 6f <span class="m">73</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">77</span> <span class="m">77</span> <span class="m">77</span> 2e <span class="m">67</span> 6f 6f <span class="m">67</span> 6c <span class="m">65</span>   <span class="p">|</span>Host: www.google<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.121300 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 not being tracked any further <span class="o">{</span> tcpmultimatch: False <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.121704 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.121863 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 627B <span class="o">(</span><span class="c1">#1), Longest: 627B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:23:06.122211 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.024924. Exiting.
</code></pre></div>

<h2>Yara Inspection Mode</h2>

<p>The third inspection option is Yara rule matching over network streams. Yara is a signature-based malware identification and classification tool. Its yara-python bindings provide an API to use existing/custom signature files on an input buffer which in Flowinspect&#8217;s usecase is a network stream. Let&#8217;s have a look at the available options for Yara inspection mode:</p>

<div class="codehilite"><pre><span></span><code>Yara Rules per Direction:
  -P --cyararules       Yara rules to match on CTS data
  -Q --syararules       Yara rules to match on STC data
  -R --ayararules       Yara rules to match on ANY data
</code></pre></div>

<p>This mode expects a rule file from which rules are parsed, compiled and matched upon respective network streams:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/layer7/http_google.pcap -R ~/toolbox/testfiles/rules/yara/http.yar -V
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.451002 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452056 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 <span class="o">[</span>NEW<span class="o">]</span> <span class="o">{</span> TRACKED: <span class="m">1</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452196 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled CTS data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452306 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Enabled STC data collection <span class="k">for</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452415 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 <span class="o">[</span>627B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">0</span>, TOT: <span class="m">627</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452472 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on CTS<span class="o">[</span><span class="m">0</span>:627<span class="o">]</span> - 627B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452518 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 627B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452630 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 -&gt; <span class="m">74</span>.125.95.104:80 doesnot match any rule in /home/shiv/toolbox/testfiles/rules/yara/http.yar
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452788 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80 <span class="o">[</span>1406B<span class="o">]</span> <span class="o">{</span> CTS: <span class="m">627</span>, STC: <span class="m">1406</span>, TOT: <span class="m">2033</span> <span class="o">}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452852 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Initiating inspection on STC<span class="o">[</span><span class="m">0</span>:1406<span class="o">]</span> - 1406B
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.452889 IST<span class="o">]</span> <span class="o">[</span>inspect<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> Received 1406B <span class="k">for</span> inspection from <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.453111 IST<span class="o">]</span> <span class="o">[</span>showtcpmatches<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> BPF: <span class="o">(</span>ip.src <span class="o">==</span> <span class="m">172</span>.16.16.128 and tcp.srcport <span class="o">==</span> <span class="m">1606</span><span class="o">)</span> and <span class="o">(</span>ip.dst <span class="o">==</span> <span class="m">74</span>.125.95.104 and tcp.dstport <span class="o">==</span> <span class="m">80</span><span class="o">)</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 &lt;- <span class="m">74</span>.125.95.104:80 matches rule: <span class="s1">&#39;http&#39;</span> from /home/shiv/toolbox/testfiles/rules/yara/http.yar
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">0</span>:15<span class="o">]</span> <span class="o">(</span>15B <span class="p">|</span> packet<span class="o">[</span><span class="m">6</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">6</span><span class="o">])</span>
<span class="m">00000000</span>:  <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span> <span class="m">20</span> <span class="m">32</span> <span class="m">30</span> <span class="m">30</span> <span class="m">20</span> 4f 4b      <span class="p">|</span>HTTP/1.1 <span class="m">200</span> OK<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.453437 IST<span class="o">]</span> <span class="o">[</span>handletcp<span class="o">]</span> INFO: <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">172</span>.16.16.128:1606 - <span class="m">74</span>.125.95.104:80 not being tracked any further <span class="o">{</span> tcpmultimatch: False <span class="o">}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.453585 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.453627 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 15B <span class="o">(</span><span class="c1">#1), Longest: 15B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">11</span>:55:25.453712 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.019872. Exiting.
</code></pre></div>

<p>In the output above, Flowinspect informs that a rule named <code>http</code> matched on <code>172.16.16.128:1606 - 74.125.95.104:80</code> TCP stream. The content that is matched via this rule is of size 15B and is contained within the STC buffer spanning packet #6.</p>

<h2>Shellcode Inspection Mode</h2>

<p>The fourth and the last inspection mode is shellcode matching. There&#8217;s a library called <a href="http://libemu.carnivore.it/">libemu</a> that provides x86 emulation as well as shellcode detection via the GetPC heuristics. Most of Metasploit x86 architecture shellcode can be <a href="http://resources.infosecinstitute.com/shellcode-detection-emulation-libemu/">detected</a> <a href="https://bwall.github.io/libemu-scapy-for-shellcode-on-the-network/">via</a> <a href="http://nuald.blogspot.in/2010/10/shellcode-detection-using-libemu.html">Libemu</a>. Flowinspect uses its Python bindings, <a href="https://github.com/buffer/pylibemu">pylibemu</a> to inspect CTS/STC buffers. Let&#8217;s have a look at the options provided in this mode:</p>

<div class="codehilite"><pre><span></span><code>Shellcode Detection:
  -M                    <span class="nb">enable</span> shellcode detection
  -J                    <span class="nb">enable</span> shellcode disassembly
  -y                    generate emulator profile <span class="k">for</span> detected shellcode
  -Y --emuprofileoutsize
                        emulator profile memory size <span class="o">(</span>default 1024K <span class="p">|</span> max:
                        10240K<span class="o">)</span>
</code></pre></div>

<p>Unlike the other three inspection modes, shellcode detection work explicitly on both CTS and STC buffers at the same time. This means that when you request inspection and Flowinspect will auto inspect both buffers and reports matches. Let&#8217;s give this mode a test run:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -M
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:14:19.750865 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 &lt;- <span class="m">53</span>.70.78.87:80 contains shellcode <span class="o">[</span>Offset: <span class="m">104</span><span class="o">]</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">104</span>:278<span class="o">]</span> <span class="o">(</span>174B <span class="p">|</span> packet<span class="o">[</span><span class="m">6</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">6</span><span class="o">])</span>
<span class="m">00000000</span>:  e8 f9 ff ff ff <span class="m">60</span> <span class="m">31</span> db 8b 7d 3c 8b 7c 3d <span class="m">78</span> <span class="m">01</span>   <span class="p">|</span>.....<span class="sb">`</span><span class="m">1</span>..<span class="o">}</span>&lt;.<span class="p">|</span><span class="o">=</span>x.<span class="p">|</span>
<span class="m">00000010</span>:  ef 8b <span class="m">57</span> <span class="m">20</span> <span class="m">01</span> ea 8b <span class="m">34</span> 9a <span class="m">01</span> ee <span class="m">31</span> c0 <span class="m">99</span> ac c1   <span class="p">|</span>..W ...4...1....<span class="p">|</span>
<span class="m">00000020</span>:  ca 0d <span class="m">01</span> c2 <span class="m">84</span> c0 <span class="m">75</span> f6 <span class="m">43</span> <span class="m">66</span> <span class="m">39</span> ca <span class="m">75</span> e3 4b 8b   <span class="p">|</span>......u.Cf9.u.K.<span class="p">|</span>
<span class="m">00000030</span>:  4f <span class="m">24</span> <span class="m">01</span> e9 <span class="m">66</span> 8b 1c <span class="m">59</span> 8b 4f 1c <span class="m">01</span> e9 <span class="m">03</span> 2c <span class="m">99</span>   <span class="p">|</span>O$..f..Y.O....,.<span class="p">|</span>
<span class="m">00000040</span>:  <span class="m">89</span> 6c <span class="m">24</span> 1c <span class="m">61</span> ff e0 <span class="m">31</span> db <span class="m">64</span> 8b <span class="m">43</span> <span class="m">30</span> 8b <span class="m">40</span> 0c   <span class="p">|</span>.l$.a..1.d.C0.@.<span class="p">|</span>
<span class="m">00000050</span>:  8b <span class="m">70</span> 1c ad 8b <span class="m">68</span> <span class="m">08</span> 5e <span class="m">66</span> <span class="m">53</span> <span class="m">66</span> <span class="m">68</span> <span class="m">33</span> <span class="m">32</span> <span class="m">68</span> <span class="m">77</span>   <span class="p">|</span>.p...h.^fSfh32hw<span class="p">|</span>
<span class="m">00000060</span>:  <span class="m">73</span> <span class="m">32</span> 5f <span class="m">54</span> <span class="m">66</span> b9 <span class="m">72</span> <span class="m">60</span> ff d6 <span class="m">95</span> <span class="m">53</span> <span class="m">53</span> <span class="m">53</span> <span class="m">53</span> <span class="m">43</span>   <span class="p">|</span>s2_Tf.r<span class="sb">`</span>...SSSSC<span class="p">|</span>
<span class="m">00000070</span>:  <span class="m">53</span> <span class="m">43</span> <span class="m">53</span> <span class="m">89</span> e7 <span class="m">66</span> <span class="m">81</span> ef <span class="m">08</span> <span class="m">02</span> <span class="m">57</span> <span class="m">53</span> <span class="m">66</span> b9 e7 df   <span class="p">|</span>SCS..f....WSf...<span class="p">|</span>
<span class="m">00000080</span>:  ff d6 <span class="m">66</span> b9 a8 6f ff d6 <span class="m">97</span> <span class="m">68</span> c0 a8 <span class="m">35</span> <span class="m">14</span> <span class="m">66</span> <span class="m">68</span>   <span class="p">|</span>..f..o...h..5.fh<span class="p">|</span>
<span class="m">00000090</span>:  <span class="m">11</span> 5c <span class="m">66</span> <span class="m">53</span> <span class="m">89</span> e3 6a <span class="m">10</span> <span class="m">53</span> <span class="m">57</span> <span class="m">66</span> b9 <span class="m">57</span> <span class="m">05</span> ff d6   <span class="p">|</span>..fS..j.SWf.W...<span class="p">|</span>
000000a0:  <span class="m">50</span> b4 0c <span class="m">50</span> <span class="m">53</span> <span class="m">57</span> <span class="m">53</span> <span class="m">66</span> b9 c0 <span class="m">38</span> ff e6 0a         <span class="p">|</span>P..PSWSf..8...<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:14:19.771376 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:14:19.771409 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 174B <span class="o">(</span><span class="c1">#1), Longest: 174B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:14:19.771532 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.032331. Exiting.
</code></pre></div>

<p>So we found a match on the STC buffer of a TCP stream <code>55.51.105.73:60246 &lt;- 53.70.78.87:80</code>. The match is of size 172B and spans packet #6. Although, it&#8217;s great that we can find shellcode in network traffic, we still know nothing about the shellcode itself. It would be awesome if we can also identify the type of shellcode and what damage it can cause when executed on the victim system. This is where Libemu&#8217;s profiling feature comes in handy. It traces each system call, its arguments and return type which provide significant insight into the shellcode behavior:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -My -b32
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:38:18.796721 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 &lt;- <span class="m">53</span>.70.78.87:80 contains shellcode <span class="o">[</span>Offset: <span class="m">104</span><span class="o">]</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000002</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ STC<span class="o">[</span><span class="m">104</span>:278<span class="o">]</span> <span class="o">(</span>174B <span class="p">|</span> packet<span class="o">[</span><span class="m">6</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">6</span><span class="o">])</span>
<span class="m">00000000</span>:  e8 f9 ff ff ff <span class="m">60</span> <span class="m">31</span> db 8b 7d 3c 8b 7c 3d <span class="m">78</span> <span class="m">01</span>   <span class="p">|</span>.....<span class="sb">`</span><span class="m">1</span>..<span class="o">}</span>&lt;.<span class="p">|</span><span class="o">=</span>x.<span class="p">|</span>
<span class="m">00000010</span>:  ef 8b <span class="m">57</span> <span class="m">20</span> <span class="m">01</span> ea 8b <span class="m">34</span> 9a <span class="m">01</span> ee <span class="m">31</span> c0 <span class="m">99</span> ac c1   <span class="p">|</span>..W ...4...1....<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:38:18.817598 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:38:18.817842 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 174B <span class="o">(</span><span class="c1">#1), Longest: 174B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">12</span>:38:18.818107 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.037290. Exiting.
$
$ ll
-rw-rw-r-- <span class="m">1</span> shiv shiv  <span class="m">903</span> Dec <span class="m">30</span> <span class="m">12</span>:18 TCP-00000001-55.51.105.73.60246-53.70.78.87.80-STC.emuprofile
</code></pre></div>

<p>The <code>-b</code> option specifies max number of bytes to show in output modes for matching streams. Since we don&#8217;t really care about the hexadecimal bytes for now, we requested dumping of first 32B only. Above invocation of Flowinspect will dump the emulator profile to a TCP session based <code>.emuprofile</code> file:</p>

<div class="codehilite"><pre><span></span><code><span class="err">$</span> <span class="n">cat</span> <span class="n">TCP</span><span class="o">-</span><span class="mo">00000001</span><span class="o">-</span><span class="mf">55.51.105.73.60246</span><span class="o">-</span><span class="mf">53.70.78.87.80</span><span class="o">-</span><span class="n">STC</span><span class="p">.</span><span class="n">emuprofile</span>
<span class="n">HMODULE</span> <span class="n">LoadLibraryA</span> <span class="p">(</span>
     <span class="n">LPCTSTR</span> <span class="o">=</span> <span class="mh">0x010bee90</span> <span class="o">=&gt;</span>
           <span class="o">=</span> <span class="s">&quot;ws2_32&quot;</span><span class="p">;</span>
<span class="p">)</span> <span class="o">=</span>  <span class="mh">0x71a10000</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">WSAStartup</span> <span class="p">(</span>
     <span class="n">WORD</span> <span class="n">wVersionRequested</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="n">LPWSADATA</span> <span class="n">lpWSAData</span> <span class="o">=</span> <span class="mi">1244272</span><span class="p">;</span>
<span class="p">)</span> <span class="o">=</span>  <span class="mh">0x0</span><span class="p">;</span>
<span class="n">SOCKET</span> <span class="n">WSASocket</span> <span class="p">(</span>
     <span class="kt">int</span> <span class="n">af</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">protocol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">LPWSAPROTOCOL_INFO</span> <span class="n">lpProtocolInfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">GROUP</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">DWORD</span> <span class="n">dwFlags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">)</span> <span class="o">=</span>  <span class="mh">0x42</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">connect</span> <span class="p">(</span>
     <span class="n">SOCKET</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">66</span><span class="p">;</span>
     <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="mh">0x0012fe88</span> <span class="o">=&gt;</span>
         <span class="k">struct</span>   <span class="o">=</span> <span class="p">{</span>
             <span class="kt">short</span> <span class="n">sin_family</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
             <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sin_port</span> <span class="o">=</span> <span class="mi">23569</span> <span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">4444</span><span class="p">);</span>
             <span class="k">struct</span> <span class="n">in_addr</span> <span class="n">sin_addr</span> <span class="o">=</span> <span class="p">{</span>
                 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">s_addr</span> <span class="o">=</span> <span class="mi">339060928</span> <span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="mf">192.168.53.20</span><span class="p">);</span>
             <span class="p">};</span>
             <span class="kt">char</span> <span class="n">sin_zero</span> <span class="o">=</span> <span class="s">&quot;       &quot;</span><span class="p">;</span>
         <span class="p">};</span>
     <span class="kt">int</span> <span class="n">namelen</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="p">)</span> <span class="o">=</span>  <span class="mh">0x0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">recv</span> <span class="p">(</span>
     <span class="n">SOCKET</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">66</span><span class="p">;</span>
     <span class="kt">char</span> <span class="o">*</span> <span class="o">=</span> <span class="mh">0x010bfd70</span> <span class="o">=&gt;</span>
         <span class="n">none</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">3072</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">)</span> <span class="o">=</span>  <span class="mh">0xc00</span><span class="p">;</span>
</code></pre></div>

<p>From this profiling output, we can clearly identify and acknowledge the fact that the detected shellcode can do the following:</p>

<div class="codehilite"><pre><span></span><code><span class="mf">1.</span> <span class="n">Load</span> <span class="n">a</span> <span class="n">dynamic</span> <span class="n">library</span> <span class="n">named</span> <span class="n">ws2_32</span><span class="p">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">the</span> <span class="n">Windows</span> <span class="mi">32</span> <span class="n">socket</span> <span class="n">library</span>
<span class="mf">2.</span> <span class="n">Initialize</span> <span class="n">an</span> <span class="n">AF_INET</span> <span class="n">SOCK_STREAM</span> <span class="p">(</span><span class="nl">af</span><span class="p">:</span><span class="mi">2</span> <span class="n">and</span> <span class="nl">type</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span> <span class="n">socket</span>
<span class="mf">3.</span> <span class="n">Attempt</span> <span class="n">connection</span> <span class="n">via</span> <span class="n">this</span> <span class="n">socket</span> <span class="n">to</span> <span class="mf">192.168.53.20</span><span class="o">:</span><span class="mi">4444</span>
<span class="mf">4.</span> <span class="n">If</span> <span class="n">successful</span><span class="p">,</span> <span class="n">receive</span> <span class="n">data</span> <span class="n">from</span> <span class="mf">192.168.53.20</span>
</code></pre></div>

<p>This behavior is indicative of the fact that it is a <a href="http://morgawr.github.io/hacking/2014/03/29/shellcode-to-reverse-bind-with-netcat/">TCP Reverse Shell</a> spawning shellcode. Armed with this knowledge, users can enforce policy actions upon the probable attacker controlled system: <code>192.168.53.20</code></p>

<h2>Content Modifiers</h2>

<p>Flowinspect supports two Snort like content modifiers, <a href="http://manual.snort.org/node32.html#SECTION00458000000000000000">offset</a> and <a href="http://manual.snort.org/node32.html#SECTION00457000000000000000">depth</a>, invoked via the <code>-O</code> and <code>-D</code> options respectively. The <code>offset</code> modifier instructs Flowinspect to start inspection after skipping specified number of bytes. Similarly, the <code>depth</code> modifier instructs Flowinspect to only inspect specified number of bytes starting from the current value of offset. When used in combination these modifiers can prove to be extremely useful:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -b16 -c <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:44.463742 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:124<span class="o">]</span> <span class="o">(</span>124B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">76</span> <span class="m">33</span> <span class="m">44</span> <span class="m">34</span> <span class="m">64</span> <span class="m">38</span> <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span>   <span class="p">|</span>GET /v3D4d8 HTTP<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:44.464826 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:44.465063 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:44.465354 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.015481. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -b16 -c <span class="s1">&#39;.*&#39;</span> -O4
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:47.661117 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">4</span>:124<span class="o">]</span> <span class="o">(</span>120B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  2f <span class="m">76</span> <span class="m">33</span> <span class="m">44</span> <span class="m">34</span> <span class="m">64</span> <span class="m">38</span> <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span> 2f <span class="m">31</span> 2e <span class="m">31</span>   <span class="p">|</span>/v3D4d8 HTTP/1.1<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:47.664129 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:47.664353 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 120B <span class="o">(</span><span class="c1">#1), Longest: 120B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:47.664670 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.016728. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -b16 -c <span class="s1">&#39;.*&#39;</span> -D7
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:55.357421 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:7<span class="o">]</span> <span class="o">(</span>7B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">76</span> <span class="m">33</span>                              <span class="p">|</span>GET /v3<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:55.358129 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:55.358244 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 7B <span class="o">(</span><span class="c1">#1), Longest: 7B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:41:55.358303 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.011966. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -b16 -c <span class="s1">&#39;.*&#39;</span> -O4 -D7
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:42:01.359444 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">4</span>:11<span class="o">]</span> <span class="o">(</span>7B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
<span class="m">00000000</span>:  2f <span class="m">76</span> <span class="m">33</span> <span class="m">44</span> <span class="m">34</span> <span class="m">64</span> <span class="m">38</span>                              <span class="p">|</span>/v3D4d8<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:42:01.361249 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:42:01.362397 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 7B <span class="o">(</span><span class="c1">#1), Longest: 7B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:42:01.362984 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.020027. Exiting.
</code></pre></div>

<h2>Inspection and Display Limits</h2>

<p>Sometimes you might find yourself glancing at thousands of sessions and even with the powerful regex and other inspection mode matches that Flowinspect provides, you might still find it difficult to locate suspicious session. There are cases when you would like to restrict inspection and display to certain number of sessions and that where the following options come in handy:</p>

<div class="codehilite"><pre><span></span><code>Inspection Limits:
  -T --maxinspstreams   max streams to inspect
  -U --maxinsppackets   max packets to inspect

Display Limits:
  -t --maxdispstreams   max streams to display
  -u --maxdisppackets   max packets to display
  -b --maxdispbytes     max bytes to display
</code></pre></div>

<p>So for example, to limit inspection to first 100 TCP sessions, you can use the <code>-T</code> option. If you would like to view only the first 10 matches you can use the <code>-U</code> option.</p>

<h2>Output and Miscellaneous Options</h2>

<p>Flowinspect allows matching packets/streams to be dumped in the raw format to files via the <code>-w</code> option. It might come in handy in case you need to inspect such streams using an external tool and only rely upon Flowinspect&#8217;s reassembly capabilities.</p>

<p>There are certain output dumping modes that later the way matching streams are dumped to <code>stdout</code>:</p>

<div class="codehilite"><pre><span></span><code>$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -c <span class="s1">&#39;.*&#39;</span> -o meta
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:40.804023 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:124<span class="o">]</span> <span class="o">(</span>124B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:40.804757 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:40.804969 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:40.805302 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.022088. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -c <span class="s1">&#39;.*&#39;</span> -o hex
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:46.997075 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="m">00000000</span>:  <span class="m">47</span> <span class="m">45</span> <span class="m">54</span> <span class="m">20</span> 2f <span class="m">76</span> <span class="m">33</span> <span class="m">44</span> <span class="m">34</span> <span class="m">64</span> <span class="m">38</span> <span class="m">20</span> <span class="m">48</span> <span class="m">54</span> <span class="m">54</span> <span class="m">50</span>   <span class="p">|</span>GET /v3D4d8 HTTP<span class="p">|</span>
<span class="m">00000010</span>:  2f <span class="m">31</span> 2e <span class="m">31</span> 0d 0a <span class="m">48</span> 6f <span class="m">73</span> <span class="m">74</span> 3a <span class="m">20</span> <span class="m">35</span> <span class="m">33</span> 2e <span class="m">37</span>   <span class="p">|</span>/1.1..Host: <span class="m">53</span>.7<span class="p">|</span>
<span class="m">00000020</span>:  <span class="m">30</span> 2e <span class="m">37</span> <span class="m">38</span> 2e <span class="m">38</span> <span class="m">37</span> 0d 0a <span class="m">41</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span> <span class="m">70</span> <span class="m">74</span> 2d   <span class="p">|</span><span class="m">0</span>.78.87..Accept-<span class="p">|</span>
<span class="m">00000030</span>:  <span class="m">45</span> 6e <span class="m">63</span> 6f <span class="m">64</span> <span class="m">69</span> 6e <span class="m">67</span> 3a <span class="m">20</span> <span class="m">67</span> 7a <span class="m">69</span> <span class="m">70</span> 2c <span class="m">63</span>   <span class="p">|</span>Encoding: gzip,c<span class="p">|</span>
<span class="m">00000040</span>:  6f 6d <span class="m">70</span> <span class="m">72</span> <span class="m">65</span> <span class="m">73</span> <span class="m">73</span> 2c <span class="m">64</span> <span class="m">65</span> <span class="m">66</span> 6c <span class="m">61</span> <span class="m">74</span> <span class="m">65</span> 0d   <span class="p">|</span>ompress,deflate.<span class="p">|</span>
<span class="m">00000050</span>:  0a 4b <span class="m">65</span> <span class="m">65</span> <span class="m">70</span> 2d <span class="m">41</span> 6c <span class="m">69</span> <span class="m">76</span> <span class="m">65</span> 3a <span class="m">20</span> <span class="m">33</span> <span class="m">30</span> <span class="m">30</span>   <span class="p">|</span>.Keep-Alive: <span class="m">300</span><span class="p">|</span>
<span class="m">00000060</span>:  0d 0a <span class="m">43</span> 6f 6e 6e <span class="m">65</span> <span class="m">63</span> <span class="m">74</span> <span class="m">69</span> 6f 6e 3a <span class="m">20</span> 6b <span class="m">65</span>   <span class="p">|</span>..Connection: ke<span class="p">|</span>
<span class="m">00000070</span>:  <span class="m">65</span> <span class="m">70</span> 2d <span class="m">61</span> 6c <span class="m">69</span> <span class="m">76</span> <span class="m">65</span> 0d 0a 0d 0a               <span class="p">|</span>ep-alive....<span class="p">|</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:46.997881 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:46.998025 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:46.998159 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.022163. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -c <span class="s1">&#39;.*&#39;</span> -o print
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:53.616556 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

GET /v3D4d8 HTTP/1.1
Host: <span class="m">53</span>.70.78.87
Accept-Encoding: gzip,compress,deflate
Keep-Alive: <span class="m">300</span>
Connection: keep-alive

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:53.617182 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:53.617282 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:58:53.617396 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.014428. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -c <span class="s1">&#39;.*&#39;</span> -o raw
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:01.118321 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

GET /v3D4d8 HTTP/1.1
Host: <span class="m">53</span>.70.78.87
Accept-Encoding: gzip,compress,deflate
Keep-Alive: <span class="m">300</span>
Connection: keep-alive

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:01.118964 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:01.119049 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:01.119130 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.013852. Exiting.
$
$ ./flowinspect.py -p ~/toolbox/testfiles/pcaps/shellcode/shellcode-reverse-tcp-4444.pcap -c <span class="s1">&#39;.*&#39;</span> -o meta -o print
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:11.165294 IST<span class="o">]</span> <span class="o">[</span>main<span class="o">]</span> NORM: NIDS initialized, waiting <span class="k">for</span> events...

<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> <span class="m">55</span>.51.105.73:60246 -&gt; <span class="m">53</span>.70.78.87:80 matches regex: <span class="s1">&#39;.*&#39;</span>
<span class="o">[</span>MATCH<span class="o">]</span> <span class="o">(</span><span class="m">00000001</span>/00000001<span class="o">)</span> <span class="o">[</span>IP#1.TCP#1<span class="o">]</span> match @ CTS<span class="o">[</span><span class="m">0</span>:124<span class="o">]</span> <span class="o">(</span>124B <span class="p">|</span> packet<span class="o">[</span><span class="m">4</span><span class="o">]</span> - packet<span class="o">[</span><span class="m">4</span><span class="o">])</span>
GET /v3D4d8 HTTP/1.1
Host: <span class="m">53</span>.70.78.87
Accept-Encoding: gzip,compress,deflate
Keep-Alive: <span class="m">300</span>
Connection: keep-alive

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:11.167529 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: UDP Stats: <span class="o">{</span> Processed: <span class="m">0</span>, Matched: <span class="m">0</span> <span class="o">{</span> Shortest: 0B <span class="o">(</span><span class="c1">#0), Longest: 0B (#0) }}</span>
<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:11.167719 IST<span class="o">]</span> <span class="o">[</span>dumpmatchstats<span class="o">]</span> NORM: TCP Stats: <span class="o">{</span> Processed: <span class="m">1</span>, Matched: <span class="m">1</span> <span class="o">{</span> Shortest: 124B <span class="o">(</span><span class="c1">#1), Longest: 124B (#1) }}</span>

<span class="o">[</span><span class="m">27</span>-Nov-2014 <span class="m">13</span>:59:11.168003 IST<span class="o">]</span> <span class="o">[</span>doexit<span class="o">]</span> NORM: Session completed in <span class="m">0</span>:00:00.018121. Exiting.
</code></pre></div>

<p>You are allowed to combine these options together as can be seen in the last invocation in the above output.</p>

<p>Flowinspect also supports <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">BPF expressions</a> to filter network traffic. It also allows negation of the match logic, reseting the TCP connection for matching streams and writing post-match packets to a pcap file via the miscellaneous options category:</p>

<div class="codehilite"><pre><span></span><code>Misc. Options:
  -f --bpf              BPF expression
  -v                    invert match
  -V                    verbose output <span class="o">(</span>max: <span class="m">3</span><span class="o">)</span>
  -e                    highlight CTS/STC matches
  -k                    <span class="nb">kill</span> matching TCP stream
  -j                    <span class="nb">enable</span> TCP multi match mode
  -q pcappacketct       <span class="c1"># of post match packets to write to pcap</span>
  -L                    <span class="nb">enable</span> linemode <span class="o">(</span>disables inspection<span class="o">)</span>
  -B                    skip banner/version display on startup
  -S                    skip match summary display at <span class="nb">exit</span>
  -n                    show argument stats
</code></pre></div>

<p>Flowinspect has been under active development for some time now and I am constantly pushing fixes and feature to its <a href="https://github.com/7h3rAm/flowinspect">GitHub</a> repository. Please feel free to try it and let me know if it seems useful in network inspection scenarios you come across.</p>

        </div>
        <div class="meta">
          <hr/>
          <p>For comments, questions and suggestions use <a href="https://twitter.com/7h3rAm" target="_blank">twitter</a> or create an <a href="https://github.com/7h3rAm/7h3rAm.github.io/issues/new" target="_blank">issue</a> on blog repository.</p>
          <hr/>
                                                                                                                                                                                                                                                                                                <table>
                <tr>
                  <td align="left">(share via <a href="mailto:?subject=Flowinspect: A Network Inspection Tool&body=http://7h3ram.github.io//2014/flowinspect.html" target="_blank" title="Share via Email">mail</a>, <a href="http://twitter.com/intent/tweet?text=Flowinspect: A Network Inspection Tool+http://7h3ram.github.io//2014/flowinspect.html&via=7h3rAm" target="_blank" title="Share on Twitter">twitter</a>, <a href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://7h3ram.github.io//2014/flowinspect.html&p[images][0]=&p[title]=Flowinspect: A Network Inspection Tool&p[summary]=This post introduces a network inspection tool that I've developed, called Flowinspect. It aims to reassemble network data and scan it via different inspection engines. Results of these scan can be viewed as a HTML report or consumed as a JSON via external applications." target="_blank" title="Share on Facebook">facebook</a> or <a href="https://plus.google.com/share?url=http://7h3ram.github.io//2014/flowinspect.html" target="_blank" title="Share on Google Plus">google-plus</a>)</td>
                  <td align="right">(tagged <a href=/tags.html#code>code</a> and <a href=/tags.html#shellcode>shellcode</a>)</td>
                </tr>
                <tr>
                                      <td align="left"><a href="/2014/pcapedit.html">&lt;&lt; pcapedit: An Interactive Scapy-based Pcap Editor &lt;&lt;</a></td>
                    <td align="right"><a href="/2015/chopshop-shellcode.html">&gt;&gt; Shellcode Detection Module in ChopShop &gt;&gt;</a></td>
                                  </tr>
              </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
        </div>
      </div>
    </div>
  </div>
  </article>
              <div class="footer">
          <center>
            <a href="/rss.xml" target="_blank">rss</a> | <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license" target="_blank">license</a>
          </center>
        </div>
          </section>
  </body>
</html>