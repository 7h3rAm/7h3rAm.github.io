<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="author" content="7h3rAm"/>
    <meta name="description" content="Personal Weblog"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Grey Matter</title>

          <link href="/static/css/bright.css" rel="stylesheet" type="text/css">
    
    <link href="/static/css/codehilite/zenburn.css" rel="stylesheet" type="text/css">
    <link href="/static/images/favicon-32x32.png" sizes="32x32" rel="icon" type="image/png"/>
  </head>
  <body>
    <section id="content" class="body">
              <div class="header">
          <table>
            <tr>
              <td class="blogtitle"><a href="/">Grey Matter</a></td>
              <td class="blognavbar">
                <a href="/archive.html">[Archive]</a> <a href="/tags.html">[Tags]</a> <a href="/research.html">[Research]</a></a>
              </td>
            </tr>
          </table>
        </div>
                  <article class="post">
  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default section compact">
        <div class="body">
          <p class="heading">Little PDF Puzzle from Didier Stevens</p>
                                                                                                                                                                                                                                                                                                                                                            <p class="date">
                  <a href="/2014/pcapgentools-contentype-patch.html">&lt&lt;</a> published on 18/Sep/2014<a href="/2014/pcapedit.html"> &gt;&gt;</i></a><br/>
                </p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="post-content">
          <p>While reading an article about <a href="http://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/">Physical and Logical Structure of PDF Files</a> on Didier Stevens&#8217;s blog, I came across an interesting <a href="http://blog.didierstevens.com/2008/05/06/a-little-pdf-puzzle/">puzzle</a>. You can download the <a href="/static/files/pdf-puzzle.pdf">file</a> to follow along or read the <a href="http://blog.didierstevens.com/2008/05/07/solving-a-little-pdf-puzzle/">writeup</a> from the author itself.</p>

<p>Still here, great! Let&#8217;s get started. First thing is to check what <code>exiftool</code> has to tell us about this file:</p>

<div class="codehilite"><pre><span></span><code>$ exiftool pdf-puzzle.pdf
ExifTool Version Number         : <span class="m">9</span>.46
File Name                       : pdf-puzzle.pdf
Directory                       : .
File Size                       : <span class="m">1243</span> bytes
File Modification Date/Time     : <span class="m">2014</span>:09:18 <span class="m">17</span>:00:16+05:30
File Access Date/Time           : <span class="m">2014</span>:09:18 <span class="m">17</span>:00:19+05:30
File Inode Change Date/Time     : <span class="m">2014</span>:09:18 <span class="m">17</span>:00:16+05:30
File Permissions                : rw-rw-r--
File Type                       : PDF
MIME Type                       : application/pdf
PDF Version                     : <span class="m">1</span>.1
Linearized                      : No
Page Count                      : <span class="m">1</span>
</code></pre></div>

<p>All these attributes look standard and nothing suspicious pops out in the output. The author, Didier Stevens, hints that it is a simple challenge and can be solved using just Notepad or a standard PDF reader. Let&#8217;s view contents of this file in a text editor:</p>

<p><img src="/static/files/littlepdf-texteditor.png" alt="littlepdf-texteditor.png" /></p>

<p>If you have not read Didier Stevens&#8217;s <a href="http://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/">Physical and Logical Structure of PDF Files</a> post I strongly recommend reading it before reading further. It will help you identify something out of the ordinary in above output. There are two copies of xref table and trailer in this file hinting that it is probably a PDF with <a href="https://en.wikipedia.org/wiki/Portable_Document_Format#File_structure">Incremental Updates</a>. The new content (after the first <code>%%EOF</code>) has redefined object 5 and updated the xref table to help renders know its new offset. If you open this file in a PDF viewer, you will see something like this:</p>

<p><img src="/static/files/littlepdf-pdfjs.png" alt="littlepdf-pdfjs.png" /></p>

<p>The reader is using updated object and renders its content, thus overriding the older object definition. Since both object definitions contain <code>ASCII85Decode</code> encoded streams, we can manually decode and look at the raw content:</p>

<div class="codehilite"><pre><span></span><code><span class="err">$</span> <span class="n">ipython</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">banner</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ascii85</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ascii85</span><span class="o">.</span><span class="n">ascii85decode</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="se">\7</span><span class="s2">PQ#@1a#b0+&gt;GQ(+?(u.+B2ko-rakk+E1b1F)Yf5@&lt;6!&amp;BlbD!=BJ[-=BJ[-=BJ[-=BJ[-=BI!p&lt;,*OE;u~&quot;</span><span class="p">)</span>
<span class="s1">&#39;</span><span class="se">\x14</span><span class="s1">h</span><span class="se">\xd5</span><span class="s1">&quot;4 Tf 100 700 Td (The passphrase is XXXXXXXXXXXXXXXXXXX) Tj ET&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ascii85</span><span class="o">.</span><span class="n">ascii85decode</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="se">\7</span><span class="s2">PQ#@1a#b0+&gt;GQ(+?(u.+B2ko-rakk+E1b1F)Yf5@&lt;6!&amp;BlbCgDI[]uD.RU,@;I&amp;dE+EC!ATK:C&lt;,*OE;u~&quot;</span><span class="p">)</span>
<span class="s1">&#39;</span><span class="se">\x14</span><span class="s1">h</span><span class="se">\xd5</span><span class="s1">&quot;4 Tf 100 700 Td (The passphrase is Incremental Updates) Tj ET&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div>

<p>Awesome! The older object stream, when decoded (I&#8217;m using the ascii85 decoder from <a href="https://github.com/euske/pdfminer/blob/master/pdfminer/ascii85.py">pdfminer</a>), shows the passphrase. As suggested by Didier Stevens in his <a href="http://blog.didierstevens.com/2008/05/07/solving-a-little-pdf-puzzle/">writeup</a>, you could also remove the updated object content and xref table from the file to view the passphrase.</p>

        </div>
        <div class="meta">
          <hr/>
          <p>For comments, questions and suggestions use <a href="https://twitter.com/7h3rAm" target="_blank">twitter</a> or create an <a href="https://github.com/7h3rAm/7h3rAm.github.io/issues/new" target="_blank">issue</a> on blog repository.</p>
          <hr/>
                                                                                                                                                                                                                                                                                                                                            <table>
                <tr>
                  <td align="left">(share via <a href="mailto:?subject=Little PDF Puzzle from Didier Stevens&body=http://7h3ram.github.io//2014/little-pdf.html" target="_blank" title="Share via Email">mail</a>, <a href="http://twitter.com/intent/tweet?text=Little PDF Puzzle from Didier Stevens+http://7h3ram.github.io//2014/little-pdf.html&via=7h3rAm" target="_blank" title="Share on Twitter">twitter</a>, <a href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://7h3ram.github.io//2014/little-pdf.html&p[images][0]=&p[title]=Little PDF Puzzle from Didier Stevens&p[summary]=This is a post on how to solve the Little PDF puzzle from Didier Stevens." target="_blank" title="Share on Facebook">facebook</a> or <a href="https://plus.google.com/share?url=http://7h3ram.github.io//2014/little-pdf.html" target="_blank" title="Share on Google Plus">google-plus</a>)</td>
                  <td align="right">(tagged <a href=/tags.html#writeups>writeups</a>)</td>
                </tr>
                <tr>
                                      <td align="left"><a href="/2014/pcapgentools-contentype-patch.html">&lt;&lt; PCAP-GenerationTools and Content-Type Identification Patch &lt;&lt;</a></td>
                    <td align="right"><a href="/2014/pcapedit.html">&gt;&gt; pcapedit: An Interactive Scapy-based Pcap Editor &gt;&gt;</a></td>
                                  </tr>
              </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
        </div>
      </div>
    </div>
  </div>
  </article>
              <div class="footer">
          <center>
            <a href="/rss.xml" target="_blank">rss</a> | <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license" target="_blank">license</a>
          </center>
        </div>
          </section>
  </body>
</html>